"use strict";(self.webpackChunkgytree_v2=self.webpackChunkgytree_v2||[]).push([[495],{4495:(VC,Yd,W)=>{W.r(Yd),W.d(Yd,{LoginPageModule:()=>NC});var ha={};W.r(ha),W.d(ha,{FirebaseError:()=>_.ZR,SDK_VERSION:()=>Nt,_DEFAULT_ENTRY_NAME:()=>xt,_addComponent:()=>ms,_addOrOverwriteComponent:()=>of,_apps:()=>kt,_clearComponents:()=>yv,_components:()=>Or,_getProvider:()=>gs,_registerComponent:()=>Dt,_removeServiceInstance:()=>_v,deleteApp:()=>uf,getApp:()=>af,getApps:()=>Ev,initializeApp:()=>Ta,onLog:()=>cf,registerVersion:()=>tt,setLogLevel:()=>lf});var da=W(6814),g=W(8926),fa=W(2528),Se=W(95),pa=W(3017),Jd=W(8613),_=W(9058),Qe=W(4537),d=W(5861),Me=W(7879);const DI=(n,e)=>e.some(t=>n instanceof t);let Xd,ef;const tf=new WeakMap,ma=new WeakMap,nf=new WeakMap,ga=new WeakMap,_a=new WeakMap;let ya={get(n,e,t){if(n instanceof IDBTransaction){if("done"===e)return ma.get(n);if("objectStoreNames"===e)return n.objectStoreNames||nf.get(n);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ct(n[e])},set:(n,e,t)=>(n[e]=t,!0),has:(n,e)=>n instanceof IDBTransaction&&("done"===e||"store"===e)||e in n};function UI(n){return"function"==typeof n?function FI(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function VI(){return ef||(ef=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(n)?function(...e){return n.apply(Ia(this),e),Ct(tf.get(this))}:function(...e){return Ct(n.apply(Ia(this),e))}:function(e,...t){const r=n.call(Ia(this),e,...t);return nf.set(r,e.sort?e.sort():[e]),Ct(r)}}(n):(n instanceof IDBTransaction&&function LI(n){if(ma.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});ma.set(n,e)}(n),DI(n,function NI(){return Xd||(Xd=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(n,ya):n)}function Ct(n){if(n instanceof IDBRequest)return function OI(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(Ct(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&tf.set(t,n)}).catch(()=>{}),_a.set(e,n),e}(n);if(ga.has(n))return ga.get(n);const e=UI(n);return e!==n&&(ga.set(n,e),_a.set(e,n)),e}const Ia=n=>_a.get(n),qI=["get","getKey","getAll","getAllKeys","count"],GI=["put","add","delete","clear"],va=new Map;function rf(n,e){if(!(n instanceof IDBDatabase)||e in n||"string"!=typeof e)return;if(va.get(e))return va.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=GI.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!qI.includes(t))return;const s=function(){var o=(0,d.Z)(function*(a,...u){const c=this.transaction(a,i?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(u.shift())),(yield Promise.all([l[t](...u),i&&c.done]))[0]});return function(u){return o.apply(this,arguments)}}();return va.set(e,s),s}!function MI(n){ya=n(ya)}(n=>({...n,get:(e,t,r)=>rf(e,t)||n.get(e,t,r),has:(e,t)=>!!rf(e,t)||n.has(e,t)}));class zI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function WI(n){const e=n.getComponent();return"VERSION"===e?.type}(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}return null}).filter(t=>t).join(" ")}}const Ea="@firebase/app",un=new Me.Yd("@firebase/app"),xt="[DEFAULT]",gv={[Ea]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},kt=new Map,Or=new Map;function ms(n,e){try{n.container.addComponent(e)}catch(t){un.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function of(n,e){n.container.addOrOverwriteComponent(e)}function Dt(n){const e=n.name;if(Or.has(e))return un.debug(`There were multiple attempts to register component ${e}.`),!1;Or.set(e,n);for(const t of kt.values())ms(t,n);return!0}function gs(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function _v(n,e,t=xt){gs(n,e).clearInstance(t)}function yv(){Or.clear()}const ft=new _.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class vv{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Qe.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ft.create("app-deleted",{appName:this._name})}}const Nt="10.1.0";function Ta(n,e={}){let t=n;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:xt,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw ft.create("bad-app-name",{appName:String(i)});if(t||(t=(0,_.aH)()),!t)throw ft.create("no-options");const s=kt.get(i);if(s){if((0,_.vZ)(t,s.options)&&(0,_.vZ)(r,s.config))return s;throw ft.create("duplicate-app",{appName:i})}const o=new Qe.H0(i);for(const u of Or.values())o.addComponent(u);const a=new vv(t,r,o);return kt.set(i,a),a}function af(n=xt){const e=kt.get(n);if(!e&&n===xt&&(0,_.aH)())return Ta();if(!e)throw ft.create("no-app",{appName:n});return e}function Ev(){return Array.from(kt.values())}function uf(n){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,d.Z)(function*(n){const e=n.name;kt.has(e)&&(kt.delete(e),yield Promise.all(n.container.getProviders().map(t=>t.delete())),n.isDeleted=!0)})).apply(this,arguments)}function tt(n,e,t){var r;let i=null!==(r=gv[n])&&void 0!==r?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];return s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void un.warn(a.join(" "))}Dt(new Qe.wA(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function cf(n,e){if(null!==n&&"function"!=typeof n)throw ft.create("invalid-log-argument");(0,Me.Am)(n,e)}function lf(n){(0,Me.Ub)(n)}const Tv="firebase-heartbeat-database",Av=1,Lr="firebase-heartbeat-store";let wa=null;function hf(){return wa||(wa=function BI(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=Ct(o);return r&&o.addEventListener("upgradeneeded",u=>{r(Ct(o.result),u.oldVersion,u.newVersion,Ct(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),a.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}(Tv,Av,{upgrade:(n,e)=>{0===e&&n.createObjectStore(Lr)}}).catch(n=>{throw ft.create("idb-open",{originalErrorMessage:n.message})})),wa}function Ra(){return(Ra=(0,d.Z)(function*(n){try{return yield(yield hf()).transaction(Lr).objectStore(Lr).get(ff(n))}catch(e){if(e instanceof _.ZR)un.warn(e.message);else{const t=ft.create("idb-get",{originalErrorMessage:e?.message});un.warn(t.message)}}})).apply(this,arguments)}function df(n,e){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,d.Z)(function*(n,e){try{const r=(yield hf()).transaction(Lr,"readwrite");yield r.objectStore(Lr).put(e,ff(n)),yield r.done}catch(t){if(t instanceof _.ZR)un.warn(t.message);else{const r=ft.create("idb-set",{originalErrorMessage:t?.message});un.warn(r.message)}}})).apply(this,arguments)}function ff(n){return`${n.name}!${n.options.appId}`}class Sv{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Cv(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){var e=this;return(0,d.Z)(function*(){const r=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=pf();if(null===e._heartbeatsCache&&(e._heartbeatsCache=yield e._heartbeatsCachePromise),e._heartbeatsCache.lastSentHeartbeatDate!==i&&!e._heartbeatsCache.heartbeats.some(s=>s.date===i))return e._heartbeatsCache.heartbeats.push({date:i,agent:r}),e._heartbeatsCache.heartbeats=e._heartbeatsCache.heartbeats.filter(s=>{const o=new Date(s.date).valueOf();return Date.now()-o<=2592e6}),e._storage.overwrite(e._heartbeatsCache)})()}getHeartbeatsHeader(){var e=this;return(0,d.Z)(function*(){if(null===e._heartbeatsCache&&(yield e._heartbeatsCachePromise),null===e._heartbeatsCache||0===e._heartbeatsCache.heartbeats.length)return"";const t=pf(),{heartbeatsToSend:r,unsentEntries:i}=function bv(n,e=1024){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),mf(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),mf(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}(e._heartbeatsCache.heartbeats),s=(0,_.L)(JSON.stringify({version:2,heartbeats:r}));return e._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(e._heartbeatsCache.heartbeats=i,yield e._storage.overwrite(e._heartbeatsCache)):(e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache)),s})()}}function pf(){return(new Date).toISOString().substring(0,10)}class Cv{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,d.Z)(function*(){return!!(0,_.hl)()&&(0,_.eu)().then(()=>!0).catch(()=>!1)})()}read(){var e=this;return(0,d.Z)(function*(){return(yield e._canUseIndexedDBPromise)&&(yield function wv(n){return Ra.apply(this,arguments)}(e.app))||{heartbeats:[]}})()}overwrite(e){var t=this;return(0,d.Z)(function*(){var r;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return df(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})()}add(e){var t=this;return(0,d.Z)(function*(){var r;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return df(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}})()}}function mf(n){return(0,_.L)(JSON.stringify({version:2,heartbeats:n})).length}!function xv(n){Dt(new Qe.wA("platform-logger",e=>new zI(e),"PRIVATE")),Dt(new Qe.wA("heartbeat",e=>new Sv(e),"PRIVATE")),tt(Ea,"0.9.15",n),tt(Ea,"0.9.15","esm2017"),tt("fire-js","")}("");class kv{constructor(e,t){this._delegate=e,this.firebase=t,ms(e,new Qe.wA("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),uf(this._delegate)))}_getService(e,t=xt){var r;this._delegate.checkDestroyed();const i=this._delegate.container.getProvider(e);return!i.isInitialized()&&"EXPLICIT"===(null===(r=i.getComponent())||void 0===r?void 0:r.instantiationMode)&&i.initialize(),i.getImmediate({identifier:t})}_removeServiceInstance(e,t=xt){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){ms(this._delegate,e)}_addOrOverwriteComponent(e){of(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const gf=new _.LL("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),Vv=function _f(){const n=function Nv(n){const e={},t={__esModule:!0,initializeApp:function s(c,l={}){const h=Ta(c,l);if((0,_.r3)(e,h.name))return e[h.name];const f=new n(h,t);return e[h.name]=f,f},app:i,registerVersion:tt,setLogLevel:lf,onLog:cf,apps:null,SDK_VERSION:Nt,INTERNAL:{registerComponent:function a(c){const l=c.name,h=l.replace("-compat","");if(Dt(c)&&"PUBLIC"===c.type){const f=(p=i())=>{if("function"!=typeof p[h])throw gf.create("invalid-app-argument",{appName:l});return p[h]()};void 0!==c.serviceProps&&(0,_.ZB)(f,c.serviceProps),t[h]=f,n.prototype[h]=function(...p){return this._getService.bind(this,l).apply(this,c.multipleInstances?p:[])}}return"PUBLIC"===c.type?t[h]:null},removeApp:function r(c){delete e[c]},useAsService:function u(c,l){return"serverAuth"===l?null:l},modularAPIs:ha}};function i(c){if(!(0,_.r3)(e,c=c||xt))throw gf.create("no-app",{appName:c});return e[c]}return t.default=t,Object.defineProperty(t,"apps",{get:function o(){return Object.keys(e).map(c=>e[c])}}),i.App=n,t}(kv);return n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:_f,extendNamespace:function e(t){(0,_.ZB)(n,t)},createSubscribe:_.ne,ErrorFactory:_.LL,deepExtend:_.ZB}),n}(),yf=new Me.Yd("@firebase/app-compat");if((0,_.jU)()&&void 0!==self.firebase){yf.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const n=self.firebase.SDK_VERSION;n&&n.indexOf("LITE")>=0&&yf.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const cn=Vv;!function Mv(n){tt("@firebase/app-compat","0.2.15",n)}(),cn.registerVersion("firebase","10.1.0","app-compat");var Sa=W(7582);const Mr={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const qv=function Bv(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend."}},Gv=function If(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},vf=new _.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),_s=new Me.Yd("@firebase/auth");function ys(n,...e){_s.logLevel<=Me.in.ERROR&&_s.error(`Auth (${Nt}): ${n}`,...e)}function me(n,...e){throw ba(n,...e)}function Ee(n,...e){return ba(n,...e)}function Ef(n,e,t){const r=Object.assign(Object.assign({},Gv()),{[e]:t});return new _.LL("auth","Firebase",r).create(e,{appName:n.name})}function Gn(n,e,t){if(!(e instanceof t))throw t.name!==e.constructor.name&&me(n,"argument-error"),Ef(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ba(n,...e){if("string"!=typeof n){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return vf.create(n,...e)}function T(n,e,...t){if(!n)throw ba(e,...t)}function nt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw ys(e),new Error(e)}function Ye(n,e){n||nt(e)}function Fr(){var n;return typeof self<"u"&&(null===(n=self.location)||void 0===n?void 0:n.href)||""}function Ca(){return"http:"===Tf()||"https:"===Tf()}function Tf(){var n;return typeof self<"u"&&(null===(n=self.location)||void 0===n?void 0:n.protocol)||null}class Ur{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ye(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,_.uI)()||(0,_.b$)()}get(){return function Wv(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Ca()||(0,_.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function xa(n,e){Ye(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Af{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:void nt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:void nt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:void nt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const $v={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},jv=new Ur(3e4,6e4);function te(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function ne(n,e,t,r){return ka.apply(this,arguments)}function ka(){return(ka=(0,d.Z)(function*(n,e,t,r,i={}){return wf(n,i,(0,d.Z)(function*(){let s={},o={};r&&("GET"===e?o=r:s={body:JSON.stringify(r)});const a=(0,_.xO)(Object.assign({key:n.config.apiKey},o)).slice(1),u=yield n._getAdditionalHeaders();return u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode),Af.fetch()(Rf(n,n.config.apiHost,t,a),Object.assign({method:e,headers:u,referrerPolicy:"no-referrer"},s))}))})).apply(this,arguments)}function wf(n,e,t){return Da.apply(this,arguments)}function Da(){return(Da=(0,d.Z)(function*(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},$v),e);try{const i=new Zv(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=yield s.json();if("needConfirmation"in o)throw Br(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[u,c]=a.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===u)throw Br(n,"credential-already-in-use",o);if("EMAIL_EXISTS"===u)throw Br(n,"email-already-in-use",o);if("USER_DISABLED"===u)throw Br(n,"user-disabled",o);const l=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Ef(n,l,c);me(n,l)}}catch(i){if(i instanceof _.ZR)throw i;me(n,"network-request-failed",{message:String(i)})}})).apply(this,arguments)}function pt(n,e,t,r){return Na.apply(this,arguments)}function Na(){return(Na=(0,d.Z)(function*(n,e,t,r,i={}){const s=yield ne(n,e,t,r,i);return"mfaPendingCredential"in s&&me(n,"multi-factor-auth-required",{_serverResponse:s}),s})).apply(this,arguments)}function Rf(n,e,t,r){const i=`${e}${t}?${r}`;return n.config.emulator?xa(n.config,i):`${n.config.apiScheme}://${i}`}class Zv{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Ee(this.auth,"network-request-failed")),jv.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Br(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=Ee(n,e,r);return i.customData._tokenResponse=t,i}function Va(){return(Va=(0,d.Z)(function*(n,e){return ne(n,"POST","/v1/accounts:delete",e)})).apply(this,arguments)}function Oa(){return(Oa=(0,d.Z)(function*(n,e){return ne(n,"POST","/v1/accounts:update",e)})).apply(this,arguments)}function La(){return(La=(0,d.Z)(function*(n,e){return ne(n,"POST","/v1/accounts:lookup",e)})).apply(this,arguments)}function qr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Ma(){return(Ma=(0,d.Z)(function*(n,e=!1){const t=(0,_.m9)(n),r=yield t.getIdToken(e),i=Is(r);T(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:qr(Fa(i.auth_time)),issuedAtTime:qr(Fa(i.iat)),expirationTime:qr(Fa(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})).apply(this,arguments)}function Fa(n){return 1e3*Number(n)}function Is(n){const[e,t,r]=n.split(".");if(void 0===e||void 0===t||void 0===r)return ys("JWT malformed, contained fewer than 3 sections"),null;try{const i=(0,_.tV)(t);return i?JSON.parse(i):(ys("Failed to decode base64 JWT payload"),null)}catch(i){return ys("Caught error parsing JWT payload as JSON",i?.toString()),null}}function mt(n,e){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,d.Z)(function*(n,e,t=!1){if(t)return e;try{return yield e}catch(r){throw r instanceof _.ZR&&function eE({code:n}){return"auth/user-disabled"===n||"auth/user-token-expired"===n}(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})).apply(this,arguments)}class tE{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),r}{this.errorBackoff=3e4;const i=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){var t=this;if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout((0,d.Z)(function*(){yield t.iteration()}),r)}iteration(){var e=this;return(0,d.Z)(function*(){try{yield e.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t?.code&&e.schedule(!0))}e.schedule()})()}}class Pf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=qr(this.lastLoginAt),this.creationTime=qr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Gr(n){return Ba.apply(this,arguments)}function Ba(){return Ba=(0,d.Z)(function*(n){var e;const t=n.auth,r=yield n.getIdToken(),i=yield mt(n,function Yv(n,e){return La.apply(this,arguments)}(t,{idToken:r}));T(i?.users.length,t,"internal-error");const s=i.users[0];n._notifyReloadListener(s);const o=null!==(e=s.providerUserInfo)&&void 0!==e&&e.length?function iE(n){return n.map(e=>{var{providerId:t}=e,r=(0,Sa._T)(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}(s.providerUserInfo):[],a=function rE(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}(n.providerData,o),l=!!n.isAnonymous&&!(n.email&&s.passwordHash||a?.length),h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Pf(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(n,h)}),Ba.apply(this,arguments)}function qa(){return(qa=(0,d.Z)(function*(n){const e=(0,_.m9)(n);yield Gr(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})).apply(this,arguments)}function Ga(){return(Ga=(0,d.Z)(function*(n,e){const t=yield wf(n,{},(0,d.Z)(function*(){const r=(0,_.xO)({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=Rf(n,i,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Af.fetch()(o,{method:"POST",headers:a,body:r})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})).apply(this,arguments)}class zr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){T(e.idToken,"internal-error"),T(typeof e.idToken<"u","internal-error"),T(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):function Xv(n){const e=Is(n);return T(e,"internal-error"),T(typeof e.exp<"u","internal-error"),T(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}getToken(e,t=!1){var r=this;return(0,d.Z)(function*(){return T(!r.accessToken||r.refreshToken,e,"user-token-expired"),t||!r.accessToken||r.isExpired?r.refreshToken?(yield r.refresh(e,r.refreshToken),r.accessToken):null:r.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(e,t){var r=this;return(0,d.Z)(function*(){const{accessToken:i,refreshToken:s,expiresIn:o}=yield function sE(n,e){return Ga.apply(this,arguments)}(e,t);r.updateTokensAndExpiration(i,s,Number(o))})()}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new zr;return r&&(T("string"==typeof r,"internal-error",{appName:e}),o.refreshToken=r),i&&(T("string"==typeof i,"internal-error",{appName:e}),o.accessToken=i),s&&(T("number"==typeof s,"internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new zr,this.toJSON())}_performRefresh(){return nt("not implemented")}}function Vt(n,e){T("string"==typeof n||typeof n>"u","internal-error",{appName:e})}class ln{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=(0,Sa._T)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new tE(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Pf(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){var t=this;return(0,d.Z)(function*(){const r=yield mt(t,t.stsTokenManager.getToken(t.auth,e));return T(r,t.auth,"internal-error"),t.accessToken!==r&&(t.accessToken=r,yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)),r})()}getIdTokenResult(e){return function Jv(n){return Ma.apply(this,arguments)}(this,e)}reload(){return function nE(n){return qa.apply(this,arguments)}(this)}_assign(e){this!==e&&(T(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ln(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){T(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){var r=this;return(0,d.Z)(function*(){let i=!1;e.idToken&&e.idToken!==r.stsTokenManager.accessToken&&(r.stsTokenManager.updateFromServerResponse(e),i=!0),t&&(yield Gr(r)),yield r.auth._persistUserIfCurrent(r),i&&r.auth._notifyListenersIfCurrent(r)})()}delete(){var e=this;return(0,d.Z)(function*(){const t=yield e.getIdToken();return yield mt(e,function Hv(n,e){return Va.apply(this,arguments)}(e.auth,{idToken:t})),e.stsTokenManager.clearRefreshToken(),e.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,a,u,c,l;const h=null!==(r=t.displayName)&&void 0!==r?r:void 0,f=null!==(i=t.email)&&void 0!==i?i:void 0,p=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,v=null!==(o=t.photoURL)&&void 0!==o?o:void 0,A=null!==(a=t.tenantId)&&void 0!==a?a:void 0,w=null!==(u=t._redirectEventId)&&void 0!==u?u:void 0,k=null!==(c=t.createdAt)&&void 0!==c?c:void 0,N=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:D,emailVerified:M,isAnonymous:z,providerData:G,stsTokenManager:pe}=t;T(D&&pe,e,"internal-error");const an=zr.fromJSON(this.name,pe);T("string"==typeof D,e,"internal-error"),Vt(h,e.name),Vt(f,e.name),T("boolean"==typeof M,e,"internal-error"),T("boolean"==typeof z,e,"internal-error"),Vt(p,e.name),Vt(v,e.name),Vt(A,e.name),Vt(w,e.name),Vt(k,e.name),Vt(N,e.name);const ps=new ln({uid:D,auth:e,email:f,emailVerified:M,displayName:h,isAnonymous:z,photoURL:v,phoneNumber:p,tenantId:A,stsTokenManager:an,createdAt:k,lastLoginAt:N});return G&&Array.isArray(G)&&(ps.providerData=G.map(la=>Object.assign({},la))),w&&(ps._redirectEventId=w),ps}static _fromIdTokenResponse(e,t,r=!1){return(0,d.Z)(function*(){const i=new zr;i.updateFromServerResponse(t);const s=new ln({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Gr(s),s})()}}const Sf=new Map;function qe(n){Ye(n instanceof Function,"Expected a class definition");let e=Sf.get(n);return e?(Ye(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Sf.set(n,e),e)}const zn=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,d.Z)(function*(){return!0})()}_set(t,r){var i=this;return(0,d.Z)(function*(){i.storage[t]=r})()}_get(t){var r=this;return(0,d.Z)(function*(){const i=r.storage[t];return void 0===i?null:i})()}_remove(t){var r=this;return(0,d.Z)(function*(){delete r.storage[t]})()}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})();function hn(n,e,t){return`firebase:${n}:${e}:${t}`}class Wn{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=hn(this.userKey,i.apiKey,s),this.fullPersistenceKey=hn("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){var e=this;return(0,d.Z)(function*(){const t=yield e.persistence._get(e.fullUserKey);return t?ln._fromJSON(e.auth,t):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){var t=this;return(0,d.Z)(function*(){if(t.persistence===e)return;const r=yield t.getCurrentUser();return yield t.removeCurrentUser(),t.persistence=e,r?t.setCurrentUser(r):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return(0,d.Z)(function*(){if(!t.length)return new Wn(qe(zn),e,r);const i=(yield Promise.all(t.map(function(){var c=(0,d.Z)(function*(l){if(yield l._isAvailable())return l});return function(l){return c.apply(this,arguments)}}()))).filter(c=>c);let s=i[0]||qe(zn);const o=hn(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const l=yield c._get(o);if(l){const h=ln._fromJSON(e,l);c!==s&&(a=h),s=c;break}}catch{}const u=i.filter(c=>c._shouldAllowMigration);return s._shouldAllowMigration&&u.length?(s=u[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(function(){var c=(0,d.Z)(function*(l){if(l!==s)try{yield l._remove(o)}catch{}});return function(l){return c.apply(this,arguments)}}())),new Wn(s,e,r)):new Wn(s,e,r)})()}}function bf(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(kf(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Cf(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Df(e))return"Blackberry";if(Nf(e))return"Webos";if(za(e))return"Safari";if((e.includes("chrome/")||xf(e))&&!e.includes("edge/"))return"Chrome";if(Wr(e))return"Android";{const r=n.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===r?.length)return r[1]}return"Other"}function Cf(n=(0,_.z$)()){return/firefox\//i.test(n)}function za(n=(0,_.z$)()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function xf(n=(0,_.z$)()){return/crios\//i.test(n)}function kf(n=(0,_.z$)()){return/iemobile/i.test(n)}function Wr(n=(0,_.z$)()){return/android/i.test(n)}function Df(n=(0,_.z$)()){return/blackberry/i.test(n)}function Nf(n=(0,_.z$)()){return/webos/i.test(n)}function Kn(n=(0,_.z$)()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Vf(n=(0,_.z$)()){return Kn(n)||Wr(n)||Nf(n)||Df(n)||/windows phone/i.test(n)||kf(n)}function Of(n,e=[]){let t;switch(n){case"Browser":t=bf((0,_.z$)());break;case"Worker":t=`${bf((0,_.z$)())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Nt}/${r}`}function Wa(){return(Wa=(0,d.Z)(function*(n){return(yield ne(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Lf(n,e){return Ka.apply(this,arguments)}function Ka(){return(Ka=(0,d.Z)(function*(n,e){return ne(n,"GET","/v2/recaptchaConfig",te(n,e))})).apply(this,arguments)}function Mf(n){return void 0!==n&&void 0!==n.getResponse}function Ff(n){return void 0!==n&&void 0!==n.enterprise}class Uf{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(t=>"EMAIL_PASSWORD_PROVIDER"===t.provider&&"OFF"!==t.enforcementState)}}function $a(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const s=Ee("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",function hE(){var n,e;return null!==(e=null===(n=document.getElementsByTagName("head"))||void 0===n?void 0:n[0])&&void 0!==e?e:document}().appendChild(r)})}function Bf(n){return`__${n}${Math.floor(1e6*Math.random())}`}class qf{constructor(e){this.type="recaptcha-enterprise",this.auth=re(e)}verify(e="verify",t=!1){var r=this;return(0,d.Z)(function*(){function s(){return s=(0,d.Z)(function*(a){if(!t){if(null==a.tenantId&&null!=a._agentRecaptchaConfig)return a._agentRecaptchaConfig.siteKey;if(null!=a.tenantId&&void 0!==a._tenantRecaptchaConfigs[a.tenantId])return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(function(){var u=(0,d.Z)(function*(c,l){Lf(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(void 0!==h.recaptchaKey){const f=new Uf(h);return null==a.tenantId?a._agentRecaptchaConfig=f:a._tenantRecaptchaConfigs[a.tenantId]=f,c(f.siteKey)}l(new Error("recaptcha Enterprise site key undefined"))}).catch(h=>{l(h)})});return function(c,l){return u.apply(this,arguments)}}())}),s.apply(this,arguments)}function o(a,u,c){const l=window.grecaptcha;Ff(l)?l.enterprise.ready(()=>{l.enterprise.execute(a,{action:e}).then(h=>{u(h)}).catch(()=>{u("NO_RECAPTCHA")})}):c(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((a,u)=>{(function i(a){return s.apply(this,arguments)})(r.auth).then(c=>{if(!t&&Ff(window.grecaptcha))o(c,a,u);else{if(typeof window>"u")return void u(new Error("RecaptchaVerifier is only supported in browser"));$a("https://www.google.com/recaptcha/enterprise.js?render="+c).then(()=>{o(c,a,u)}).catch(l=>{u(l)})}}).catch(c=>{u(c)})})})()}}function Ot(n,e,t){return ja.apply(this,arguments)}function ja(){return(ja=(0,d.Z)(function*(n,e,t,r=!1){const i=new qf(n);let s;try{s=yield i.verify(t)}catch{s=yield i.verify(t,!0)}const o=Object.assign({},e);return Object.assign(o,r?{captchaResp:s}:{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o})).apply(this,arguments)}class mE{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=s=>new Promise((o,a)=>{try{o(e(s))}catch(u){a(u)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){var t=this;return(0,d.Z)(function*(){if(t.auth.currentUser===e)return;const r=[];try{for(const i of t.queue)yield i(e),i.onAbort&&r.push(i.onAbort)}catch(i){r.reverse();for(const s of r)try{s()}catch{}throw t.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}})()}}class gE{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Gf(this),this.idTokenSubscription=new Gf(this),this.beforeStateQueue=new mE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=vf,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){var r=this;return t&&(this._popupRedirectResolver=qe(t)),this._initializationPromise=this.queue((0,d.Z)(function*(){var i,s;if(!r._deleted&&(r.persistenceManager=yield Wn.create(r,e),!r._deleted)){if(null!==(i=r._popupRedirectResolver)&&void 0!==i&&i._shouldInitProactively)try{yield r._popupRedirectResolver._initialize(r)}catch{}yield r.initializeCurrentUser(t),r.lastNotifiedUid=(null===(s=r.currentUser)||void 0===s?void 0:s.uid)||null,!r._deleted&&(r._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var e=this;return(0,d.Z)(function*(){if(e._deleted)return;const t=yield e.assertedPersistence.getCurrentUser();if(e.currentUser||t){if(e.currentUser&&t&&e.currentUser.uid===t.uid)return e._currentUser._assign(t),void(yield e.currentUser.getIdToken());yield e._updateCurrentUser(t,!0)}})()}initializeCurrentUser(e){var t=this;return(0,d.Z)(function*(){var r;const i=yield t.assertedPersistence.getCurrentUser();let s=i,o=!1;if(e&&t.config.authDomain){yield t.getOrInitRedirectPersistenceManager();const a=null===(r=t.redirectUser)||void 0===r?void 0:r._redirectEventId,u=s?._redirectEventId,c=yield t.tryRedirectSignIn(e);(!a||a===u)&&c?.user&&(s=c.user,o=!0)}if(!s)return t.directlySetCurrentUser(null);if(!s._redirectEventId){if(o)try{yield t.beforeStateQueue.runMiddleware(s)}catch(a){s=i,t._popupRedirectResolver._overrideRedirectResult(t,()=>Promise.reject(a))}return s?t.reloadAndSetCurrentUserOrClear(s):t.directlySetCurrentUser(null)}return T(t._popupRedirectResolver,t,"argument-error"),yield t.getOrInitRedirectPersistenceManager(),t.redirectUser&&t.redirectUser._redirectEventId===s._redirectEventId?t.directlySetCurrentUser(s):t.reloadAndSetCurrentUserOrClear(s)})()}tryRedirectSignIn(e){var t=this;return(0,d.Z)(function*(){let r=null;try{r=yield t._popupRedirectResolver._completeRedirectFn(t,e,!0)}catch{yield t._setRedirectUser(null)}return r})()}reloadAndSetCurrentUserOrClear(e){var t=this;return(0,d.Z)(function*(){try{yield Gr(e)}catch(r){if("auth/network-request-failed"!==r?.code)return t.directlySetCurrentUser(null)}return t.directlySetCurrentUser(e)})()}useDeviceLanguage(){this.languageCode=function Kv(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}()}_delete(){var e=this;return(0,d.Z)(function*(){e._deleted=!0})()}updateCurrentUser(e){var t=this;return(0,d.Z)(function*(){const r=e?(0,_.m9)(e):null;return r&&T(r.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(r&&r._clone(t))})()}_updateCurrentUser(e,t=!1){var r=this;return(0,d.Z)(function*(){if(!r._deleted)return e&&T(r.tenantId===e.tenantId,r,"tenant-id-mismatch"),t||(yield r.beforeStateQueue.runMiddleware(e)),r.queue((0,d.Z)(function*(){yield r.directlySetCurrentUser(e),r.notifyAuthListeners()}))})()}signOut(){var e=this;return(0,d.Z)(function*(){return yield e.beforeStateQueue.runMiddleware(null),(e.redirectPersistenceManager||e._popupRedirectResolver)&&(yield e._setRedirectUser(null)),e._updateCurrentUser(null,!0)})()}setPersistence(e){var t=this;return this.queue((0,d.Z)(function*(){yield t.assertedPersistence.setPersistence(qe(e))}))}initializeRecaptchaConfig(){var e=this;return(0,d.Z)(function*(){const t=yield Lf(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Uf(t);null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.emailPasswordEnabled&&new qf(e).verify()})()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new _.LL("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){var r=this;return(0,d.Z)(function*(){const i=yield r.getOrInitRedirectPersistenceManager(t);return null===e?i.removeCurrentUser():i.setCurrentUser(e)})()}getOrInitRedirectPersistenceManager(e){var t=this;return(0,d.Z)(function*(){if(!t.redirectPersistenceManager){const r=e&&qe(e)||t._popupRedirectResolver;T(r,t,"argument-error"),t.redirectPersistenceManager=yield Wn.create(t,[qe(r._redirectPersistence)],"redirectUser"),t.redirectUser=yield t.redirectPersistenceManager.getCurrentUser()}return t.redirectPersistenceManager})()}_redirectUserForId(e){var t=this;return(0,d.Z)(function*(){var r,i;return t._isInitialized&&(yield t.queue((0,d.Z)(function*(){}))),(null===(r=t._currentUser)||void 0===r?void 0:r._redirectEventId)===e?t._currentUser:(null===(i=t.redirectUser)||void 0===i?void 0:i._redirectEventId)===e?t.redirectUser:null})()}_persistUserIfCurrent(e){var t=this;return(0,d.Z)(function*(){if(e===t.currentUser)return t.queue((0,d.Z)(function*(){return t.directlySetCurrentUser(e)}))})()}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t),o=this._isInitialized?Promise.resolve():this._initializationPromise;return T(o,this,"internal-error"),o.then(()=>s(this.currentUser)),"function"==typeof t?e.addObserver(t,r,i):e.addObserver(t)}directlySetCurrentUser(e){var t=this;return(0,d.Z)(function*(){t.currentUser&&t.currentUser!==e&&t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh(),t.currentUser=e,e?yield t.assertedPersistence.setCurrentUser(e):yield t.assertedPersistence.removeCurrentUser()})()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return T(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Of(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var e=this;return(0,d.Z)(function*(){var t;const r={"X-Client-Version":e.clientVersion};e.app.options.appId&&(r["X-Firebase-gmpid"]=e.app.options.appId);const i=yield null===(t=e.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader();i&&(r["X-Firebase-Client"]=i);const s=yield e._getAppCheckToken();return s&&(r["X-Firebase-AppCheck"]=s),r})()}_getAppCheckToken(){var e=this;return(0,d.Z)(function*(){var t;const r=yield null===(t=e.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken();return r?.error&&function zv(n,...e){_s.logLevel<=Me.in.WARN&&_s.warn(`Auth (${Nt}): ${n}`,...e)}(`Error while retrieving App Check token: ${r.error}`),r?.token})()}}function re(n){return(0,_.m9)(n)}class Gf{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,_.ne)(t=>this.observer=t)}get next(){return T(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function zf(n,e,t){const r=re(n);T(r._canInitEmulator,r,"emulator-config-failed"),T(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!!t?.disableWarnings,s=Wf(e),{host:o,port:a}=function IE(n){const e=Wf(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:Kf(r.substr(s.length+1))}}{const[s,o]=r.split(":");return{host:s,port:Kf(o)}}}(e);r.config.emulator={url:`${s}//${o}${null===a?"":`:${a}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function vE(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",n):n())}()}function Wf(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Kf(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}class $n{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return nt("not implemented")}_getIdTokenResponse(e){return nt("not implemented")}_linkToIdToken(e,t){return nt("not implemented")}_getReauthenticationResolver(e){return nt("not implemented")}}function $f(n,e){return Za.apply(this,arguments)}function Za(){return(Za=(0,d.Z)(function*(n,e){return ne(n,"POST","/v1/accounts:resetPassword",te(n,e))})).apply(this,arguments)}function jf(n,e){return Ha.apply(this,arguments)}function Ha(){return(Ha=(0,d.Z)(function*(n,e){return ne(n,"POST","/v1/accounts:update",e)})).apply(this,arguments)}function Qa(){return(Qa=(0,d.Z)(function*(n,e){return ne(n,"POST","/v1/accounts:update",te(n,e))})).apply(this,arguments)}function Ya(n,e){return Ja.apply(this,arguments)}function Ja(){return(Ja=(0,d.Z)(function*(n,e){return pt(n,"POST","/v1/accounts:signInWithPassword",te(n,e))})).apply(this,arguments)}function vs(n,e){return Xa.apply(this,arguments)}function Xa(){return(Xa=(0,d.Z)(function*(n,e){return ne(n,"POST","/v1/accounts:sendOobCode",te(n,e))})).apply(this,arguments)}function eu(){return(eu=(0,d.Z)(function*(n,e){return vs(n,e)})).apply(this,arguments)}function tu(n,e){return nu.apply(this,arguments)}function nu(){return(nu=(0,d.Z)(function*(n,e){return vs(n,e)})).apply(this,arguments)}function ru(n,e){return iu.apply(this,arguments)}function iu(){return(iu=(0,d.Z)(function*(n,e){return vs(n,e)})).apply(this,arguments)}function su(){return(su=(0,d.Z)(function*(n,e){return vs(n,e)})).apply(this,arguments)}function ou(){return(ou=(0,d.Z)(function*(n,e){return pt(n,"POST","/v1/accounts:signInWithEmailLink",te(n,e))})).apply(this,arguments)}function au(){return(au=(0,d.Z)(function*(n,e){return pt(n,"POST","/v1/accounts:signInWithEmailLink",te(n,e))})).apply(this,arguments)}class Kr extends $n{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Kr(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Kr(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){var t=this;return(0,d.Z)(function*(){var r;switch(t.signInMethod){case"password":const i={returnSecureToken:!0,email:t._email,password:t._password,clientType:"CLIENT_TYPE_WEB"};if(null!==(r=e._getRecaptchaConfig())&&void 0!==r&&r.emailPasswordEnabled){const s=yield Ot(e,i,"signInWithPassword");return Ya(e,s)}return Ya(e,i).catch(function(){var s=(0,d.Z)(function*(o){if("auth/missing-recaptcha-token"===o.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const a=yield Ot(e,i,"signInWithPassword");return Ya(e,a)}return Promise.reject(o)});return function(o){return s.apply(this,arguments)}}());case"emailLink":return function wE(n,e){return ou.apply(this,arguments)}(e,{email:t._email,oobCode:t._password});default:me(e,"internal-error")}})()}_linkToIdToken(e,t){var r=this;return(0,d.Z)(function*(){switch(r.signInMethod){case"password":return jf(e,{idToken:t,returnSecureToken:!0,email:r._email,password:r._password});case"emailLink":return function RE(n,e){return au.apply(this,arguments)}(e,{idToken:t,email:r._email,oobCode:r._password});default:me(e,"internal-error")}})()}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}function gt(n,e){return uu.apply(this,arguments)}function uu(){return(uu=(0,d.Z)(function*(n,e){return pt(n,"POST","/v1/accounts:signInWithIdp",te(n,e))})).apply(this,arguments)}class rt extends $n{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new rt(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):me("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=(0,Sa._T)(t,["providerId","signInMethod"]);if(!r||!i)return null;const o=new rt(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){return gt(e,this.buildRequest())}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,gt(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,gt(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,_.xO)(t)}return e}}function cu(){return(cu=(0,d.Z)(function*(n,e){return ne(n,"POST","/v1/accounts:sendVerificationCode",te(n,e))})).apply(this,arguments)}function lu(){return(lu=(0,d.Z)(function*(n,e){return pt(n,"POST","/v1/accounts:signInWithPhoneNumber",te(n,e))})).apply(this,arguments)}function hu(){return(hu=(0,d.Z)(function*(n,e){const t=yield pt(n,"POST","/v1/accounts:signInWithPhoneNumber",te(n,e));if(t.temporaryProof)throw Br(n,"account-exists-with-different-credential",t);return t})).apply(this,arguments)}const xE={USER_NOT_FOUND:"user-not-found"};function du(){return(du=(0,d.Z)(function*(n,e){return pt(n,"POST","/v1/accounts:signInWithPhoneNumber",te(n,Object.assign(Object.assign({},e),{operation:"REAUTH"})),xE)})).apply(this,arguments)}class dn extends $n{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new dn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new dn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return function bE(n,e){return lu.apply(this,arguments)}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return function CE(n,e){return hu.apply(this,arguments)}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return function kE(n,e){return du.apply(this,arguments)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s}=e;return r||t||i||s?new dn({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s}):null}}class $r{constructor(e){var t,r,i,s,o,a;const u=(0,_.zd)((0,_.pd)(e)),c=null!==(t=u.apiKey)&&void 0!==t?t:null,l=null!==(r=u.oobCode)&&void 0!==r?r:null,h=function DE(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=u.mode)&&void 0!==i?i:null);T(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!==(s=u.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=u.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=u.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function NE(n){const e=(0,_.zd)((0,_.pd)(n)).link,t=e?(0,_.zd)((0,_.pd)(e)).deep_link_id:null,r=(0,_.zd)((0,_.pd)(n)).deep_link_id;return(r?(0,_.zd)((0,_.pd)(r)).link:null)||r||t||e||n}(e);try{return new $r(t)}catch{return null}}}let fu=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return Kr._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){const i=$r.parseLink(r);return T(i,"argument-error"),Kr._fromEmailAndCode(t,i.code,i.tenantId)}}return n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink",n})();class _t{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class jn extends _t{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Zn extends jn{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return T("providerId"in t&&"signInMethod"in t,"argument-error"),rt._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return T(e.idToken||e.accessToken,"argument-error"),rt._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Zn.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Zn.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:i,pendingToken:s,nonce:o,providerId:a}=e;if(!r&&!i&&!t&&!s||!a)return null;try{return new Zn(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:s})}catch{return null}}}let Zf=(()=>{class n extends jn{constructor(){super("facebook.com")}static credential(t){return rt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return n.credential(t.oauthAccessToken)}catch{return null}}}return n.FACEBOOK_SIGN_IN_METHOD="facebook.com",n.PROVIDER_ID="facebook.com",n})(),Hf=(()=>{class n extends jn{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return rt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:r,oauthAccessToken:i}=t;if(!r&&!i)return null;try{return n.credential(r,i)}catch{return null}}}return n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com",n})(),Qf=(()=>{class n extends jn{constructor(){super("github.com")}static credential(t){return rt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return n.credential(t.oauthAccessToken)}catch{return null}}}return n.GITHUB_SIGN_IN_METHOD="github.com",n.PROVIDER_ID="github.com",n})();class Hn extends $n{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return gt(e,this.buildRequest())}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,gt(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,gt(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:i,pendingToken:s}=t;return r&&i&&s&&r===i?new Hn(r,s):null}static _create(e,t){return new Hn(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Es extends _t{constructor(e){T(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return Es.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Es.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Hn.fromJSON(e);return T(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Hn._create(r,t)}catch{return null}}}let Yf=(()=>{class n extends jn{constructor(){super("twitter.com")}static credential(t,r){return rt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:r,oauthTokenSecret:i}=t;if(!r||!i)return null;try{return n.credential(r,i)}catch{return null}}}return n.TWITTER_SIGN_IN_METHOD="twitter.com",n.PROVIDER_ID="twitter.com",n})();function Ts(n,e){return pu.apply(this,arguments)}function pu(){return(pu=(0,d.Z)(function*(n,e){return pt(n,"POST","/v1/accounts:signUp",te(n,e))})).apply(this,arguments)}class $e{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return(0,d.Z)(function*(){const s=yield ln._fromIdTokenResponse(e,r,i),o=Jf(r);return new $e({user:s,providerId:o,_tokenResponse:r,operationType:t})})()}static _forOperation(e,t,r){return(0,d.Z)(function*(){yield e._updateTokensIfNecessary(r,!0);const i=Jf(r);return new $e({user:e,providerId:i,_tokenResponse:r,operationType:t})})()}}function Jf(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}function mu(){return(mu=(0,d.Z)(function*(n){var e;const t=re(n);if(yield t._initializationPromise,null!==(e=t.currentUser)&&void 0!==e&&e.isAnonymous)return new $e({user:t.currentUser,providerId:null,operationType:"signIn"});const r=yield Ts(t,{returnSecureToken:!0}),i=yield $e._fromIdTokenResponse(t,"signIn",r,!0);return yield t._updateCurrentUser(i.user),i})).apply(this,arguments)}class As extends _.ZR{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,As.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new As(e,t,r,i)}}function Xf(n,e,t,r){return("reauthenticate"===e?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw"auth/multi-factor-auth-required"===s.code?As._fromErrorAndOperation(n,s,e,r):s})}function ep(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}function gu(){return gu=(0,d.Z)(function*(n,e){const t=(0,_.m9)(n);yield ws(!0,t,e);const{providerUserInfo:r}=yield function Qv(n,e){return Oa.apply(this,arguments)}(t.auth,{idToken:yield t.getIdToken(),deleteProvider:[e]}),i=ep(r||[]);return t.providerData=t.providerData.filter(s=>i.has(s.providerId)),i.has("phone")||(t.phoneNumber=null),yield t.auth._persistUserIfCurrent(t),t}),gu.apply(this,arguments)}function _u(n,e){return yu.apply(this,arguments)}function yu(){return(yu=(0,d.Z)(function*(n,e,t=!1){const r=yield mt(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return $e._forOperation(n,"link",r)})).apply(this,arguments)}function ws(n,e,t){return Iu.apply(this,arguments)}function Iu(){return(Iu=(0,d.Z)(function*(n,e,t){yield Gr(e);const i=!1===n?"provider-already-linked":"no-such-provider";T(ep(e.providerData).has(t)===n,e.auth,i)})).apply(this,arguments)}function tp(n,e){return vu.apply(this,arguments)}function vu(){return(vu=(0,d.Z)(function*(n,e,t=!1){const{auth:r}=n,i="reauthenticate";try{const s=yield mt(n,Xf(r,i,e,n),t);T(s.idToken,r,"internal-error");const o=Is(s.idToken);T(o,r,"internal-error");const{sub:a}=o;return T(n.uid===a,r,"user-mismatch"),$e._forOperation(n,i,s)}catch(s){throw"auth/user-not-found"===s?.code&&me(r,"user-mismatch"),s}})).apply(this,arguments)}function np(n,e){return Eu.apply(this,arguments)}function Eu(){return(Eu=(0,d.Z)(function*(n,e,t=!1){const r="signIn",i=yield Xf(n,r,e),s=yield $e._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})).apply(this,arguments)}function Rs(n,e){return Tu.apply(this,arguments)}function Tu(){return(Tu=(0,d.Z)(function*(n,e){return np(re(n),e)})).apply(this,arguments)}function rp(n,e){return Au.apply(this,arguments)}function Au(){return(Au=(0,d.Z)(function*(n,e){const t=(0,_.m9)(n);return yield ws(!1,t,e.providerId),_u(t,e)})).apply(this,arguments)}function ip(n,e){return wu.apply(this,arguments)}function wu(){return(wu=(0,d.Z)(function*(n,e){return tp((0,_.m9)(n),e)})).apply(this,arguments)}function Ru(){return(Ru=(0,d.Z)(function*(n,e){return pt(n,"POST","/v1/accounts:signInWithCustomToken",te(n,e))})).apply(this,arguments)}function Pu(){return Pu=(0,d.Z)(function*(n,e){const t=re(n),r=yield function FE(n,e){return Ru.apply(this,arguments)}(t,{token:e,returnSecureToken:!0}),i=yield $e._fromIdTokenResponse(t,"signIn",r);return yield t._updateCurrentUser(i.user),i}),Pu.apply(this,arguments)}class jr{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Su._fromServerResponse(e,t):"totpInfo"in t?bu._fromServerResponse(e,t):me(e,"internal-error")}}class Su extends jr{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Su(t)}}class bu extends jr{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new bu(t)}}function Qn(n,e,t){var r;T((null===(r=t.url)||void 0===r?void 0:r.length)>0,n,"invalid-continue-uri"),T(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(T(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(T(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}function Cu(){return Cu=(0,d.Z)(function*(n,e,t){var r;const i=re(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};if(null!==(r=i._getRecaptchaConfig())&&void 0!==r&&r.emailPasswordEnabled){const o=yield Ot(i,s,"getOobCode",!0);t&&Qn(i,o,t),yield tu(i,o)}else t&&Qn(i,s,t),yield tu(i,s).catch(function(){var o=(0,d.Z)(function*(a){if("auth/missing-recaptcha-token"!==a.code)return Promise.reject(a);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const u=yield Ot(i,s,"getOobCode",!0);t&&Qn(i,u,t),yield tu(i,u)}});return function(a){return o.apply(this,arguments)}}())}),Cu.apply(this,arguments)}function xu(){return(xu=(0,d.Z)(function*(n,e,t){yield $f((0,_.m9)(n),{oobCode:e,newPassword:t})})).apply(this,arguments)}function ku(){return ku=(0,d.Z)(function*(n,e){yield function EE(n,e){return Qa.apply(this,arguments)}((0,_.m9)(n),{oobCode:e})}),ku.apply(this,arguments)}function sp(n,e){return Du.apply(this,arguments)}function Du(){return(Du=(0,d.Z)(function*(n,e){const t=(0,_.m9)(n),r=yield $f(t,{oobCode:e}),i=r.requestType;switch(T(i,t,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":T(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":T(r.mfaInfo,t,"internal-error");default:T(r.email,t,"internal-error")}let s=null;return r.mfaInfo&&(s=jr._fromServerResponse(re(t),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}})).apply(this,arguments)}function Nu(){return(Nu=(0,d.Z)(function*(n,e){const{data:t}=yield sp((0,_.m9)(n),e);return t.email})).apply(this,arguments)}function Vu(){return Vu=(0,d.Z)(function*(n,e,t){var r;const i=re(n),s={returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"};let o;if(null!==(r=i._getRecaptchaConfig())&&void 0!==r&&r.emailPasswordEnabled){const c=yield Ot(i,s,"signUpPassword");o=Ts(i,c)}else o=Ts(i,s).catch(function(){var c=(0,d.Z)(function*(l){if("auth/missing-recaptcha-token"===l.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const h=yield Ot(i,s,"signUpPassword");return Ts(i,h)}return Promise.reject(l)});return function(l){return c.apply(this,arguments)}}());const a=yield o.catch(c=>Promise.reject(c)),u=yield $e._fromIdTokenResponse(i,"signIn",a);return yield i._updateCurrentUser(u.user),u}),Vu.apply(this,arguments)}function Ou(){return Ou=(0,d.Z)(function*(n,e,t){var r;const i=re(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function o(a,u){T(u.handleCodeInApp,i,"argument-error"),u&&Qn(i,a,u)}if(null!==(r=i._getRecaptchaConfig())&&void 0!==r&&r.emailPasswordEnabled){const a=yield Ot(i,s,"getOobCode",!0);o(a,t),yield ru(i,a)}else o(s,t),yield ru(i,s).catch(function(){var a=(0,d.Z)(function*(u){if("auth/missing-recaptcha-token"!==u.code)return Promise.reject(u);{console.log("Email link sign-in is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const c=yield Ot(i,s,"getOobCode",!0);o(c,t),yield ru(i,c)}});return function(u){return a.apply(this,arguments)}}())}),Ou.apply(this,arguments)}function Lu(){return(Lu=(0,d.Z)(function*(n,e,t){const r=(0,_.m9)(n),i=fu.credentialWithLink(e,t||Fr());return T(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Rs(r,i)})).apply(this,arguments)}function Mu(){return(Mu=(0,d.Z)(function*(n,e){return ne(n,"POST","/v1/accounts:createAuthUri",te(n,e))})).apply(this,arguments)}function Fu(){return Fu=(0,d.Z)(function*(n,e){const r={identifier:e,continueUri:Ca()?Fr():"http://localhost"},{signinMethods:i}=yield function HE(n,e){return Mu.apply(this,arguments)}((0,_.m9)(n),r);return i||[]}),Fu.apply(this,arguments)}function Uu(){return Uu=(0,d.Z)(function*(n,e){const t=(0,_.m9)(n),i={requestType:"VERIFY_EMAIL",idToken:yield n.getIdToken()};e&&Qn(t.auth,i,e);const{email:s}=yield function TE(n,e){return eu.apply(this,arguments)}(t.auth,i);s!==n.email&&(yield n.reload())}),Uu.apply(this,arguments)}function Bu(){return Bu=(0,d.Z)(function*(n,e,t){const r=(0,_.m9)(n),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield n.getIdToken(),newEmail:e};t&&Qn(r.auth,s,t);const{email:o}=yield function AE(n,e){return su.apply(this,arguments)}(r.auth,s);o!==n.email&&(yield n.reload())}),Bu.apply(this,arguments)}function qu(){return(qu=(0,d.Z)(function*(n,e){return ne(n,"POST","/v1/accounts:update",e)})).apply(this,arguments)}function Gu(){return Gu=(0,d.Z)(function*(n,{displayName:e,photoURL:t}){if(void 0===e&&void 0===t)return;const r=(0,_.m9)(n),s={idToken:yield r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=yield mt(r,function XE(n,e){return qu.apply(this,arguments)}(r.auth,s));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:u})=>"password"===u);a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),yield r._updateTokensIfNecessary(o)}),Gu.apply(this,arguments)}function op(n,e,t){return zu.apply(this,arguments)}function zu(){return(zu=(0,d.Z)(function*(n,e,t){const{auth:r}=n,s={idToken:yield n.getIdToken(),returnSecureToken:!0};e&&(s.email=e),t&&(s.password=t);const o=yield mt(n,jf(r,s));yield n._updateTokensIfNecessary(o,!0)})).apply(this,arguments)}class Yn{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class ap extends Yn{constructor(e,t,r,i){super(e,t,r),this.username=i}}class iT extends Yn{constructor(e,t){super(e,"facebook.com",t)}}class sT extends ap{constructor(e,t){super(e,"github.com",t,"string"==typeof t?.login?t?.login:null)}}class oT extends Yn{constructor(e,t){super(e,"google.com",t)}}class aT extends ap{constructor(e,t,r){super(e,"twitter.com",t,r)}}function uT(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:function rT(n){var e,t;if(!n)return null;const{providerId:r}=n,i=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},s=n.isNewUser||"identitytoolkit#SignupNewUserResponse"===n.kind;if(!r&&n?.idToken){const o=null===(t=null===(e=Is(n.idToken))||void 0===e?void 0:e.firebase)||void 0===t?void 0:t.sign_in_provider;if(o)return new Yn(s,"anonymous"!==o&&"custom"!==o?o:null)}if(!r)return null;switch(r){case"facebook.com":return new iT(s,i);case"github.com":return new sT(s,i);case"google.com":return new oT(s,i);case"twitter.com":return new aT(s,i,n.screenName||null);case"custom":case"anonymous":return new Yn(s,null);default:return new Yn(s,r,i)}}(t)}class fn{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new fn("enroll",e,t)}static _fromMfaPendingCredential(e){return new fn("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e?.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return fn._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(r=e.multiFactorSession)&&void 0!==r&&r.idToken)return fn._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Ku{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=re(e),i=t.customData._serverResponse,s=(i.mfaInfo||[]).map(a=>jr._fromServerResponse(r,a));T(i.mfaPendingCredential,r,"internal-error");const o=fn._fromMfaPendingCredential(i.mfaPendingCredential);return new Ku(o,s,function(){var a=(0,d.Z)(function*(u){const c=yield u._process(r,o);delete i.mfaInfo,delete i.mfaPendingCredential;const l=Object.assign(Object.assign({},i),{idToken:c.idToken,refreshToken:c.refreshToken});switch(t.operationType){case"signIn":const h=yield $e._fromIdTokenResponse(r,t.operationType,l);return yield r._updateCurrentUser(h.user),h;case"reauthenticate":return T(t.user,r,"internal-error"),$e._forOperation(t.user,t.operationType,l);default:me(r,"internal-error")}});return function(u){return a.apply(this,arguments)}}())}resolveSignIn(e){var t=this;return(0,d.Z)(function*(){return t.signInResolver(e)})()}}class $u{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>jr._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new $u(e)}getSession(){var e=this;return(0,d.Z)(function*(){return fn._fromIdtoken(yield e.user.getIdToken(),e.user)})()}enroll(e,t){var r=this;return(0,d.Z)(function*(){const i=e,s=yield r.getSession(),o=yield mt(r.user,i._process(r.user.auth,s,t));return yield r.user._updateTokensIfNecessary(o),r.user.reload()})()}unenroll(e){var t=this;return(0,d.Z)(function*(){const r="string"==typeof e?e:e.uid,i=yield t.user.getIdToken();try{const s=yield mt(t.user,function mT(n,e){return ne(n,"POST","/v2/accounts/mfaEnrollment:withdraw",te(n,e))}(t.user.auth,{idToken:i,mfaEnrollmentId:r}));t.enrolledFactors=t.enrolledFactors.filter(({uid:o})=>o!==r),yield t.user._updateTokensIfNecessary(s),yield t.user.reload()}catch(s){throw s}})()}}const ju=new WeakMap,Ps="__sak";class up{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ps,"1"),this.storage.removeItem(Ps),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Ss=(()=>{class n extends up{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function _T(){const n=(0,_.z$)();return za(n)||Kn(n)}()&&function cE(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=Vf(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const r of Object.keys(this.listeners)){const i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key)return void this.forAllChangedKeys((a,u,c)=>{this.notifyListeners(a,c)});const i=t.key;if(r?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const a=this.storage.getItem(i);if(t.newValue!==a)null!==t.newValue?this.storage.setItem(i,t.newValue):this.storage.removeItem(i);else if(this.localCache[i]===t.newValue&&!r)return}const s=()=>{const a=this.storage.getItem(i);!r&&this.localCache[i]===a||this.notifyListeners(i,a)},o=this.storage.getItem(i);!function uE(){return(0,_.w1)()&&10===document.documentMode}()||o===t.newValue||t.newValue===t.oldValue?s():setTimeout(s,10)}notifyListeners(t,r){this.localCache[t]=r;const i=this.listeners[t];if(i)for(const s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(t,r){var i=()=>super._set,s=this;return(0,d.Z)(function*(){yield i().call(s,t,r),s.localCache[t]=JSON.stringify(r)})()}_get(t){var r=()=>super._get,i=this;return(0,d.Z)(function*(){const s=yield r().call(i,t);return i.localCache[t]=JSON.stringify(s),s})()}_remove(t){var r=()=>super._remove,i=this;return(0,d.Z)(function*(){yield r().call(i,t),delete i.localCache[t]})()}}return n.type="LOCAL",n})(),Lt=(()=>{class n extends up{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})();let ET=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;const i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){var r=this;return(0,d.Z)(function*(){const i=t,{eventId:s,eventType:o,data:a}=i.data,u=r.handlersMap[o];if(!u?.size)return;i.ports[0].postMessage({status:"ack",eventId:s,eventType:o});const c=Array.from(u).map(function(){var h=(0,d.Z)(function*(f){return f(i.origin,a)});return function(f){return h.apply(this,arguments)}}()),l=yield function vT(n){return Promise.all(n.map(function(){var e=(0,d.Z)(function*(t){try{return{fulfilled:!0,value:yield t}}catch(r){return{fulfilled:!1,reason:r}}});return function(t){return e.apply(this,arguments)}}()))}(c);i.ports[0].postMessage({status:"done",eventId:s,eventType:o,response:l})})()}_subscribe(t,r){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||0===this.handlersMap[t].size)&&delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return n.receivers=[],n})();function Zr(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(10*Math.random());return n+t}class TT{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){var i=this;return(0,d.Z)(function*(){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((u,c)=>{const l=Zr("",20);s.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(f){const p=f;if(p.data.eventId===l)switch(p.data.status){case"ack":clearTimeout(h),o=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(p.data.response);break;default:clearTimeout(h),clearTimeout(o),c(new Error("invalid_response"))}}},i.handlers.add(a),s.port1.addEventListener("message",a.onMessage),i.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{a&&i.removeMessageHandler(a)})})()}}function le(){return window}function Zu(){return typeof le().WorkerGlobalScope<"u"&&"function"==typeof le().importScripts}function Hu(){return(Hu=(0,d.Z)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const cp="firebaseLocalStorageDb",bs="firebaseLocalStorage",lp="fbase_key";class Hr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Cs(n,e){return n.transaction([bs],e?"readwrite":"readonly").objectStore(bs)}function Qu(){const n=indexedDB.open(cp,1);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(bs,{keyPath:lp})}catch(i){t(i)}}),n.addEventListener("success",(0,d.Z)(function*(){const r=n.result;r.objectStoreNames.contains(bs)?e(r):(r.close(),yield function bT(){const n=indexedDB.deleteDatabase(cp);return new Hr(n).toPromise()}(),e(yield Qu()))}))})}function hp(n,e,t){return Yu.apply(this,arguments)}function Yu(){return(Yu=(0,d.Z)(function*(n,e,t){const r=Cs(n,!0).put({[lp]:e,value:t});return new Hr(r).toPromise()})).apply(this,arguments)}function Ju(){return(Ju=(0,d.Z)(function*(n,e){const t=Cs(n,!1).get(e),r=yield new Hr(t).toPromise();return void 0===r?null:r.value})).apply(this,arguments)}function dp(n,e){const t=Cs(n,!0).delete(e);return new Hr(t).toPromise()}const Jn=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var t=this;return(0,d.Z)(function*(){return t.db||(t.db=yield Qu()),t.db})()}_withRetries(t){var r=this;return(0,d.Z)(function*(){let i=0;for(;;)try{const s=yield r._openDb();return yield t(s)}catch(s){if(i++>3)throw s;r.db&&(r.db.close(),r.db=void 0)}})()}initializeServiceWorkerMessaging(){var t=this;return(0,d.Z)(function*(){return Zu()?t.initializeReceiver():t.initializeSender()})()}initializeReceiver(){var t=this;return(0,d.Z)(function*(){t.receiver=ET._getInstance(function PT(){return Zu()?self:null}()),t.receiver._subscribe("keyChanged",function(){var r=(0,d.Z)(function*(i,s){return{keyProcessed:(yield t._poll()).includes(s.key)}});return function(i,s){return r.apply(this,arguments)}}()),t.receiver._subscribe("ping",function(){var r=(0,d.Z)(function*(i,s){return["keyChanged"]});return function(i,s){return r.apply(this,arguments)}}())})()}initializeSender(){var t=this;return(0,d.Z)(function*(){var r,i;if(t.activeServiceWorker=yield function wT(){return Hu.apply(this,arguments)}(),!t.activeServiceWorker)return;t.sender=new TT(t.activeServiceWorker);const s=yield t.sender._send("ping",{},800);s&&null!==(r=s[0])&&void 0!==r&&r.fulfilled&&null!==(i=s[0])&&void 0!==i&&i.value.includes("keyChanged")&&(t.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(t){var r=this;return(0,d.Z)(function*(){if(r.sender&&r.activeServiceWorker&&function RT(){var n;return(null===(n=navigator?.serviceWorker)||void 0===n?void 0:n.controller)||null}()===r.activeServiceWorker)try{yield r.sender._send("keyChanged",{key:t},r.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,d.Z)(function*(){try{if(!indexedDB)return!1;const t=yield Qu();return yield hp(t,Ps,"1"),yield dp(t,Ps),!0}catch{}return!1})()}_withPendingWrite(t){var r=this;return(0,d.Z)(function*(){r.pendingWrites++;try{yield t()}finally{r.pendingWrites--}})()}_set(t,r){var i=this;return(0,d.Z)(function*(){return i._withPendingWrite((0,d.Z)(function*(){return yield i._withRetries(s=>hp(s,t,r)),i.localCache[t]=r,i.notifyServiceWorker(t)}))})()}_get(t){var r=this;return(0,d.Z)(function*(){const i=yield r._withRetries(s=>function CT(n,e){return Ju.apply(this,arguments)}(s,t));return r.localCache[t]=i,i})()}_remove(t){var r=this;return(0,d.Z)(function*(){return r._withPendingWrite((0,d.Z)(function*(){return yield r._withRetries(i=>dp(i,t)),delete r.localCache[t],r.notifyServiceWorker(t)}))})()}_poll(){var t=this;return(0,d.Z)(function*(){const r=yield t._withRetries(o=>{const a=Cs(o,!1).getAll();return new Hr(a).toPromise()});if(!r)return[];if(0!==t.pendingWrites)return[];const i=[],s=new Set;for(const{fbase_key:o,value:a}of r)s.add(o),JSON.stringify(t.localCache[o])!==JSON.stringify(a)&&(t.notifyListeners(o,a),i.push(o));for(const o of Object.keys(t.localCache))t.localCache[o]&&!s.has(o)&&(t.notifyListeners(o,null),i.push(o));return i})()}notifyListeners(t,r){this.localCache[t]=r;const i=this.listeners[t];if(i)for(const s of Array.from(i))s(r)}startPolling(){var t=this;this.stopPolling(),this.pollTimer=setInterval((0,d.Z)(function*(){return t._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return n.type="LOCAL",n})(),xs=1e12;class MT{constructor(e){this.auth=e,this.counter=xs,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new FT(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||xs;null===(t=this._widgets.get(r))||void 0===t||t.delete(),this._widgets.delete(r)}getResponse(e){var t;return(null===(t=this._widgets.get(e||xs))||void 0===t?void 0:t.getResponse())||""}execute(e){var t=this;return(0,d.Z)(function*(){var r;return null===(r=t._widgets.get(e||xs))||void 0===r||r.execute(),""})()}}class FT{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const i="string"==typeof e?document.getElementById(e):e;T(i,"argument-error",{appName:t}),this.container=i,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function UT(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(62*Math.random())));return e.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Xu=Bf("rcb"),BT=new Ur(3e4,6e4);class GT{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(e=le().grecaptcha)||void 0===e||!e.render)}load(e,t=""){return T(function zT(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&Mf(le().grecaptcha)?Promise.resolve(le().grecaptcha):new Promise((r,i)=>{const s=le().setTimeout(()=>{i(Ee(e,"network-request-failed"))},BT.get());le()[Xu]=()=>{le().clearTimeout(s),delete le()[Xu];const a=le().grecaptcha;if(!a||!Mf(a))return void i(Ee(e,"internal-error"));const u=a.render;a.render=(c,l)=>{const h=u(c,l);return this.counter++,h},this.hostLanguage=t,r(a)},$a(`https://www.google.com/recaptcha/api.js??${(0,_.xO)({onload:Xu,render:"explicit",hl:t})}`).catch(()=>{clearTimeout(s),i(Ee(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null===(t=le().grecaptcha)||void 0===t||!t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class WT{load(e){return(0,d.Z)(function*(){return new MT(e)})()}clearedOneInstance(){}}const fp="recaptcha",KT={theme:"light",type:"image"};class $T{constructor(e,t,r=Object.assign({},KT)){this.parameters=r,this.type=fp,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=re(e),this.isInvisible="invisible"===this.parameters.size,T(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const i="string"==typeof t?document.getElementById(t):t;T(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new WT:new GT,this.validateStartingState()}verify(){var e=this;return(0,d.Z)(function*(){e.assertNotDestroyed();const t=yield e.render(),r=e.getAssertedRecaptcha();return r.getResponse(t)||new Promise(s=>{const o=a=>{a&&(e.tokenChangeListeners.delete(o),s(a))};e.tokenChangeListeners.add(o),e.isInvisible&&r.execute(t)})})()}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){T(!this.parameters.sitekey,this.auth,"argument-error"),T(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),T(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),"function"==typeof e)e(t);else if("string"==typeof e){const r=le()[e];"function"==typeof r&&r(t)}}}assertNotDestroyed(){T(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var e=this;return(0,d.Z)(function*(){if(yield e.init(),!e.widgetId){let t=e.container;if(!e.isInvisible){const r=document.createElement("div");t.appendChild(r),t=r}e.widgetId=e.getAssertedRecaptcha().render(t,e.parameters)}return e.widgetId})()}init(){var e=this;return(0,d.Z)(function*(){T(Ca()&&!Zu(),e.auth,"internal-error"),yield function jT(){let n=null;return new Promise(e=>{"complete"!==document.readyState?(n=()=>e(),window.addEventListener("load",n)):e()}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}(),e.recaptcha=yield e._recaptchaLoader.load(e.auth,e.auth.languageCode||void 0);const t=yield function lE(n){return Wa.apply(this,arguments)}(e.auth);T(t,e.auth,"internal-error"),e.parameters.sitekey=t})()}getAssertedRecaptcha(){return T(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class ec{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=dn._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}function pp(n,e,t){return tc.apply(this,arguments)}function tc(){return(tc=(0,d.Z)(function*(n,e,t){const r=re(n),i=yield ks(r,e,(0,_.m9)(t));return new ec(i,s=>Rs(r,s))})).apply(this,arguments)}function nc(){return(nc=(0,d.Z)(function*(n,e,t){const r=(0,_.m9)(n);yield ws(!1,r,"phone");const i=yield ks(r.auth,e,(0,_.m9)(t));return new ec(i,s=>rp(r,s))})).apply(this,arguments)}function rc(){return(rc=(0,d.Z)(function*(n,e,t){const r=(0,_.m9)(n),i=yield ks(r.auth,e,(0,_.m9)(t));return new ec(i,s=>ip(r,s))})).apply(this,arguments)}function ks(n,e,t){return ic.apply(this,arguments)}function ic(){return ic=(0,d.Z)(function*(n,e,t){var r;const i=yield t.verify();try{let s;if(T("string"==typeof i,n,"argument-error"),T(t.type===fp,n,"argument-error"),s="string"==typeof e?{phoneNumber:e}:e,"session"in s){const o=s.session;if("phoneNumber"in s)return T("enroll"===o.type,n,"internal-error"),(yield function dT(n,e){return ne(n,"POST","/v2/accounts/mfaEnrollment:start",te(n,e))}(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}})).phoneSessionInfo.sessionInfo;{T("signin"===o.type,n,"internal-error");const a=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;return T(a,n,"missing-multi-factor-info"),(yield function DT(n,e){return ne(n,"POST","/v2/accounts/mfaSignIn:start",te(n,e))}(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:i}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:o}=yield function SE(n,e){return cu.apply(this,arguments)}(n,{phoneNumber:s.phoneNumber,recaptchaToken:i});return o}}finally{t._reset()}}),ic.apply(this,arguments)}function sc(){return(sc=(0,d.Z)(function*(n,e){yield _u((0,_.m9)(n),e)})).apply(this,arguments)}let Qr=(()=>{class n{constructor(t){this.providerId=n.PROVIDER_ID,this.auth=re(t)}verifyPhoneNumber(t,r){return ks(this.auth,t,(0,_.m9)(r))}static credential(t,r){return dn._fromVerification(t,r)}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:r,temporaryProof:i}=t;return r&&i?dn._fromTokenResponse(r,i):null}}return n.PROVIDER_ID="phone",n.PHONE_SIGN_IN_METHOD="phone",n})();function pn(n,e){return e?qe(e):(T(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class oc extends $n{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return gt(e,this._buildIdpRequest())}_linkToIdToken(e,t){return gt(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return gt(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function YT(n){return np(n.auth,new oc(n),n.bypassAuthState)}function JT(n){const{auth:e,user:t}=n;return T(t,e,"internal-error"),tp(t,new oc(n),n.bypassAuthState)}function XT(n){return ac.apply(this,arguments)}function ac(){return(ac=(0,d.Z)(function*(n){const{auth:e,user:t}=n;return T(t,e,"internal-error"),_u(t,new oc(n),n.bypassAuthState)})).apply(this,arguments)}class mp{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){var e=this;return new Promise(function(){var t=(0,d.Z)(function*(r,i){e.pendingPromise={resolve:r,reject:i};try{e.eventManager=yield e.resolver._initialize(e.auth),yield e.onExecution(),e.eventManager.registerConsumer(e)}catch(s){e.reject(s)}});return function(r,i){return t.apply(this,arguments)}}())}onAuthEvent(e){var t=this;return(0,d.Z)(function*(){const{urlResponse:r,sessionId:i,postBody:s,tenantId:o,error:a,type:u}=e;if(a)return void t.reject(a);const c={auth:t.auth,requestUri:r,sessionId:i,tenantId:o||void 0,postBody:s||void 0,user:t.user,bypassAuthState:t.bypassAuthState};try{t.resolve(yield t.getIdpTask(u)(c))}catch(l){t.reject(l)}})()}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return YT;case"linkViaPopup":case"linkViaRedirect":return XT;case"reauthViaPopup":case"reauthViaRedirect":return JT;default:me(this.auth,"internal-error")}}resolve(e){Ye(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ye(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const eA=new Ur(2e3,1e4);function uc(){return(uc=(0,d.Z)(function*(n,e,t){const r=re(n);Gn(n,e,_t);const i=pn(r,t);return new hc(r,"signInViaPopup",e,i).executeNotNull()})).apply(this,arguments)}function cc(){return(cc=(0,d.Z)(function*(n,e,t){const r=(0,_.m9)(n);Gn(r.auth,e,_t);const i=pn(r.auth,t);return new hc(r.auth,"reauthViaPopup",e,i,r).executeNotNull()})).apply(this,arguments)}function lc(){return(lc=(0,d.Z)(function*(n,e,t){const r=(0,_.m9)(n);Gn(r.auth,e,_t);const i=pn(r.auth,t);return new hc(r.auth,"linkViaPopup",e,i,r).executeNotNull()})).apply(this,arguments)}let hc=(()=>{class n extends mp{constructor(t,r,i,s,o){super(t,r,s,o),this.provider=i,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){var t=this;return(0,d.Z)(function*(){const r=yield t.execute();return T(r,t.auth,"internal-error"),r})()}onExecution(){var t=this;return(0,d.Z)(function*(){Ye(1===t.filter.length,"Popup operations only handle one event");const r=Zr();t.authWindow=yield t.resolver._openPopup(t.auth,t.provider,t.filter[0],r),t.authWindow.associatedEvent=r,t.resolver._originValidation(t.auth).catch(i=>{t.reject(i)}),t.resolver._isIframeWebStorageSupported(t.auth,i=>{i||t.reject(Ee(t.auth,"web-storage-unsupported"))}),t.pollUserCancellation()})()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(Ee(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){const t=()=>{var r,i;this.pollId=null!==(i=null===(r=this.authWindow)||void 0===r?void 0:r.window)&&void 0!==i&&i.closed?window.setTimeout(()=>{this.pollId=null,this.reject(Ee(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(t,eA.get())};t()}}return n.currentPopupAction=null,n})();const iA="pendingRedirect",Yr=new Map;class sA extends mp{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){var e=()=>super.execute,t=this;return(0,d.Z)(function*(){let r=Yr.get(t.auth._key());if(!r){try{const s=(yield function oA(n,e){return dc.apply(this,arguments)}(t.resolver,t.auth))?yield e().call(t):null;r=()=>Promise.resolve(s)}catch(i){r=()=>Promise.reject(i)}Yr.set(t.auth._key(),r)}return t.bypassAuthState||Yr.set(t.auth._key(),()=>Promise.resolve(null)),r()})()}onAuthEvent(e){var t=()=>super.onAuthEvent,r=this;return(0,d.Z)(function*(){if("signInViaRedirect"===e.type)return t().call(r,e);if("unknown"!==e.type){if(e.eventId){const i=yield r.auth._redirectUserForId(e.eventId);if(i)return r.user=i,t().call(r,e);r.resolve(null)}}else r.resolve(null)})()}onExecution(){return(0,d.Z)(function*(){})()}cleanUp(){}}function dc(){return(dc=(0,d.Z)(function*(n,e){const t=_p(e),r=gp(n);if(!(yield r._isAvailable()))return!1;const i="true"===(yield r._get(t));return yield r._remove(t),i})).apply(this,arguments)}function fc(n,e){return pc.apply(this,arguments)}function pc(){return(pc=(0,d.Z)(function*(n,e){return gp(n)._set(_p(e),"true")})).apply(this,arguments)}function mc(n,e){Yr.set(n._key(),e)}function gp(n){return qe(n._redirectPersistence)}function _p(n){return hn(iA,n.config.apiKey,n.name)}function uA(n,e,t){return function cA(n,e,t){return gc.apply(this,arguments)}(n,e,t)}function gc(){return(gc=(0,d.Z)(function*(n,e,t){const r=re(n);Gn(n,e,_t),yield r._initializationPromise;const i=pn(r,t);return yield fc(i,r),i._openRedirect(r,e,"signInViaRedirect")})).apply(this,arguments)}function lA(n,e,t){return function hA(n,e,t){return _c.apply(this,arguments)}(n,e,t)}function _c(){return(_c=(0,d.Z)(function*(n,e,t){const r=(0,_.m9)(n);Gn(r.auth,e,_t),yield r.auth._initializationPromise;const i=pn(r.auth,t);yield fc(i,r.auth);const s=yield yp(r);return i._openRedirect(r.auth,e,"reauthViaRedirect",s)})).apply(this,arguments)}function dA(n,e,t){return function fA(n,e,t){return yc.apply(this,arguments)}(n,e,t)}function yc(){return(yc=(0,d.Z)(function*(n,e,t){const r=(0,_.m9)(n);Gn(r.auth,e,_t),yield r.auth._initializationPromise;const i=pn(r.auth,t);yield ws(!1,r,e.providerId),yield fc(i,r.auth);const s=yield yp(r);return i._openRedirect(r.auth,e,"linkViaRedirect",s)})).apply(this,arguments)}function Ic(){return(Ic=(0,d.Z)(function*(n,e){return yield re(n)._initializationPromise,Ds(n,e,!1)})).apply(this,arguments)}function Ds(n,e){return vc.apply(this,arguments)}function vc(){return(vc=(0,d.Z)(function*(n,e,t=!1){const r=re(n),i=pn(r,e),o=yield new sA(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield r._persistUserIfCurrent(o.user),yield r._setRedirectUser(null,e)),o})).apply(this,arguments)}function yp(n){return Ec.apply(this,arguments)}function Ec(){return(Ec=(0,d.Z)(function*(n){const e=Zr(`${n.uid}:::`);return n._redirectEventId=e,yield n.auth._setRedirectUser(n),yield n.auth._persistUserIfCurrent(n),e})).apply(this,arguments)}class Ip{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function gA(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ep(n);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Ep(e)){const i=(null===(r=e.error.code)||void 0===r?void 0:r.split("auth/")[1])||"internal-error";t.onError(Ee(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(vp(e))}saveEventToCache(e){this.cachedEventUids.add(vp(e)),this.lastProcessedEventTime=Date.now()}}function vp(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Ep({type:n,error:e}){return"unknown"===n&&"auth/no-auth-event"===e?.code}function Tp(n){return Tc.apply(this,arguments)}function Tc(){return(Tc=(0,d.Z)(function*(n,e={}){return ne(n,"GET","/v1/projects",e)})).apply(this,arguments)}const _A=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yA=/^https?/;function Ac(){return(Ac=(0,d.Z)(function*(n){if(n.config.emulator)return;const{authorizedDomains:e}=yield Tp(n);for(const t of e)try{if(vA(t))return}catch{}me(n,"unauthorized-domain")})).apply(this,arguments)}function vA(n){const e=Fr(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return""===o.hostname&&""===r?"chrome-extension:"===t&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===t&&o.hostname===r}if(!yA.test(t))return!1;if(_A.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const EA=new Ur(3e4,6e4);function Ap(){const n=le().___jsl;if(n?.H)for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}let Ns=null;const wA=new Ur(5e3,15e3),RA="__/auth/iframe",PA="emulator/auth/iframe",SA={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bA=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function CA(n){const e=n.config;T(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?xa(e,PA):`https://${n.config.authDomain}/${RA}`,r={apiKey:e.apiKey,appName:n.name,v:Nt},i=bA.get(n.config.apiHost);i&&(r.eid=i);const s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${(0,_.xO)(r).slice(1)}`}function wc(){return wc=(0,d.Z)(function*(n){const e=yield function AA(n){return Ns=Ns||function TA(n){return new Promise((e,t)=>{var r,i,s;function o(){Ap(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ap(),t(Ee(n,"network-request-failed"))},timeout:EA.get()})}if(null!==(i=null===(r=le().gapi)||void 0===r?void 0:r.iframes)&&void 0!==i&&i.Iframe)e(gapi.iframes.getContext());else{if(null===(s=le().gapi)||void 0===s||!s.load){const a=Bf("iframefcb");return le()[a]=()=>{gapi.load?o():t(Ee(n,"network-request-failed"))},$a(`https://apis.google.com/js/api.js?onload=${a}`).catch(u=>t(u))}o()}}).catch(e=>{throw Ns=null,e})}(n),Ns}(n),t=le().gapi;return T(t,n,"internal-error"),e.open({where:document.body,url:CA(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:SA,dontclear:!0},r=>new Promise(function(){var i=(0,d.Z)(function*(s,o){yield r.restyle({setHideOnLeave:!1});const a=Ee(n,"network-request-failed"),u=le().setTimeout(()=>{o(a)},wA.get());function c(){le().clearTimeout(u),s(r)}r.ping(c).then(c,()=>{o(a)})});return function(s,o){return i.apply(this,arguments)}}()))}),wc.apply(this,arguments)}const kA={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class wp{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const FA="__/auth/handler",UA="emulator/auth/handler",BA=encodeURIComponent("fac");function Rc(n,e,t,r,i,s){return Pc.apply(this,arguments)}function Pc(){return(Pc=(0,d.Z)(function*(n,e,t,r,i,s){T(n.config.authDomain,n,"auth-domain-config-required"),T(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Nt,eventId:i};if(e instanceof _t){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",(0,_.xb)(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[l,h]of Object.entries(s||{}))o[l]=h}if(e instanceof jn){const l=e.getScopes().filter(h=>""!==h);l.length>0&&(o.scopes=l.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const l of Object.keys(a))void 0===a[l]&&delete a[l];const u=yield n._getAppCheckToken(),c=u?`#${BA}=${encodeURIComponent(u)}`:"";return`${function qA({config:n}){return n.emulator?xa(n,UA):`https://${n.authDomain}/${FA}`}(n)}?${(0,_.xO)(a).slice(1)}${c}`})).apply(this,arguments)}const Sc="webStorageSupport",Rp=class GA{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Lt,this._completeRedirectFn=Ds,this._overrideRedirectResult=mc}_openPopup(e,t,r,i){var s=this;return(0,d.Z)(function*(){var o;Ye(null===(o=s.eventManagers[e._key()])||void 0===o?void 0:o.manager,"_initialize() not called before _openPopup()");const a=yield Rc(e,t,r,Fr(),i);return function LA(n,e,t,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const u=Object.assign(Object.assign({},kA),{width:r.toString(),height:i.toString(),top:s,left:o}),c=(0,_.z$)().toLowerCase();t&&(a=xf(c)?"_blank":t),Cf(c)&&(e=e||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce((f,[p,v])=>`${f}${p}=${v},`,"");if(function aE(n=(0,_.z$)()){var e;return Kn(n)&&!(null===(e=window.navigator)||void 0===e||!e.standalone)}(c)&&"_self"!==a)return function MA(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}(e||"",a),new wp(null);const h=window.open(e||"",a,l);T(h,n,"popup-blocked");try{h.focus()}catch{}return new wp(h)}(e,a,Zr())})()}_openRedirect(e,t,r,i){var s=this;return(0,d.Z)(function*(){return yield s._originValidation(e),function AT(n){le().location.href=n}(yield Rc(e,t,r,Fr(),i)),new Promise(()=>{})})()}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Ye(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){var t=this;return(0,d.Z)(function*(){const r=yield function xA(n){return wc.apply(this,arguments)}(e),i=new Ip(e);return r.register("authEvent",s=>(T(s?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),t.eventManagers[e._key()]={manager:i},t.iframes[e._key()]=r,i})()}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Sc,{type:Sc},i=>{var s;const o=null===(s=i?.[0])||void 0===s?void 0:s[Sc];void 0!==o&&t(!!o),me(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function IA(n){return Ac.apply(this,arguments)}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Vf()||za()||Kn()}};class zA{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return nt("unexpected MultiFactorSessionType")}}}class bc extends zA{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new bc(e)}_finalizeEnroll(e,t,r){return function fT(n,e){return ne(n,"POST","/v2/accounts/mfaEnrollment:finalize",te(n,e))}(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function NT(n,e){return ne(n,"POST","/v2/accounts/mfaSignIn:finalize",te(n,e))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let WA=(()=>{class n{constructor(){}static assertion(t){return bc._fromCredential(t)}}return n.FACTOR_ID="phone",n})();var Sp="@firebase/auth";class KA{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){var t=this;return(0,d.Z)(function*(){return t.assertAuthConfigured(),yield t.auth._initializationPromise,t.auth.currentUser?{accessToken:yield t.auth.currentUser.getIdToken(e)}:null})()}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){T(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const HA=(0,_.Pz)("authIdTokenMaxAge")||300;let Cp=null;const QA=n=>function(){var e=(0,d.Z)(function*(t){const r=t&&(yield t.getIdTokenResult()),i=r&&((new Date).getTime()-Date.parse(r.issuedAtTime))/1e3;if(i&&i>HA)return;const s=r?.token;Cp!==s&&(Cp=s,yield fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))});return function(t){return e.apply(this,arguments)}}();function mn(){return window}!function jA(n){Dt(new Qe.wA("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;T(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Of(n)},c=new gE(r,i,s,u);return function yE(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(qe);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Dt(new Qe.wA("auth-internal",e=>{const t=re(e.getProvider("auth").getImmediate());return new KA(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),tt(Sp,"1.1.0",function $A(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(n)),tt(Sp,"1.1.0","esm2017")}("Browser");function xc(){return xc=(0,d.Z)(function*(n,e,t){var r;const{BuildInfo:i}=mn();Ye(e.sessionId,"AuthEvent did not contain a session ID");const s=yield function iw(n){return Nc.apply(this,arguments)}(e.sessionId),o={};return Kn()?o.ibi=i.packageName:Wr()?o.apn=i.packageName:me(n,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,Rc(n,t,e.type,void 0,null!==(r=e.eventId)&&void 0!==r?r:void 0,o)}),xc.apply(this,arguments)}function kc(){return(kc=(0,d.Z)(function*(n){const{BuildInfo:e}=mn(),t={};Kn()?t.iosBundleId=e.packageName:Wr()?t.androidPackageName=e.packageName:me(n,"operation-not-supported-in-this-environment"),yield Tp(n,t)})).apply(this,arguments)}function Dc(){return(Dc=(0,d.Z)(function*(n,e,t){const{cordova:r}=mn();let i=()=>{};try{yield new Promise((s,o)=>{let a=null;function u(){var h;s();const f=null===(h=r.plugins.browsertab)||void 0===h?void 0:h.close;"function"==typeof f&&f(),"function"==typeof t?.close&&t.close()}function c(){a||(a=window.setTimeout(()=>{o(Ee(n,"redirect-cancelled-by-user"))},2e3))}function l(){"visible"===document?.visibilityState&&c()}e.addPassiveListener(u),document.addEventListener("resume",c,!1),Wr()&&document.addEventListener("visibilitychange",l,!1),i=()=>{e.removePassiveListener(u),document.removeEventListener("resume",c,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}})}finally{i()}})).apply(this,arguments)}function Nc(){return(Nc=(0,d.Z)(function*(n){const e=function sw(n){if(Ye(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(n);const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}(n),t=yield crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class aw extends Ip{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}initialized(){var e=this;return(0,d.Z)(function*(){yield e.initPromise})()}}function xp(n){return Vc.apply(this,arguments)}function Vc(){return(Vc=(0,d.Z)(function*(n){const e=yield Oc()._get(Lc(n));return e&&(yield Oc()._remove(Lc(n))),e})).apply(this,arguments)}function hw(){const n=[];for(let t=0;t<20;t++){const r=Math.floor(62*Math.random());n.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(r))}return n.join("")}function Oc(){return qe(Ss)}function Lc(n){return hn("authEvent",n.config.apiKey,n.name)}function Os(n){if(!n?.includes("?"))return{};const[e,...t]=n.split("?");return(0,_.zd)(t.join("?"))}const gw=class mw{constructor(){this._redirectPersistence=Lt,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Ds,this._overrideRedirectResult=mc}_initialize(e){var t=this;return(0,d.Z)(function*(){const r=e._key();let i=t.eventManagers.get(r);return i||(i=new aw(e),t.eventManagers.set(r,i),t.attachCallbackListeners(e,i)),i})()}_openPopup(e){me(e,"operation-not-supported-in-this-environment")}_openRedirect(e,t,r,i){var s=this;return(0,d.Z)(function*(){!function rw(n){var e,t,r,i,s,o,a,u,c,l;const h=mn();T("function"==typeof(null===(e=h?.universalLinks)||void 0===e?void 0:e.subscribe),n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),T(typeof(null===(t=h?.BuildInfo)||void 0===t?void 0:t.packageName)<"u",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),T("function"==typeof(null===(s=null===(i=null===(r=h?.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),T("function"==typeof(null===(u=null===(a=null===(o=h?.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===u?void 0:u.isAvailable),n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),T("function"==typeof(null===(l=null===(c=h?.cordova)||void 0===c?void 0:c.InAppBrowser)||void 0===l?void 0:l.open),n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const o=yield s._initialize(e);yield o.initialized(),o.resetRedirect(),function aA(){Yr.clear()}(),yield s._originValidation(e);const a=function uw(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:hw(),postBody:null,tenantId:n.tenantId,error:Ee(n,"no-auth-event")}}(e,r,i);yield function cw(n,e){return Oc()._set(Lc(n),e)}(e,a);const u=yield function XA(n,e,t){return xc.apply(this,arguments)}(e,a,t),c=yield function tw(n){const{cordova:e}=mn();return new Promise(t=>{e.plugins.browsertab.isAvailable(r=>{let i=null;r?e.plugins.browsertab.openUrl(n):i=e.InAppBrowser.open(n,function oE(n=(0,_.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}()?"_blank":"_system","location=yes"),t(i)})})}(u);return function nw(n,e,t){return Dc.apply(this,arguments)}(e,o,c)})()}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function ew(n){return kc.apply(this,arguments)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:r,handleOpenURL:i,BuildInfo:s}=mn(),o=setTimeout((0,d.Z)(function*(){yield xp(e),t.onEvent(kp())}),500),a=function(){var l=(0,d.Z)(function*(h){clearTimeout(o);const f=yield xp(e);let p=null;f&&h?.url&&(p=function lw(n,e){var t,r;const i=function fw(n){const e=Os(n),t=e.link?decodeURIComponent(e.link):void 0,r=Os(t).link,i=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return Os(i).link||i||r||t||n}(e);if(i.includes("/__/auth/callback")){const s=Os(i),o=s.firebaseError?function dw(n){try{return JSON.parse(n)}catch{return null}}(decodeURIComponent(s.firebaseError)):null,a=null===(r=null===(t=o?.code)||void 0===t?void 0:t.split("auth/"))||void 0===r?void 0:r[1],u=a?Ee(a):null;return u?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:u,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:i,postBody:null}}return null}(f,h.url)),t.onEvent(p||kp())});return function(f){return l.apply(this,arguments)}}();typeof r<"u"&&"function"==typeof r.subscribe&&r.subscribe(null,a);const u=i,c=`${s.packageName.toLowerCase()}://`;mn().handleOpenURL=function(){var l=(0,d.Z)(function*(h){if(h.toLowerCase().startsWith(c)&&a({url:h}),"function"==typeof u)try{u(h)}catch(f){console.error(f)}});return function(h){return l.apply(this,arguments)}}()}};function kp(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Ee("no-auth-event")}}function Jr(){var n;return(null===(n=self?.location)||void 0===n?void 0:n.protocol)||null}function Dp(n=(0,_.z$)()){return!("file:"!==Jr()&&"ionic:"!==Jr()&&"capacitor:"!==Jr()||!n.toLowerCase().match(/iphone|ipad|ipod|android/))}function Np(){try{const n=self.localStorage,e=Zr();if(n)return n.setItem(e,"1"),n.removeItem(e),!function Rw(n=(0,_.z$)()){return function Aw(){return(0,_.w1)()&&11===document?.documentMode}()||function ww(n=(0,_.z$)()){return/Edge\/\d+/.test(n)}(n)}()||(0,_.hl)()}catch{return Mc()&&(0,_.hl)()}return!1}function Mc(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Fc(){return(function Ew(){return"http:"===Jr()||"https:"===Jr()}()||(0,_.ru)()||Dp())&&!function Tw(){return(0,_.b$)()||(0,_.UG)()}()&&Np()&&!Mc()}function Vp(){return Dp()&&typeof document<"u"}function Uc(){return(Uc=(0,d.Z)(function*(){return!!Vp()&&new Promise(n=>{const e=setTimeout(()=>{n(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})})})).apply(this,arguments)}const Ge={LOCAL:"local",NONE:"none",SESSION:"session"},Xr=T,Op="persistence";function Bc(n){return qc.apply(this,arguments)}function qc(){return(qc=(0,d.Z)(function*(n){yield n._initializationPromise;const e=Lp(),t=hn(Op,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistence())})).apply(this,arguments)}function Lp(){var n;try{return(null===(n=function Sw(){return typeof window<"u"?window:null}())||void 0===n?void 0:n.sessionStorage)||null}catch{return null}}const xw=T;class Mt{constructor(){this.browserResolver=qe(Rp),this.cordovaResolver=qe(gw),this.underlyingResolver=null,this._redirectPersistence=Lt,this._completeRedirectFn=Ds,this._overrideRedirectResult=mc}_initialize(e){var t=this;return(0,d.Z)(function*(){return yield t.selectUnderlyingResolver(),t.assertedUnderlyingResolver._initialize(e)})()}_openPopup(e,t,r,i){var s=this;return(0,d.Z)(function*(){return yield s.selectUnderlyingResolver(),s.assertedUnderlyingResolver._openPopup(e,t,r,i)})()}_openRedirect(e,t,r,i){var s=this;return(0,d.Z)(function*(){return yield s.selectUnderlyingResolver(),s.assertedUnderlyingResolver._openRedirect(e,t,r,i)})()}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Vp()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return xw(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var e=this;return(0,d.Z)(function*(){if(e.underlyingResolver)return;const t=yield function Pw(){return Uc.apply(this,arguments)}();e.underlyingResolver=t?e.cordovaResolver:e.browserResolver})()}}function Mp(n){return n.unwrap()}function Dw(n){return Fp(n)}function Fp(n){const{_tokenResponse:e}=n instanceof _.ZR?n.customData:n;if(!e)return null;if(!(n instanceof _.ZR)&&"temporaryProof"in e&&"phoneNumber"in e)return Qr.credentialFromResult(n);const t=e.providerId;if(!t||t===Mr.PASSWORD)return null;let r;switch(t){case Mr.GOOGLE:r=Hf;break;case Mr.FACEBOOK:r=Zf;break;case Mr.GITHUB:r=Qf;break;case Mr.TWITTER:r=Yf;break;default:const{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:u}=e;return s||o||i||a?a?t.startsWith("saml.")?Hn._create(t,a):rt._fromParams({providerId:t,signInMethod:t,pendingToken:a,idToken:i,accessToken:s}):new Zn(t).credential({idToken:i,accessToken:s,rawNonce:u}):null}return n instanceof _.ZR?r.credentialFromError(n):r.credentialFromResult(n)}function Fe(n,e){return e.catch(t=>{throw t instanceof _.ZR&&function Nw(n,e){var t;const r=null===(t=e.customData)||void 0===t?void 0:t._tokenResponse;if("auth/multi-factor-auth-required"===e?.code)e.resolver=new Vw(n,function hT(n,e){var t;const r=(0,_.m9)(n),i=e;return T(e.customData.operationType,r,"argument-error"),T(null===(t=i.customData._serverResponse)||void 0===t?void 0:t.mfaPendingCredential,r,"argument-error"),Ku._fromError(r,i)}(n,e));else if(r){const i=Fp(e),s=e;i&&(s.credential=i,s.tenantId=r.tenantId||void 0,s.email=r.email||void 0,s.phoneNumber=r.phoneNumber||void 0)}}(n,t),t}).then(t=>{const i=t.user;return{operationType:t.operationType,credential:Dw(t),additionalUserInfo:uT(t),user:yt.getOrCreate(i)}})}function Gc(n,e){return zc.apply(this,arguments)}function zc(){return(zc=(0,d.Z)(function*(n,e){const t=yield e;return{verificationId:t.verificationId,confirm:r=>Fe(n,t.confirm(r))}})).apply(this,arguments)}class Vw{constructor(e,t){this.resolver=t,this.auth=function kw(n){return n.wrapped()}(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Fe(Mp(this.auth),this.resolver.resolveSignIn(e))}}class yt{constructor(e){this._delegate=e,this.multiFactor=function gT(n){const e=(0,_.m9)(n);return ju.has(e)||ju.set(e,$u._fromUser(e)),ju.get(e)}(e)}static getOrCreate(e){return yt.USER_MAP.has(e)||yt.USER_MAP.set(e,new yt(e)),yt.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}linkWithCredential(e){var t=this;return(0,d.Z)(function*(){return Fe(t.auth,rp(t._delegate,e))})()}linkWithPhoneNumber(e,t){var r=this;return(0,d.Z)(function*(){return Gc(r.auth,function ZT(n,e,t){return nc.apply(this,arguments)}(r._delegate,e,t))})()}linkWithPopup(e){var t=this;return(0,d.Z)(function*(){return Fe(t.auth,function rA(n,e,t){return lc.apply(this,arguments)}(t._delegate,e,Mt))})()}linkWithRedirect(e){var t=this;return(0,d.Z)(function*(){return yield Bc(re(t.auth)),dA(t._delegate,e,Mt)})()}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}reauthenticateWithCredential(e){var t=this;return(0,d.Z)(function*(){return Fe(t.auth,ip(t._delegate,e))})()}reauthenticateWithPhoneNumber(e,t){return Gc(this.auth,function HT(n,e,t){return rc.apply(this,arguments)}(this._delegate,e,t))}reauthenticateWithPopup(e){return Fe(this.auth,function nA(n,e,t){return cc.apply(this,arguments)}(this._delegate,e,Mt))}reauthenticateWithRedirect(e){var t=this;return(0,d.Z)(function*(){return yield Bc(re(t.auth)),lA(t._delegate,e,Mt)})()}sendEmailVerification(e){return function YE(n,e){return Uu.apply(this,arguments)}(this._delegate,e)}unlink(e){var t=this;return(0,d.Z)(function*(){return yield function ME(n,e){return gu.apply(this,arguments)}(t._delegate,e),t})()}updateEmail(e){return function tT(n,e){return op((0,_.m9)(n),e,null)}(this._delegate,e)}updatePassword(e){return function nT(n,e){return op((0,_.m9)(n),null,e)}(this._delegate,e)}updatePhoneNumber(e){return function QT(n,e){return sc.apply(this,arguments)}(this._delegate,e)}updateProfile(e){return function eT(n,e){return Gu.apply(this,arguments)}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return function JE(n,e,t){return Bu.apply(this,arguments)}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}yt.USER_MAP=new WeakMap;const ei=T;let Up=(()=>{class n{constructor(t,r){if(this.app=t,r.isInitialized())return this._delegate=r.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:i}=t.options;ei(i,"invalid-api-key",{appName:t.name}),ei(i,"invalid-api-key",{appName:t.name});const s=typeof window<"u"?Mt:void 0;this._delegate=r.initialize({options:{persistence:Ow(i,t.name),popupRedirectResolver:s}}),this._delegate._updateErrorMap(qv),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?yt.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(t){this._delegate.languageCode=t}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(t){this._delegate.tenantId=t}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(t,r){zf(this._delegate,t,r)}applyActionCode(t){return function GE(n,e){return ku.apply(this,arguments)}(this._delegate,t)}checkActionCode(t){return sp(this._delegate,t)}confirmPasswordReset(t,r){return function qE(n,e,t){return xu.apply(this,arguments)}(this._delegate,t,r)}createUserWithEmailAndPassword(t,r){var i=this;return(0,d.Z)(function*(){return Fe(i._delegate,function WE(n,e,t){return Vu.apply(this,arguments)}(i._delegate,t,r))})()}fetchProvidersForEmail(t){return this.fetchSignInMethodsForEmail(t)}fetchSignInMethodsForEmail(t){return function QE(n,e){return Fu.apply(this,arguments)}(this._delegate,t)}isSignInWithEmailLink(t){return function jE(n,e){const t=$r.parseLink(e);return"EMAIL_SIGNIN"===t?.operation}(0,t)}getRedirectResult(){var t=this;return(0,d.Z)(function*(){ei(Fc(),t._delegate,"operation-not-supported-in-this-environment");const r=yield function pA(n,e){return Ic.apply(this,arguments)}(t._delegate,Mt);return r?Fe(t._delegate,Promise.resolve(r)):{credential:null,user:null}})()}addFrameworkForLogging(t){!function _w(n,e){re(n)._logFramework(e)}(this._delegate,t)}onAuthStateChanged(t,r,i){const{next:s,error:o,complete:a}=Bp(t,r,i);return this._delegate.onAuthStateChanged(s,o,a)}onIdTokenChanged(t,r,i){const{next:s,error:o,complete:a}=Bp(t,r,i);return this._delegate.onIdTokenChanged(s,o,a)}sendSignInLinkToEmail(t,r){return function $E(n,e,t){return Ou.apply(this,arguments)}(this._delegate,t,r)}sendPasswordResetEmail(t,r){return function BE(n,e,t){return Cu.apply(this,arguments)}(this._delegate,t,r||void 0)}setPersistence(t){var r=this;return(0,d.Z)(function*(){let i;switch(function bw(n,e){Xr(Object.values(Ge).includes(e),n,"invalid-persistence-type"),(0,_.b$)()?Xr(e!==Ge.SESSION,n,"unsupported-persistence-type"):(0,_.UG)()?Xr(e===Ge.NONE,n,"unsupported-persistence-type"):Mc()?Xr(e===Ge.NONE||e===Ge.LOCAL&&(0,_.hl)(),n,"unsupported-persistence-type"):Xr(e===Ge.NONE||Np(),n,"unsupported-persistence-type")}(r._delegate,t),t){case Ge.SESSION:i=Lt;break;case Ge.LOCAL:i=(yield qe(Jn)._isAvailable())?Jn:Ss;break;case Ge.NONE:i=zn;break;default:return me("argument-error",{appName:r._delegate.name})}return r._delegate.setPersistence(i)})()}signInAndRetrieveDataWithCredential(t){return this.signInWithCredential(t)}signInAnonymously(){return Fe(this._delegate,function LE(n){return mu.apply(this,arguments)}(this._delegate))}signInWithCredential(t){return Fe(this._delegate,Rs(this._delegate,t))}signInWithCustomToken(t){return Fe(this._delegate,function UE(n,e){return Pu.apply(this,arguments)}(this._delegate,t))}signInWithEmailAndPassword(t,r){return Fe(this._delegate,function KE(n,e,t){return Rs((0,_.m9)(n),fu.credential(e,t))}(this._delegate,t,r))}signInWithEmailLink(t,r){return Fe(this._delegate,function ZE(n,e,t){return Lu.apply(this,arguments)}(this._delegate,t,r))}signInWithPhoneNumber(t,r){return Gc(this._delegate,pp(this._delegate,t,r))}signInWithPopup(t){var r=this;return(0,d.Z)(function*(){return ei(Fc(),r._delegate,"operation-not-supported-in-this-environment"),Fe(r._delegate,function tA(n,e,t){return uc.apply(this,arguments)}(r._delegate,t,Mt))})()}signInWithRedirect(t){var r=this;return(0,d.Z)(function*(){return ei(Fc(),r._delegate,"operation-not-supported-in-this-environment"),yield Bc(r._delegate),uA(r._delegate,t,Mt)})()}updateCurrentUser(t){return this._delegate.updateCurrentUser(t)}verifyPasswordResetCode(t){return function zE(n,e){return Nu.apply(this,arguments)}(this._delegate,t)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return n.Persistence=Ge,n})();function Bp(n,e,t){let r=n;"function"!=typeof n&&({next:r,error:e,complete:t}=n);const i=r;return{next:o=>i(o&&yt.getOrCreate(o)),error:e,complete:t}}function Ow(n,e){const t=function Cw(n,e){const t=Lp();if(!t)return[];const r=hn(Op,n,e);switch(t.getItem(r)){case Ge.NONE:return[zn];case Ge.LOCAL:return[Jn,Lt];case Ge.SESSION:return[Lt];default:return[]}}(n,e);if(typeof self<"u"&&!t.includes(Jn)&&t.push(Jn),typeof window<"u")for(const r of[Ss,Lt])t.includes(r)||t.push(r);return t.includes(zn)||t.push(zn),t}class Wc{constructor(){this.providerId="phone",this._delegate=new Qr(Mp(cn.auth()))}static credential(e,t){return Qr.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Wc.PHONE_SIGN_IN_METHOD=Qr.PHONE_SIGN_IN_METHOD,Wc.PROVIDER_ID=Qr.PROVIDER_ID;const Lw=T;class Mw{constructor(e,t,r=cn.app()){var i;Lw(null===(i=r.options)||void 0===i?void 0:i.apiKey,"invalid-api-key",{appName:r.name}),this._delegate=new $T(r.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Uw(n){n.INTERNAL.registerComponent(new Qe.wA("auth-compat",e=>{const t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("auth");return new Up(t,r)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:fu,FacebookAuthProvider:Zf,GithubAuthProvider:Qf,GoogleAuthProvider:Hf,OAuthProvider:Zn,SAMLAuthProvider:Es,PhoneAuthProvider:Wc,PhoneMultiFactorGenerator:WA,RecaptchaVerifier:Mw,TwitterAuthProvider:Yf,Auth:Up,AuthCredential:$n,Error:_.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion("@firebase/auth-compat","0.4.4")}(cn);var S,Bw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Je={},Kc=Kc||{},O=Bw||self;function Ls(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function ti(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var $c="closure_uid_"+(1e9*Math.random()>>>0),Gw=0;function zw(n,e,t){return n.call.apply(n.bind,arguments)}function Ww(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function be(n,e,t){return(be=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?zw:Ww).apply(null,arguments)}function Ms(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ge(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Ft(){this.s=this.s,this.o=this.o}Ft.prototype.s=!1,Ft.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function qw(n){Object.prototype.hasOwnProperty.call(n,$c)&&n[$c]||(n[$c]=++Gw)}(this)},Ft.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const qp=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function jc(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Gp(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Ls(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Ce(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ce.prototype.h=function(){this.defaultPrevented=!0};var $w=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{O.addEventListener("test",()=>{},e),O.removeEventListener("test",()=>{},e)}catch{}return n}();function ni(n){return/^[\s\xa0]*$/.test(n)}function Fs(){var n=O.navigator;return n&&(n=n.userAgent)?n:""}function it(n){return-1!=Fs().indexOf(n)}function Zc(n){return Zc[" "](n),n}Zc[" "]=function(){};var Qc,n,Zw=it("Opera"),Xn=it("Trident")||it("MSIE"),zp=it("Edge"),Hc=zp||Xn,Wp=it("Gecko")&&!(-1!=Fs().toLowerCase().indexOf("webkit")&&!it("Edge"))&&!(it("Trident")||it("MSIE"))&&!it("Edge"),Hw=-1!=Fs().toLowerCase().indexOf("webkit")&&!it("Edge");function Kp(){var n=O.document;return n?n.documentMode:void 0}e:{var Yc="",Jc=(n=Fs(),Wp?/rv:([^\);]+)(\)|;)/.exec(n):zp?/Edge\/([\d\.]+)/.exec(n):Xn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):Hw?/WebKit\/(\S+)/.exec(n):Zw?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Jc&&(Yc=Jc?Jc[1]:""),Xn){var Xc=Kp();if(null!=Xc&&Xc>parseFloat(Yc)){Qc=String(Xc);break e}}Qc=Yc}var Qw=O.document&&Xn&&(Kp()||parseInt(Qc,10))||void 0;function ri(n,e){if(Ce.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Wp){e:{try{Zc(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Yw[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&ri.$.h.call(this)}}ge(ri,Ce);var Yw={2:"touch",3:"pen",4:"mouse"};ri.prototype.h=function(){ri.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var ii="closure_listenable_"+(1e6*Math.random()|0),Jw=0;function Xw(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++Jw,this.fa=this.ia=!1}function Us(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function tl(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function jp(n){const e={};for(const t in n)e[t]=n[t];return e}const Zp="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Hp(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<Zp.length;s++)t=Zp[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Bs(n){this.src=n,this.g={},this.h=0}function nl(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=qp(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Us(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function rl(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Bs.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=rl(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new Xw(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var il="closure_lm_"+(1e6*Math.random()|0),sl={};function Qp(n,e,t,r,i){if(r&&r.once)return Jp(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Qp(n,e[s],t,r,i);return null}return t=cl(t),n&&n[ii]?n.O(e,t,ti(r)?!!r.capture:!!r,i):Yp(n,e,t,!1,r,i)}function Yp(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=ti(i)?!!i.capture:!!i,a=al(n);if(a||(n[il]=a=new Bs(n)),(t=a.add(e,t,r,o,s)).proxy)return t;if(r=function t0(){const e=n0;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)$w||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(em(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Jp(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Jp(n,e[s],t,r,i);return null}return t=cl(t),n&&n[ii]?n.P(e,t,ti(r)?!!r.capture:!!r,i):Yp(n,e,t,!0,r,i)}function Xp(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Xp(n,e[s],t,r,i);else r=ti(r)?!!r.capture:!!r,t=cl(t),n&&n[ii]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=rl(s=n.g[e],t,r,i))&&(Us(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=al(n))&&(e=n.g[e.toString()],n=-1,e&&(n=rl(e,t,r,i)),(t=-1<n?e[n]:null)&&ol(t))}function ol(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[ii])nl(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(em(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=al(e))?(nl(t,n),0==t.h&&(t.src=null,e[il]=null)):Us(n)}}}function em(n){return n in sl?sl[n]:sl[n]="on"+n}function n0(n,e){if(n.fa)n=!0;else{e=new ri(e,this);var t=n.listener,r=n.la||n.src;n.ia&&ol(n),n=t.call(r,e)}return n}function al(n){return(n=n[il])instanceof Bs?n:null}var ul="__closure_events_fn_"+(1e9*Math.random()>>>0);function cl(n){return"function"==typeof n?n:(n[ul]||(n[ul]=function(e){return n.handleEvent(e)}),n[ul])}function _e(){Ft.call(this),this.i=new Bs(this),this.S=this,this.J=null}function Te(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new Ce(e,n);else if(e instanceof Ce)e.target=e.target||n;else{var i=e;Hp(e=new Ce(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=qs(o,r,!0,e)&&i}if(i=qs(o=e.g=n,r,!0,e)&&i,i=qs(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=qs(o=e.g=t[s],r,!1,e)&&i}function qs(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&nl(n.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}ge(_e,Ft),_e.prototype[ii]=!0,_e.prototype.removeEventListener=function(n,e,t,r){Xp(this,n,e,t,r)},_e.prototype.N=function(){if(_e.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Us(t[r]);delete n.g[e],n.h--}}this.J=null},_e.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},_e.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var ll=O.JSON.stringify;function i0(){var n=hl;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var tm=new class r0{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new o0,n=>n.reset());class o0{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function a0(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function u0(n){O.setTimeout(()=>{throw n},0)}let si,oi=!1,hl=new class s0{constructor(){this.h=this.g=null}add(e,t){const r=tm.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},nm=()=>{const n=O.Promise.resolve(void 0);si=()=>{n.then(c0)}};var c0=()=>{for(var n;n=i0();){try{n.h.call(n.g)}catch(t){u0(t)}var e=tm;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}oi=!1};function Gs(n,e){_e.call(this),this.h=n||1,this.g=e||O,this.j=be(this.qb,this),this.l=Date.now()}function dl(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function fl(n,e,t){if("function"==typeof n)t&&(n=be(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=be(n.handleEvent,n)}return 2147483647<Number(e)?-1:O.setTimeout(n,e||0)}function rm(n){n.g=fl(()=>{n.g=null,n.i&&(n.i=!1,rm(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}ge(Gs,_e),(S=Gs.prototype).ga=!1,S.T=null,S.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Te(this,"tick"),this.ga&&(dl(this),this.start()))}},S.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},S.N=function(){Gs.$.N.call(this),dl(this),delete this.g};class l0 extends Ft{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:rm(this)}N(){super.N(),this.g&&(O.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ai(n){Ft.call(this),this.h=n,this.g={}}ge(ai,Ft);var im=[];function sm(n,e,t,r){Array.isArray(t)||(t&&(im[0]=t.toString()),t=im);for(var i=0;i<t.length;i++){var s=Qp(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function om(n){tl(n.g,function(e,t){this.g.hasOwnProperty(t)&&ol(e)},n),n.g={}}function zs(){this.g=!0}function er(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function p0(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return ll(t)}catch{return e}}(n,t)+(r?" "+r:"")})}ai.prototype.N=function(){ai.$.N.call(this),om(this)},ai.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},zs.prototype.Ea=function(){this.g=!1},zs.prototype.info=function(){};var gn={},am=null;function Ws(){return am=am||new _e}function um(n){Ce.call(this,gn.Ta,n)}function ui(n){const e=Ws();Te(e,new um(e))}function cm(n,e){Ce.call(this,gn.STAT_EVENT,n),this.stat=e}function Ne(n){const e=Ws();Te(e,new cm(e,n))}function lm(n,e){Ce.call(this,gn.Ua,n),this.size=e}function ci(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return O.setTimeout(function(){n()},e)}gn.Ta="serverreachability",ge(um,Ce),gn.STAT_EVENT="statevent",ge(cm,Ce),gn.Ua="timingevent",ge(lm,Ce);var Ks={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},hm={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function pl(){}function fm(){}pl.prototype.h=null;var _l,li={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ml(){Ce.call(this,"d")}function gl(){Ce.call(this,"c")}function $s(){}function hi(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new ai(this),this.P=m0,this.V=new Gs(n=Hc?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new pm}function pm(){this.i=null,this.g="",this.h=!1}ge(ml,Ce),ge(gl,Ce),ge($s,pl),$s.prototype.g=function(){return new XMLHttpRequest},$s.prototype.i=function(){return{}},_l=new $s;var m0=45e3,yl={},js={};function Il(n,e,t){n.L=1,n.v=Ys(It(e)),n.s=t,n.S=!0,mm(n,null)}function mm(n,e){n.G=Date.now(),di(n),n.A=It(n.v);var t=n.A,r=n.W;Array.isArray(r)||(r=[String(r)]),Rm(t.i,"t",r),n.C=0,t=n.l.J,n.h=new pm,n.g=Hm(n.l,t?e:null,!n.s),0<n.O&&(n.M=new l0(be(n.Pa,n,n.g),n.O)),sm(n.U,n.g,"readystatechange",n.nb),e=n.I?jp(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),ui(),function h0(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.W,n.s)}function gm(n){return!!n.g&&"GET"==n.u&&2!=n.L&&n.l.Ha}function _m(n,e,t){let i,r=!0;for(;!n.J&&n.C<t.length;){if(i=g0(n,t),i==js){4==e&&(n.o=4,Ne(14),r=!1),er(n.j,n.m,null,"[Incomplete Response]");break}if(i==yl){n.o=4,Ne(15),er(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}er(n.j,n.m,i,null),vl(n,i)}gm(n)&&i!=js&&i!=yl&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Ne(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Sl(e),e.M=!0,Ne(11))):(er(n.j,n.m,t,"[Invalid Chunked Response]"),_n(n),fi(n))}function g0(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?js:(t=Number(e.substring(t,r)),isNaN(t)?yl:(r+=1)+t>e.length?js:(e=e.slice(r,r+t),n.C=r+t,e))}function di(n){n.Y=Date.now()+n.P,ym(n,n.P)}function ym(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=ci(be(n.lb,n),e)}function Zs(n){n.B&&(O.clearTimeout(n.B),n.B=null)}function fi(n){0==n.l.H||n.J||Km(n.l,n)}function _n(n){Zs(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,dl(n.V),om(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function vl(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||El(t.i,n)))if(!n.K&&El(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;ro(t),to(t)}Pl(t),Ne(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=ci(be(t.ib,t),6e3));if(1>=bm(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else In(t,11)}else if((n.K||t.g==n)&&ro(t),!ni(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],2==t.H)if("c"==c[0]){t.K=c[1],t.pa=c[2];const l=c[3];null!=l&&(t.ra=l,t.l.info("VER="+t.ra));const h=c[4];null!=h&&(t.Ga=h,t.l.info("SVER="+t.Ga));const f=c[5];null!=f&&"number"==typeof f&&0<f&&(t.L=r=1.5*f,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const p=n.g;if(p){const v=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(v){var s=r.i;s.g||-1==v.indexOf("spdy")&&-1==v.indexOf("quic")&&-1==v.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Tl(s,s.h),s.h=null))}if(r.F){const A=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;A&&(r.Da=A,Z(r.I,r.F,A))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=Zm(r,r.J?r.pa:null,r.Y),o.K){Cm(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.B&&(Zs(a),di(a)),r.g=o}else zm(r);0<t.j.length&&no(t)}else"stop"!=c[0]&&"close"!=c[0]||In(t,7);else 3==t.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?In(t,7):Rl(t):"noop"!=c[0]&&t.h&&t.h.Aa(c),t.A=0)}ui()}catch{}}function Im(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Ls(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function y0(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Ls(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function _0(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(Ls(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(S=hi.prototype).setTimeout=function(n){this.P=n},S.nb=function(n){n=n.target;const e=this.M;e&&3==st(n)?e.l():this.Pa(n)},S.Pa=function(n){try{if(n==this.g)e:{const l=st(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||Hc||this.g&&(this.h.h||this.g.ja()||Mm(this.g)))){this.J||4!=l||7==e||ui(),Zs(this);var t=this.g.da();this.ca=t;t:if(gm(this)){var r=Mm(this.g);n="";var i=r.length,s=4==st(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){_n(this),fi(this);var o="";break t}this.h.i=new O.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function d0(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ni(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,Ne(12),_n(this),fi(this);break e}er(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,vl(this,t)}this.S?(_m(this,l,o),Hc&&this.i&&3==l&&(sm(this.U,this.V,"tick",this.mb),this.V.start())):(er(this.j,this.m,o,null),vl(this,o)),4==l&&_n(this),this.i&&!this.J&&(4==l?Km(this.l,this):(this.i=!1,di(this)))}else(function L0(n){const e={};n=(n.g&&2<=st(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(ni(n[r]))continue;var t=a0(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function e0(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.o=3,Ne(12)):(this.o=0,Ne(13)),_n(this),fi(this)}}}catch{}},S.mb=function(){if(this.g){var n=st(this.g),e=this.g.ja();this.C<e.length&&(Zs(this),_m(this,n,e),this.i&&4!=n&&di(this))}},S.cancel=function(){this.J=!0,_n(this)},S.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function f0(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.L&&(ui(),Ne(17)),_n(this),this.o=2,fi(this)):ym(this,this.Y-n)};var vm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function yn(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof yn){this.h=n.h,Hs(this,n.j),this.s=n.s,this.g=n.g,Qs(this,n.m),this.l=n.l;var e=n.i,t=new gi;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Em(this,t),this.o=n.o}else n&&(e=String(n).match(vm))?(this.h=!1,Hs(this,e[1]||"",!0),this.s=pi(e[2]||""),this.g=pi(e[3]||"",!0),Qs(this,e[4]),this.l=pi(e[5]||"",!0),Em(this,e[6]||"",!0),this.o=pi(e[7]||"")):(this.h=!1,this.i=new gi(null,this.h))}function It(n){return new yn(n)}function Hs(n,e,t){n.j=t?pi(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Qs(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Em(n,e,t){e instanceof gi?(n.i=e,function R0(n,e){e&&!n.j&&(Ut(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Am(this,r),Rm(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=mi(e,A0)),n.i=new gi(e,n.h))}function Z(n,e,t){n.i.set(e,t)}function Ys(n){return Z(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function pi(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function mi(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,v0),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function v0(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}yn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(mi(e,Tm,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(mi(e,Tm,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(mi(t,"/"==t.charAt(0)?T0:E0,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",mi(t,w0)),n.join("")};var Tm=/[#\/\?@]/g,E0=/[#\?:]/g,T0=/[#\?]/g,A0=/[#\?@]/g,w0=/#/g;function gi(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Ut(n){n.g||(n.g=new Map,n.h=0,n.i&&function I0(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Am(n,e){Ut(n),e=tr(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function wm(n,e){return Ut(n),e=tr(n,e),n.g.has(e)}function Rm(n,e,t){Am(n,e),0<t.length&&(n.i=null,n.g.set(tr(n,e),jc(t)),n.h+=t.length)}function tr(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Pm(n){this.l=n||S0,n=O.PerformanceNavigationTiming?0<(n=O.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(O.g&&O.g.Ka&&O.g.Ka()&&O.g.Ka().ec),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(S=gi.prototype).add=function(n,e){Ut(this),this.i=null,n=tr(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},S.forEach=function(n,e){Ut(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},S.ta=function(){Ut(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},S.Z=function(n){Ut(this);let e=[];if("string"==typeof n)wm(this,n)&&(e=e.concat(this.g.get(tr(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},S.set=function(n,e){return Ut(this),this.i=null,wm(this,n=tr(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},S.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},S.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var S0=10;function Sm(n){return!!n.h||!!n.g&&n.g.size>=n.j}function bm(n){return n.h?1:n.g?n.g.size:0}function El(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Tl(n,e){n.g?n.g.add(e):n.h=e}function Cm(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function xm(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return jc(n.i)}Pm.prototype.cancel=function(){if(this.i=xm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var b0=class{stringify(n){return O.JSON.stringify(n,void 0)}parse(n){return O.JSON.parse(n,void 0)}};function C0(){this.g=new b0}function x0(n,e,t){const r=t||"";try{Im(n,function(i,s){let o=i;ti(i)&&(o=ll(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Js(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function _i(n){this.l=n.fc||null,this.j=n.ob||!1}function Xs(n,e){_e.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Al,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ge(_i,pl),_i.prototype.g=function(){return new Xs(this.l,this.j)},_i.prototype.i=function(n){return function(){return n}}({}),ge(Xs,_e);var Al=0;function km(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function yi(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Ii(n)}function Ii(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(S=Xs.prototype).open=function(n,e){if(this.readyState!=Al)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Ii(this)},S.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||O).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},S.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,yi(this)),this.readyState=Al},S.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Ii(this)),this.g&&(this.readyState=3,Ii(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof O.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;km(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},S.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?yi(this):Ii(this),3==this.readyState&&km(this)}},S.Za=function(n){this.g&&(this.response=this.responseText=n,yi(this))},S.Ya=function(n){this.g&&(this.response=n,yi(this))},S.ka=function(){this.g&&yi(this)},S.setRequestHeader=function(n,e){this.v.append(n,e)},S.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},S.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Xs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var D0=O.JSON.parse;function ie(n){_e.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Dm,this.L=this.M=!1}ge(ie,_e);var Dm="",N0=/^https?$/i,V0=["POST","PUT"];function Nm(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Vm(n),eo(n)}function Vm(n){n.F||(n.F=!0,Te(n,"complete"),Te(n,"error"))}function Om(n){if(n.h&&typeof Kc<"u"&&(!n.C[1]||4!=st(n)||2!=n.da()))if(n.v&&4==st(n))fl(n.La,0,n);else if(Te(n,"readystatechange"),4==st(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(vm)[1]||null;!i&&O.self&&O.self.location&&(i=O.self.location.protocol.slice(0,-1)),r=!N0.test(i?i.toLowerCase():"")}t=r}if(t)Te(n,"complete"),Te(n,"success");else{n.m=6;try{var s=2<st(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Vm(n)}}finally{eo(n)}}}function eo(n,e){if(n.g){Lm(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Te(n,"ready");try{t.onreadystatechange=r}catch{}}}function Lm(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(O.clearTimeout(n.A),n.A=null)}function st(n){return n.g?n.g.readyState:0}function Mm(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Dm:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Fm(n){let e="";return tl(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function wl(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Fm(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):Z(n,e,t))}function vi(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Um(n){this.Ga=0,this.j=[],this.l=new zs,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=vi("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=vi("baseRetryDelayMs",5e3,n),this.hb=vi("retryDelaySeedMs",1e4,n),this.eb=vi("forwardChannelMaxRetries",2,n),this.xa=vi("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.dc||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Pm(n&&n.concurrentRequestLimit),this.Ja=new C0,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Rl(n){if(Bm(n),3==n.H){var e=n.W++,t=It(n.I);if(Z(t,"SID",n.K),Z(t,"RID",e),Z(t,"TYPE","terminate"),Ei(n,t),(e=new hi(n,n.l,e)).L=2,e.v=Ys(It(t)),t=!1,O.navigator&&O.navigator.sendBeacon)try{t=O.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&O.Image&&((new Image).src=e.v,t=!0),t||(e.g=Hm(e.l,null),e.g.ha(e.v)),e.G=Date.now(),di(e)}jm(n)}function to(n){n.g&&(Sl(n),n.g.cancel(),n.g=null)}function Bm(n){to(n),n.u&&(O.clearTimeout(n.u),n.u=null),ro(n),n.i.cancel(),n.m&&("number"==typeof n.m&&O.clearTimeout(n.m),n.m=null)}function no(n){if(!Sm(n.i)&&!n.m){n.m=!0;var e=n.Na;si||nm(),oi||(si(),oi=!0),hl.add(e,n),n.C=0}}function qm(n,e){var t;t=e?e.m:n.W++;const r=It(n.I);Z(r,"SID",n.K),Z(r,"RID",t),Z(r,"AID",n.V),Ei(n,r),n.o&&n.s&&wl(r,n.o,n.s),t=new hi(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Gm(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Tl(n.i,t),Il(t,r,e)}function Ei(n,e){n.na&&tl(n.na,function(t,r){Z(e,r,t)}),n.h&&Im({},function(t,r){Z(e,r,t)})}function Gm(n,e,t){t=Math.min(n.j.length,t);var r=n.h?be(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g;const l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{x0(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function zm(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;si||nm(),oi||(si(),oi=!0),hl.add(e,n),n.A=0}}function Pl(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=ci(be(n.Ma,n),$m(n,n.A)),n.A++,0))}function Sl(n){null!=n.B&&(O.clearTimeout(n.B),n.B=null)}function Wm(n){n.g=new hi(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=It(n.wa);Z(e,"RID","rpc"),Z(e,"SID",n.K),Z(e,"AID",n.V),Z(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Z(e,"TO",n.qa),Z(e,"TYPE","xmlhttp"),Ei(n,e),n.o&&n.s&&wl(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.v=Ys(It(e)),t.s=null,t.S=!0,mm(t,n)}function ro(n){null!=n.v&&(O.clearTimeout(n.v),n.v=null)}function Km(n,e){var t=null;if(n.g==e){ro(n),Sl(n),n.g=null;var r=2}else{if(!El(n.i,e))return;t=e.F,Cm(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.G;var i=n.C;Te(r=Ws(),new lm(r,t)),no(n)}else zm(n);else if(3==(i=e.o)||0==i&&0<e.ca||!(1==r&&function M0(n,e){return!(bm(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=ci(be(n.Na,n,e),$m(n,n.C)),n.C++,0)))}(n,e)||2==r&&Pl(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:In(n,5);break;case 4:In(n,10);break;case 3:In(n,6);break;default:In(n,2)}}function $m(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function In(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=be(n.pb,n);t||(t=new yn("//www.google.com/images/cleardot.gif"),O.location&&"http"==O.location.protocol||Hs(t,"https"),Ys(t)),function k0(n,e){const t=new zs;if(O.Image){const r=new Image;r.onload=Ms(Js,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ms(Js,t,r,"TestLoadImage: error",!1,e),r.onabort=Ms(Js,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ms(Js,t,r,"TestLoadImage: timeout",!1,e),O.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Ne(2);n.H=0,n.h&&n.h.za(e),jm(n),Bm(n)}function jm(n){if(n.H=0,n.ma=[],n.h){const e=xm(n.i);(0!=e.length||0!=n.j.length)&&(Gp(n.ma,e),Gp(n.ma,n.j),n.i.i.length=0,jc(n.j),n.j.length=0),n.h.ya()}}function Zm(n,e,t){var r=t instanceof yn?It(t):new yn(t);if(""!=r.g)e&&(r.g=e+"."+r.g),Qs(r,r.m);else{var i=O.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new yn(null);r&&Hs(s,r),e&&(s.g=e),i&&Qs(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&Z(r,t,e),Z(r,"VER",n.ra),Ei(n,r),r}function Hm(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new ie(t&&n.Ha&&!n.va?new _i({ob:!0}):n.va)).Oa(n.J),e}function Qm(){}function io(){if(Xn&&!(10<=Number(Qw)))throw Error("Environmental error: no available transport.")}function ze(n,e){_e.call(this),this.g=new Um(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!ni(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!ni(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new nr(this)}function Ym(n){ml.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Jm(){gl.call(this),this.status=1}function nr(n){this.g=n}function Xe(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function bl(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function K(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(S=ie.prototype).Oa=function(n){this.M=n},S.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():_l.g(),this.C=function dm(n){return n.h||(n.h=n.i())}(this.u?this.u:_l),this.g.onreadystatechange=be(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void Nm(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=O.FormData&&n instanceof O.FormData,!(0<=qp(V0,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Lm(this),0<this.B&&((this.L=function O0(n){return Xn&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=be(this.ua,this)):this.A=fl(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Nm(this,s)}},S.ua=function(){typeof Kc<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Te(this,"timeout"),this.abort(8))},S.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Te(this,"complete"),Te(this,"abort"),eo(this))},S.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),eo(this,!0)),ie.$.N.call(this)},S.La=function(){this.s||(this.G||this.v||this.l?Om(this):this.kb())},S.kb=function(){Om(this)},S.isActive=function(){return!!this.g},S.da=function(){try{return 2<st(this)?this.g.status:-1}catch{return-1}},S.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},S.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),D0(e)}},S.Ia=function(){return this.m},S.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(S=Um.prototype).ra=8,S.H=1,S.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new hi(this,this.l,n);let s=this.s;if(this.U&&(s?(s=jp(s),Hp(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Gm(this,i,e),Z(t=It(this.I),"RID",n),Z(t,"CVER",22),this.F&&Z(t,"X-HTTP-Session-Id",this.F),Ei(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Fm(s)))+"&"+e:this.o&&wl(t,this.o,s)),Tl(this.i,i),this.bb&&Z(t,"TYPE","init"),this.P?(Z(t,"$req",e),Z(t,"SID","null"),i.aa=!0,Il(i,t,null)):Il(i,t,e),this.H=2}}else 3==this.H&&(n?qm(this,n):0==this.j.length||Sm(this.i)||qm(this))},S.Ma=function(){if(this.u=null,Wm(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=ci(be(this.jb,this),n)}},S.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ne(10),to(this),Wm(this))},S.ib=function(){null!=this.v&&(this.v=null,to(this),Pl(this),Ne(19))},S.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Ne(2)):(this.l.info("Failed to ping google.com"),Ne(1))},S.isActive=function(){return!!this.h&&this.h.isActive(this)},(S=Qm.prototype).Ba=function(){},S.Aa=function(){},S.za=function(){},S.ya=function(){},S.isActive=function(){return!0},S.Va=function(){},io.prototype.g=function(n,e){return new ze(n,e)},ge(ze,_e),ze.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Ne(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=Zm(n,null,n.Y),no(n)},ze.prototype.close=function(){Rl(this.g)},ze.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=ll(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&no(e)},ze.prototype.N=function(){this.g.h=null,delete this.j,Rl(this.g),delete this.g,ze.$.N.call(this)},ge(Ym,ml),ge(Jm,gl),ge(nr,Qm),nr.prototype.Ba=function(){Te(this.g,"a")},nr.prototype.Aa=function(n){Te(this.g,new Ym(n))},nr.prototype.za=function(n){Te(this.g,new Jm)},nr.prototype.ya=function(){Te(this.g,"b")},ge(Xe,function F0(){this.blockSize=-1}),Xe.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Xe.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)bl(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){bl(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){bl(this,r),i=0;break}}this.h=i,this.i+=e},Xe.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var U0={};function Cl(n){return-128<=n&&128>n?function jw(n,e){var t=U0;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new K([0|e],0>e?-1:0)}):new K([0|n],0>n?-1:0)}function ot(n){if(isNaN(n)||!isFinite(n))return rr;if(0>n)return Ae(ot(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=xl;return new K(e,0)}var xl=4294967296,rr=Cl(0),kl=Cl(1),eg=Cl(16777216);function vt(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function je(n){return-1==n.h}function Ae(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new K(t,~n.h).add(kl)}function so(n,e){return n.add(Ae(e))}function oo(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Ti(n,e){this.g=n,this.h=e}function ao(n,e){if(vt(e))throw Error("division by zero");if(vt(n))return new Ti(rr,rr);if(je(n))return e=ao(Ae(n),e),new Ti(Ae(e.g),Ae(e.h));if(je(e))return e=ao(n,Ae(e)),new Ti(Ae(e.g),e.h);if(30<n.g.length){if(je(n)||je(e))throw Error("slowDivide_ only works with positive integers.");for(var t=kl,r=e;0>=r.X(n);)t=tg(t),r=tg(r);var i=ir(t,1),s=ir(r,1);for(r=ir(r,2),t=ir(t,2);!vt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=ir(r,1),t=ir(t,1)}return e=so(n,i.R(e)),new Ti(i,e)}for(i=rr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=ot(t)).R(e);je(o)||0<o.X(n);)o=(s=ot(t-=r)).R(e);vt(s)&&(s=kl),i=i.add(s),n=so(n,o)}return new Ti(i,n)}function tg(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new K(t,n.h)}function ir(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new K(i,n.h)}(S=K.prototype).ea=function(){if(je(this))return-Ae(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:xl+r)*e,e*=xl}return n},S.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(vt(this))return"0";if(je(this))return"-"+Ae(this).toString(n);for(var e=ot(Math.pow(n,6)),t=this,r="";;){var i=ao(t,e).g,s=((0<(t=so(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(vt(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},S.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},S.X=function(n){return je(n=so(this,n))?-1:vt(n)?0:1},S.abs=function(){return je(this)?Ae(this):this},S.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new K(t,-2147483648&t[t.length-1]?-1:0)},S.R=function(n){if(vt(this)||vt(n))return rr;if(je(this))return je(n)?Ae(this).R(Ae(n)):Ae(Ae(this).R(n));if(je(n))return Ae(this.R(Ae(n)));if(0>this.X(eg)&&0>n.X(eg))return ot(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=n.D(i)>>>16,u=65535&n.D(i);t[2*r+2*i]+=o*u,oo(t,2*r+2*i),t[2*r+2*i+1]+=s*u,oo(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,oo(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,oo(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new K(t,0)},S.gb=function(n){return ao(this,n).h},S.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new K(t,this.h&n.h)},S.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new K(t,this.h|n.h)},S.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new K(t,this.h^n.h)},io.prototype.createWebChannel=io.prototype.g,ze.prototype.send=ze.prototype.u,ze.prototype.open=ze.prototype.m,ze.prototype.close=ze.prototype.close,Ks.NO_ERROR=0,Ks.TIMEOUT=8,Ks.HTTP_ERROR=6,hm.COMPLETE="complete",fm.EventType=li,li.OPEN="a",li.CLOSE="b",li.ERROR="c",li.MESSAGE="d",_e.prototype.listen=_e.prototype.O,ie.prototype.listenOnce=ie.prototype.P,ie.prototype.getLastError=ie.prototype.Sa,ie.prototype.getLastErrorCode=ie.prototype.Ia,ie.prototype.getStatus=ie.prototype.da,ie.prototype.getResponseJson=ie.prototype.Wa,ie.prototype.getResponseText=ie.prototype.ja,ie.prototype.send=ie.prototype.ha,ie.prototype.setWithCredentials=ie.prototype.Oa,Xe.prototype.digest=Xe.prototype.l,Xe.prototype.reset=Xe.prototype.reset,Xe.prototype.update=Xe.prototype.j,K.prototype.add=K.prototype.add,K.prototype.multiply=K.prototype.R,K.prototype.modulo=K.prototype.gb,K.prototype.compare=K.prototype.X,K.prototype.toNumber=K.prototype.ea,K.prototype.toString=K.prototype.toString,K.prototype.getBits=K.prototype.D,K.fromNumber=ot,K.fromString=function Xm(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return Ae(Xm(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=ot(Math.pow(e,8)),r=rr,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=ot(Math.pow(e,s)),r=r.R(s).add(ot(o))):r=(r=r.R(t)).add(ot(o))}return r};var B0=Je.createWebChannelTransport=function(){return new io},q0=Je.getStatEventTarget=function(){return Ws()},Dl=Je.ErrorCode=Ks,G0=Je.EventType=hm,z0=Je.Event=gn,ng=Je.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},W0=Je.FetchXmlHttpFactory=_i,uo=Je.WebChannel=fm,K0=Je.XhrIo=ie,$0=Je.Md5=Xe,sr=Je.Integer=K;const rg="@firebase/firestore";class ye{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ye.UNAUTHENTICATED=new ye(null),ye.GOOGLE_CREDENTIALS=new ye("google-credentials-uid"),ye.FIRST_PARTY=new ye("first-party-uid"),ye.MOCK_USER=new ye("mock-user");let or="10.1.0";const Bt=new Me.Yd("@firebase/firestore");function Nl(){return Bt.logLevel}function E(n,...e){if(Bt.logLevel<=Me.in.DEBUG){const t=e.map(Vl);Bt.debug(`Firestore (${or}): ${n}`,...t)}}function ae(n,...e){if(Bt.logLevel<=Me.in.ERROR){const t=e.map(Vl);Bt.error(`Firestore (${or}): ${n}`,...t)}}function Ze(n,...e){if(Bt.logLevel<=Me.in.WARN){const t=e.map(Vl);Bt.warn(`Firestore (${or}): ${n}`,...t)}}function Vl(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function b(n="Unexpected state"){const e=`FIRESTORE (${or}) INTERNAL ASSERTION FAILED: `+n;throw ae(e),new Error(e)}function C(n,e){n||b()}function P(n,e){return n}const y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class I extends _.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class de{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ig{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class H0{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ye.UNAUTHENTICATED))}shutdown(){}}class Q0{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Y0{constructor(e){this.t=e,this.currentUser=ye.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let o=new de;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new de,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,d.Z)(function*(){yield c.promise,yield s(r.currentUser)}))},u=c=>{E("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(E("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new de)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(E("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(C("string"==typeof r.accessToken),new ig(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return C(null===e||"string"==typeof e),new ye(e)}}class J0{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=ye.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class X0{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new J0(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ye.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class sg{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class eR{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&E("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,E("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{E("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):E("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(C("string"==typeof t.token),this.R=t.token,new sg(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function tR(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class og{static V(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=tR(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function V(n,e){return n<e?-1:n>e?1:0}function ar(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function ag(n){return n+"\0"}class X{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new I(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new I(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new I(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new I(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return X.fromMillis(Date.now())}static fromDate(e){return X.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new X(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?V(this.nanoseconds,e.nanoseconds):V(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class x{constructor(e){this.timestamp=e}static fromTimestamp(e){return new x(e)}static min(){return new x(new X(0,0))}static max(){return new x(new X(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ai{constructor(e,t,r){void 0===t?t=0:t>e.length&&b(),void 0===r?r=e.length-t:r>e.length-t&&b(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Ai.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ai?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class B extends Ai{construct(e,t,r){return new B(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new I(y.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new B(t)}static emptyPath(){return new B([])}}const nR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class se extends Ai{construct(e,t,r){return new se(e,t,r)}static isValidIdentifier(e){return nR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),se.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new se(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new I(y.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new I(y.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new I(y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new I(y.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new se(t)}static emptyPath(){return new se([])}}class R{constructor(e){this.path=e}static fromPath(e){return new R(B.fromString(e))}static fromName(e){return new R(B.fromString(e).popFirst(5))}static empty(){return new R(B.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===B.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return B.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new R(new B(e.slice()))}}class co{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Ol(n){return n.fields.find(e=>2===e.kind)}function vn(n){return n.fields.filter(e=>2!==e.kind)}co.UNKNOWN_ID=-1;class lo{constructor(e,t){this.fieldPath=e,this.kind=t}}class wi{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new wi(0,We.min())}}function ug(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=x.fromTimestamp(1e9===r?new X(t+1,0):new X(t,r));return new We(i,R.empty(),e)}function cg(n){return new We(n.readTime,n.key,-1)}class We{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new We(x.min(),R.empty(),-1)}static max(){return new We(x.max(),R.empty(),-1)}}function Ll(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=R.comparator(n.documentKey,e.documentKey),0!==t?t:V(n.largestBatchId,e.largestBatchId))}const lg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class hg{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function qt(n){return Ml.apply(this,arguments)}function Ml(){return Ml=(0,d.Z)(function*(n){if(n.code!==y.FAILED_PRECONDITION||n.message!==lg)throw n;E("LocalStore","Unexpectedly lost primary lease")}),Ml.apply(this,arguments)}class m{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&b(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new m((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof m?t:m.resolve(t)}catch(t){return m.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):m.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):m.reject(t)}static resolve(e){return new m((t,r)=>{t(e)})}static reject(e){return new m((t,r)=>{r(e)})}static waitFor(e){return new m((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=m.resolve(!1);for(const r of e)t=t.next(i=>i?m.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new m((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new m((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class ho{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.m=new de,this.transaction.oncomplete=()=>{this.m.resolve()},this.transaction.onabort=()=>{t.error?this.m.reject(new Ri(e,t.error)):this.m.resolve()},this.transaction.onerror=r=>{const i=Fl(r.target.error);this.m.reject(new Ri(e,i))}}static open(e,t,r,i){try{return new ho(t,e.transaction(i,r))}catch(s){throw new Ri(t,s)}}get g(){return this.m.promise}abort(e){e&&this.m.reject(e),this.aborted||(E("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}p(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new oR(t)}}class et{constructor(e,t,r){this.name=e,this.version=t,this.S=r,12.2===et.D((0,_.z$)())&&ae("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return E("SimpleDb","Removing database:",e),En(window.indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!(0,_.hl)())return!1;if(et.C())return!0;const e=(0,_.z$)(),t=et.D(e),r=0<t&&t<10,i=et.F(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.M)}static O(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static F(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}N(e){var t=this;return(0,d.Z)(function*(){return t.db||(E("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new Ri(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const a=o.target.error;i("VersionError"===a.name?new I(y.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new I(y.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Ri(e,a))},s.onupgradeneeded=o=>{E("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.S.B(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{E("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.L&&(t.db.onversionchange=r=>t.L(r)),t.db})()}k(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,d.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{s.db=yield s.N(e);const u=ho.open(s.db,e,o?"readonly":"readwrite",r),c=i(u).next(l=>(u.p(),l)).catch(l=>(u.abort(l),m.reject(l))).toPromise();return c.catch(()=>{}),yield u.g,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(E("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),s.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class sR{constructor(e){this.q=e,this.K=!1,this.$=null}get isDone(){return this.K}get U(){return this.$}set cursor(e){this.q=e}done(){this.K=!0}W(e){this.$=e}delete(){return En(this.q.delete())}}class Ri extends I{constructor(e,t){super(y.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Gt(n){return"IndexedDbTransactionError"===n.name}class oR{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(E("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(E("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),En(r)}add(e){return E("SimpleDb","ADD",this.store.name,e,e),En(this.store.add(e))}get(e){return En(this.store.get(e)).next(t=>(void 0===t&&(t=null),E("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return E("SimpleDb","DELETE",this.store.name,e),En(this.store.delete(e))}count(){return E("SimpleDb","COUNT",this.store.name),En(this.store.count())}G(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.j(i,(o,a)=>{s.push(a)}).next(()=>s)}{const i=this.store.getAll(r.range);return new m((s,o)=>{i.onerror=a=>{o(a.target.error)},i.onsuccess=a=>{s(a.target.result)}})}}H(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}J(e,t){E("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.Y=!1;const i=this.cursor(r);return this.j(i,(s,o,a)=>a.delete())}Z(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.j(i,t)}X(e){const t=this.cursor({});return new m((r,i)=>{t.onerror=s=>{const o=Fl(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}j(e,t){const r=[];return new m((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const u=new sR(a),c=t(a.primaryKey,a.value,u);if(c instanceof m){const l=c.catch(h=>(u.done(),m.reject(h)));r.push(l)}u.isDone?i():null===u.U?a.continue():a.continue(u.U)}}).next(()=>m.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function En(n){return new m((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=Fl(r.target.error);t(i)}})}let dg=!1;function Fl(n){const e=et.D((0,_.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new I("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return dg||(dg=!0,setTimeout(()=>{throw r},0)),r}}return n}class aR{constructor(e,t){this.asyncQueue=e,this.ee=t,this.task=null}start(){this.te(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}te(e){var t=this;E("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,d.Z)(function*(){t.task=null;try{E("IndexBackiller",`Documents written: ${yield t.ee.ne()}`)}catch(r){Gt(r)?E("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield qt(r)}yield t.te(6e4)}))}}class uR{constructor(e,t){this.localStore=e,this.persistence=t}ne(e=50){var t=this;return(0,d.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.re(r,e))})()}re(e,t){const r=new Set;let i=t,s=!0;return m.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return E("IndexBackiller",`Processing collection: ${o}`),this.ie(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ie(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.se(i,s)).next(a=>(E("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}se(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=cg(s);Ll(o,r)>0&&(r=o)}),new We(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Ke=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.oe(i),this._e=i=>r.writeSequenceNumber(i))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}return n.ae=-1,n})();function Pi(n){return null==n}function Si(n){return 0===n&&1/n==-1/0}function fg(n){return"number"==typeof n&&Number.isInteger(n)&&!Si(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function xe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=pg(e)),e=cR(n.get(t),e);return pg(e)}function cR(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function pg(n){return n+"\x01\x01"}function at(n){const e=n.length;if(C(e>=2),2===e)return C("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),B.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("\x01",s);switch((o<0||o>t)&&b(),n.charAt(o+1)){case"\x01":const a=n.substring(s,o);let u;0===i.length?u=a:(i+=a,u=i,i=""),r.push(u);break;case"\x10":i+=n.substring(s,o),i+="\0";break;case"\x11":i+=n.substring(s,o+1);break;default:b()}s=o+2}return new B(r)}const mg=["userId","batchId"];function fo(n,e){return[n,xe(e)]}function gg(n,e,t){return[n,xe(e),t]}const lR={},hR=["prefixPath","collectionGroup","readTime","documentId"],dR=["prefixPath","collectionGroup","documentId"],fR=["collectionGroup","readTime","prefixPath","documentId"],pR=["canonicalId","targetId"],mR=["targetId","path"],gR=["path","targetId"],_R=["collectionId","parent"],yR=["indexId","uid"],IR=["uid","sequenceNumber"],vR=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ER=["indexId","uid","orderedDocumentKey"],TR=["userId","collectionPath","documentId"],AR=["userId","collectionPath","largestBatchId"],wR=["userId","collectionGroup","largestBatchId"],_g=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],RR=[..._g,"documentOverlays"],yg=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ig=yg,PR=[...Ig,"indexConfiguration","indexState","indexEntries"];class Ul extends hg{constructor(e,t){super(),this.ue=e,this.currentSequenceNumber=t}}function Ie(n,e){const t=P(n);return et.O(t.ue,e)}function vg(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function zt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Eg(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class j{constructor(e,t){this.comparator=e,this.root=t||we.EMPTY}insert(e,t){return new j(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,we.BLACK,null,null))}remove(e){return new j(this.comparator,this.root.remove(e,this.comparator).copy(null,null,we.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new po(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new po(this.root,e,this.comparator,!1)}getReverseIterator(){return new po(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new po(this.root,e,this.comparator,!0)}}class po{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class we{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??we.RED,this.left=i??we.EMPTY,this.right=s??we.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new we(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return we.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return we.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,we.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,we.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw b();const e=this.left.check();if(e!==this.right.check())throw b();return e+(this.isRed()?0:1)}}we.EMPTY=null,we.RED=!0,we.BLACK=!1,we.EMPTY=new class{constructor(){this.size=0}get key(){throw b()}get value(){throw b()}get color(){throw b()}get left(){throw b()}get right(){throw b()}copy(e,t,r,i,s){return this}insert(e,t,r){return new we(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class H{constructor(e){this.comparator=e,this.data=new j(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Tg(this.data.getIterator())}getIteratorFrom(e){return new Tg(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof H)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new H(this.comparator);return t.data=e,t}}class Tg{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ur(n){return n.hasNext()?n.getNext():void 0}class Ue{constructor(e){this.fields=e,e.sort(se.comparator)}static empty(){return new Ue([])}unionWith(e){let t=new H(se.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ue(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ar(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Ag extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class fe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ag("Invalid base64 string: "+s):s}}(e);return new fe(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new fe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return V(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}fe.EMPTY_BYTE_STRING=new fe("");const bR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Wt(n){if(C(!!n),"string"==typeof n){let e=0;const t=bR.exec(n);if(C(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:oe(n.seconds),nanos:oe(n.nanos)}}function oe(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Et(n){return"string"==typeof n?fe.fromBase64String(n):fe.fromUint8Array(n)}function mo(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function go(n){const e=n.mapValue.fields.__previous_value__;return mo(e)?go(e):e}function bi(n){const e=Wt(n.mapValue.fields.__local_write_time__.timestampValue);return new X(e.seconds,e.nanos)}class CR{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class Kt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Kt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Kt&&e.projectId===this.projectId&&e.database===this.database}}const $t={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},_o={nullValue:"NULL_VALUE"};function jt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?mo(n)?4:Sg(n)?9007199254740991:10:b()}function ut(n,e){if(n===e)return!0;const t=jt(n);if(t!==jt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return bi(n).isEqual(bi(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Wt(i.timestampValue),a=Wt(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,Et(n.bytesValue).isEqual(Et(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return oe(i.geoPointValue.latitude)===oe(s.geoPointValue.latitude)&&oe(i.geoPointValue.longitude)===oe(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return oe(i.integerValue)===oe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=oe(i.doubleValue),a=oe(s.doubleValue);return o===a?Si(o)===Si(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ar(n.arrayValue.values||[],e.arrayValue.values||[],ut);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(vg(o)!==vg(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===a[u]||!ut(o[u],a[u])))return!1;return!0}(n,e);default:return b()}var s}function Ci(n,e){return void 0!==(n.values||[]).find(t=>ut(t,e))}function Zt(n,e){if(n===e)return 0;const t=jt(n),r=jt(e);if(t!==r)return V(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return V(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=oe(s.integerValue||s.doubleValue),u=oe(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return wg(n.timestampValue,e.timestampValue);case 4:return wg(bi(n),bi(e));case 5:return V(n.stringValue,e.stringValue);case 6:return function(s,o){const a=Et(s),u=Et(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const l=V(a[c],u[c]);if(0!==l)return l}return V(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=V(oe(s.latitude),oe(o.latitude));return 0!==a?a:V(oe(s.longitude),oe(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){const l=Zt(a[c],u[c]);if(l)return l}return V(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===$t.mapValue&&o===$t.mapValue)return 0;if(s===$t.mapValue)return 1;if(o===$t.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){const f=V(u[h],l[h]);if(0!==f)return f;const p=Zt(a[u[h]],c[l[h]]);if(0!==p)return p}return V(u.length,l.length)}(n.mapValue,e.mapValue);default:throw b()}}function wg(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return V(n,e);const t=Wt(n),r=Wt(e),i=V(t.seconds,r.seconds);return 0!==i?i:V(t.nanos,r.nanos)}function cr(n){return Bl(n)}function Bl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Wt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Et(n.bytesValue).toBase64():"referenceValue"in n?R.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=Bl(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${Bl(t.fields[o])}`;return i+"}"}(n.mapValue):b()}function Tn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ql(n){return!!n&&"integerValue"in n}function xi(n){return!!n&&"arrayValue"in n}function Rg(n){return!!n&&"nullValue"in n}function Pg(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Io(n){return!!n&&"mapValue"in n}function ki(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return zt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ki(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ki(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Sg(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function xR(n){return"nullValue"in n?_o:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Tn(Kt.empty(),R.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:b()}function kR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Tn(Kt.empty(),R.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?$t:b()}function bg(n,e){const t=Zt(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Cg(n,e){const t=Zt(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Re{constructor(e){this.value=e}static empty(){return new Re({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Io(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ki(t)}setAll(e){let t=se.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=ki(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Io(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ut(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Io(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){zt(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Re(ki(this.value))}}function xg(n){const e=[];return zt(n.fields,(t,r)=>{const i=new se([t]);if(Io(r)){const s=xg(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Ue(e)}class Q{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Q(e,0,x.min(),x.min(),x.min(),Re.empty(),0)}static newFoundDocument(e,t,r,i){return new Q(e,1,t,x.min(),r,i,0)}static newNoDocument(e,t){return new Q(e,2,t,x.min(),x.min(),Re.empty(),0)}static newUnknownDocument(e,t){return new Q(e,3,t,x.min(),x.min(),Re.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(x.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Re.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Re.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=x.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Q&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Q(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ht{constructor(e,t){this.position=e,this.inclusive=t}}function kg(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?R.comparator(R.fromName(o.referenceValue),t.key):Zt(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Dg(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ut(n.position[t],e.position[t]))return!1;return!0}class lr{constructor(e,t="asc"){this.field=e,this.dir=t}}function DR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Ng{}class F extends Ng{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new NR(e,t,r):"array-contains"===t?new LR(e,r):"in"===t?new Ug(e,r):"not-in"===t?new MR(e,r):"array-contains-any"===t?new FR(e,r):new F(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new VR(e,r):new OR(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Zt(t,this.value)):null!==t&&jt(this.value)===jt(t)&&this.matchesComparison(Zt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return b()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class $ extends Ng{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new $(e,t)}matches(e){return hr(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.le(t=>t.isInequality());return null!==e?e.field:null}le(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function hr(n){return"and"===n.op}function Gl(n){return"or"===n.op}function zl(n){return Vg(n)&&hr(n)}function Vg(n){for(const e of n.filters)if(e instanceof $)return!1;return!0}function Wl(n){if(n instanceof F)return n.field.canonicalString()+n.op.toString()+cr(n.value);if(zl(n))return n.filters.map(e=>Wl(e)).join(",");{const e=n.filters.map(t=>Wl(t)).join(",");return`${n.op}(${e})`}}function Og(n,e){return n instanceof F?(r=n,(i=e)instanceof F&&r.op===i.op&&r.field.isEqual(i.field)&&ut(r.value,i.value)):n instanceof $?function(r,i){return i instanceof $&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&Og(o,i.filters[a]),!0)}(n,e):void b();var r,i}function Lg(n,e){const t=n.filters.concat(e);return $.create(t,n.op)}function Mg(n){return n instanceof F?`${(t=n).field.canonicalString()} ${t.op} ${cr(t.value)}`:n instanceof $?function(t){return t.op.toString()+" {"+t.getFilters().map(Mg).join(" ,")+"}"}(n):"Filter";var t}class NR extends F{constructor(e,t,r){super(e,t,r),this.key=R.fromName(r.referenceValue)}matches(e){const t=R.comparator(e.key,this.key);return this.matchesComparison(t)}}class VR extends F{constructor(e,t){super(e,"in",t),this.keys=Fg(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class OR extends F{constructor(e,t){super(e,"not-in",t),this.keys=Fg(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Fg(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>R.fromName(r.referenceValue))}class LR extends F{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return xi(t)&&Ci(t.arrayValue,this.value)}}class Ug extends F{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ci(this.value.arrayValue,t)}}class MR extends F{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ci(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Ci(this.value.arrayValue,t)}}class FR extends F{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!xi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ci(this.value.arrayValue,r))}}class UR{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.he=null}}function Kl(n,e=null,t=[],r=[],i=null,s=null,o=null){return new UR(n,e,t,r,i,s,o)}function An(n){const e=P(n);if(null===e.he){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Wl(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Pi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>cr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>cr(r)).join(",")),e.he=t}return e.he}function Di(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!DR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Og(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Dg(n.startAt,e.startAt)&&Dg(n.endAt,e.endAt)}function vo(n){return R.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function Eo(n,e){return n.filters.filter(t=>t instanceof F&&t.field.isEqual(e))}function Bg(n,e,t){let r=_o,i=!0;for(const s of Eo(n,e)){let o=_o,a=!0;switch(s.op){case"<":case"<=":o=xR(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=_o}bg({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];bg({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}function qg(n,e,t){let r=$t,i=!0;for(const s of Eo(n,e)){let o=$t,a=!0;switch(s.op){case">=":case">":o=kR(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=$t}Cg({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Cg({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}class Tt{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.Pe=null,this.Ie=null}}function Gg(n,e,t,r,i,s,o,a){return new Tt(n,e,t,r,i,s,o,a)}function dr(n){return new Tt(n)}function zg(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function $l(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function To(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function jl(n){return null!==n.collectionGroup}function wn(n){const e=P(n);if(null===e.Pe){e.Pe=[];const t=To(e),r=$l(e);if(null!==t&&null===r)t.isKeyField()||e.Pe.push(new lr(t)),e.Pe.push(new lr(se.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e.Pe.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.Pe.push(new lr(se.keyField(),s))}}}return e.Pe}function Ve(n){const e=P(n);if(!e.Ie)if("F"===e.limitType)e.Ie=Kl(e.path,e.collectionGroup,wn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of wn(e))t.push(new lr(s.field,"desc"===s.dir?"asc":"desc"));const r=e.endAt?new Ht(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new Ht(e.startAt.position,e.startAt.inclusive):null;e.Ie=Kl(e.path,e.collectionGroup,t,e.filters,e.limit,r,i)}return e.Ie}function Zl(n,e){e.getFirstInequalityField(),To(n);const t=n.filters.concat([e]);return new Tt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ao(n,e,t){return new Tt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ni(n,e){return Di(Ve(n),Ve(e))&&n.limitType===e.limitType}function Wg(n){return`${An(Ve(n))}|lt:${n.limitType}`}function Hl(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Mg(i)).join(", ")}]`),Pi(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>cr(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>cr(i)).join(",")),`Target(${r})`}(Ve(n))}; limitType=${n.limitType})`}function Vi(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):R.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of wn(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,a,u){const c=kg(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,wn(r),i)||r.endAt&&!function(o,a,u){const c=kg(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,wn(r),i)));var r,i}function Kg(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function $g(n){return(e,t)=>{let r=!1;for(const i of wn(n)){const s=BR(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function BR(n,e,t){const r=n.field.isKeyField()?R.comparator(e.key,t.key):function(s,o,a){const u=o.data.field(s),c=a.data.field(s);return null!==u&&null!==c?Zt(u,c):b()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return b()}}class At{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){zt(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Eg(this.inner)}size(){return this.innerSize}}const qR=new j(R.comparator);function Be(){return qR}const jg=new j(R.comparator);function Oi(...n){let e=jg;for(const t of n)e=e.insert(t.key,t);return e}function Zg(n){let e=jg;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ct(){return Li()}function Hg(){return Li()}function Li(){return new At(n=>n.toString(),(n,e)=>n.isEqual(e))}const GR=new j(R.comparator),zR=new H(R.comparator);function L(...n){let e=zR;for(const t of n)e=e.add(t);return e}const WR=new H(V);function Ql(){return WR}function Qg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Si(e)?"-0":e}}function Yg(n){return{integerValue:""+n}}function Jg(n,e){return fg(e)?Yg(e):Qg(n,e)}class wo{constructor(){this._=void 0}}function KR(n,e,t){return n instanceof fr?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&mo(s)&&(s=go(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Rn?e_(n,e):n instanceof Pn?t_(n,e):function(i,s){const o=Xg(i,s),a=n_(o)+n_(i.Te);return ql(o)&&ql(i.Te)?Yg(a):Qg(i.serializer,a)}(n,e)}function $R(n,e,t){return n instanceof Rn?e_(n,e):n instanceof Pn?t_(n,e):t}function Xg(n,e){return n instanceof pr?ql(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class fr extends wo{}class Rn extends wo{constructor(e){super(),this.elements=e}}function e_(n,e){const t=r_(e);for(const r of n.elements)t.some(i=>ut(i,r))||t.push(r);return{arrayValue:{values:t}}}class Pn extends wo{constructor(e){super(),this.elements=e}}function t_(n,e){let t=r_(e);for(const r of n.elements)t=t.filter(i=>!ut(i,r));return{arrayValue:{values:t}}}class pr extends wo{constructor(e,t){super(),this.serializer=e,this.Te=t}}function n_(n){return oe(n.integerValue||n.doubleValue)}function r_(n){return xi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Mi{constructor(e,t){this.field=e,this.transform=t}}class ZR{constructor(e,t){this.version=e,this.transformResults=t}}class ee{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ee}static exists(e){return new ee(void 0,e)}static updateTime(e){return new ee(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ro(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Po{}function i_(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new gr(n.key,ee.none()):new mr(n.key,n.data,ee.none());{const t=n.data,r=Re.empty();let i=new H(se.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new wt(n.key,r,new Ue(i.toArray()),ee.none())}}function HR(n,e,t){n instanceof mr?function(i,s,o){const a=i.value.clone(),u=a_(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof wt?function(i,s,o){if(!Ro(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=a_(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(o_(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Fi(n,e,t,r){return n instanceof mr?function(s,o,a,u){if(!Ro(s.precondition,o))return a;const c=s.value.clone(),l=u_(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof wt?function(s,o,a,u){if(!Ro(s.precondition,o))return a;const c=u_(s.fieldTransforms,u,o),l=o.data;return l.setAll(o_(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):(a=t,Ro(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function QR(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=Xg(r.transform,i||null);null!=s&&(null===t&&(t=Re.empty()),t.set(r.field,s))}return t||null}function s_(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&ar(r,i,(s,o)=>function jR(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof Rn&&i instanceof Rn||r instanceof Pn&&i instanceof Pn?ar(r.elements,i.elements,ut):r instanceof pr&&i instanceof pr?ut(r.Te,i.Te):r instanceof fr&&i instanceof fr);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class mr extends Po{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class wt extends Po{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function o_(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function a_(n,e,t){const r=new Map;C(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,$R(o,a,t[i]))}return r}function u_(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,KR(s,o,e))}return r}class gr extends Po{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Yl extends Po{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Jl{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&HR(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Fi(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Fi(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Hg();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const u=i_(o,a);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(x.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),L())}isEqual(e){return this.batchId===e.batchId&&ar(this.mutations,e.mutations,(t,r)=>s_(t,r))&&ar(this.baseMutations,e.baseMutations,(t,r)=>s_(t,r))}}class Xl{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){C(e.mutations.length===r.length);let i=GR;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new Xl(e,t,r,i)}}class eh{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class JR{constructor(e,t){this.count=e,this.unchangedNames=t}}var he,q;function c_(n){switch(n){default:return b();case y.CANCELLED:case y.UNKNOWN:case y.DEADLINE_EXCEEDED:case y.RESOURCE_EXHAUSTED:case y.INTERNAL:case y.UNAVAILABLE:case y.UNAUTHENTICATED:return!1;case y.INVALID_ARGUMENT:case y.NOT_FOUND:case y.ALREADY_EXISTS:case y.PERMISSION_DENIED:case y.FAILED_PRECONDITION:case y.ABORTED:case y.OUT_OF_RANGE:case y.UNIMPLEMENTED:case y.DATA_LOSS:return!0}}function l_(n){if(void 0===n)return ae("GRPC error has no .code"),y.UNKNOWN;switch(n){case he.OK:return y.OK;case he.CANCELLED:return y.CANCELLED;case he.UNKNOWN:return y.UNKNOWN;case he.DEADLINE_EXCEEDED:return y.DEADLINE_EXCEEDED;case he.RESOURCE_EXHAUSTED:return y.RESOURCE_EXHAUSTED;case he.INTERNAL:return y.INTERNAL;case he.UNAVAILABLE:return y.UNAVAILABLE;case he.UNAUTHENTICATED:return y.UNAUTHENTICATED;case he.INVALID_ARGUMENT:return y.INVALID_ARGUMENT;case he.NOT_FOUND:return y.NOT_FOUND;case he.ALREADY_EXISTS:return y.ALREADY_EXISTS;case he.PERMISSION_DENIED:return y.PERMISSION_DENIED;case he.FAILED_PRECONDITION:return y.FAILED_PRECONDITION;case he.ABORTED:return y.ABORTED;case he.OUT_OF_RANGE:return y.OUT_OF_RANGE;case he.UNIMPLEMENTED:return y.UNIMPLEMENTED;case he.DATA_LOSS:return y.DATA_LOSS;default:return b()}}(q=he||(he={}))[q.OK=0]="OK",q[q.CANCELLED=1]="CANCELLED",q[q.UNKNOWN=2]="UNKNOWN",q[q.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",q[q.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",q[q.NOT_FOUND=5]="NOT_FOUND",q[q.ALREADY_EXISTS=6]="ALREADY_EXISTS",q[q.PERMISSION_DENIED=7]="PERMISSION_DENIED",q[q.UNAUTHENTICATED=16]="UNAUTHENTICATED",q[q.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",q[q.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",q[q.ABORTED=10]="ABORTED",q[q.OUT_OF_RANGE=11]="OUT_OF_RANGE",q[q.UNIMPLEMENTED=12]="UNIMPLEMENTED",q[q.INTERNAL=13]="INTERNAL",q[q.UNAVAILABLE=14]="UNAVAILABLE",q[q.DATA_LOSS=15]="DATA_LOSS";class th{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return So}static getOrCreateInstance(){return null===So&&(So=new th),So}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let So=null;function h_(){return new TextEncoder}const XR=new sr([4294967295,4294967295],0);function d_(n){const e=h_().encode(n),t=new $0;return t.update(e),new Uint8Array(t.digest())}function f_(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new sr([t,r],0),new sr([i,s],0)]}class nh{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ui(`Invalid padding: ${t}`);if(r<0)throw new Ui(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new Ui(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new Ui(`Invalid padding when bitmap length is 0: ${t}`);this.de=8*e.length-t,this.Ae=sr.fromNumber(this.de)}Re(e,t,r){let i=e.add(t.multiply(sr.fromNumber(r)));return 1===i.compare(XR)&&(i=new sr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ae).toNumber()}Ve(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.de)return!1;const t=d_(e),[r,i]=f_(t);for(let s=0;s<this.hashCount;s++){const o=this.Re(r,i,s);if(!this.Ve(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new nh(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.de)return;const t=d_(e),[r,i]=f_(t);for(let s=0;s<this.hashCount;s++){const o=this.Re(r,i,s);this.me(o)}}me(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Ui extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Bi{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,qi.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Bi(x.min(),i,new j(V),Be(),L())}}class qi{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new qi(r,t,L(),L(),L())}}class bo{constructor(e,t,r,i){this.fe=e,this.removedTargetIds=t,this.key=r,this.ge=i}}class p_{constructor(e,t){this.targetId=e,this.pe=t}}class m_{constructor(e,t,r=fe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class g_{constructor(){this.ye=0,this.we=y_(),this.Se=fe.EMPTY_BYTE_STRING,this.be=!1,this.De=!0}get current(){return this.be}get resumeToken(){return this.Se}get ve(){return 0!==this.ye}get Ce(){return this.De}Fe(e){e.approximateByteSize()>0&&(this.De=!0,this.Se=e)}Me(){let e=L(),t=L(),r=L();return this.we.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:b()}}),new qi(this.Se,this.be,e,t,r)}xe(){this.De=!1,this.we=y_()}Oe(e,t){this.De=!0,this.we=this.we.insert(e,t)}Ne(e){this.De=!0,this.we=this.we.remove(e)}Be(){this.ye+=1}Le(){this.ye-=1}ke(){this.De=!0,this.be=!0}}class eP{constructor(e){this.qe=e,this.Qe=new Map,this.Ke=Be(),this.$e=__(),this.Ue=new j(V)}We(e){for(const t of e.fe)e.ge&&e.ge.isFoundDocument()?this.Ge(t,e.ge):this.ze(t,e.key,e.ge);for(const t of e.removedTargetIds)this.ze(t,e.key,e.ge)}je(e){this.forEachTarget(e,t=>{const r=this.He(t);switch(e.state){case 0:this.Je(t)&&r.Fe(e.resumeToken);break;case 1:r.Le(),r.ve||r.xe(),r.Fe(e.resumeToken);break;case 2:r.Le(),r.ve||this.removeTarget(t);break;case 3:this.Je(t)&&(r.ke(),r.Fe(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),r.Fe(e.resumeToken));break;default:b()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qe.forEach((r,i)=>{this.Je(i)&&t(i)})}Ze(e){var t,r;const i=e.targetId,s=e.pe.count,o=this.Xe(i);if(o){const a=o.target;if(vo(a))if(0===s){const u=new R(a.path);this.ze(i,u,Q.newNoDocument(u,x.min()))}else C(1===s);else{const u=this.et(i);if(u!==s){const c=this.tt(e,u);0!==c.status&&(this.Ye(i),this.Ue=this.Ue.insert(i,2===c.status?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null===(t=th.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(h,f,p,v){var A,w,k,N,D,M;const z={localCacheCount:p,existenceFilterCount:v.count},G=v.unchangedNames;return G&&(z.bloomFilter={applied:0===h,hashCount:null!==(A=G?.hashCount)&&void 0!==A?A:0,bitmapLength:null!==(N=null===(k=null===(w=G?.bits)||void 0===w?void 0:w.bitmap)||void 0===k?void 0:k.length)&&void 0!==N?N:0,padding:null!==(M=null===(D=G?.bits)||void 0===D?void 0:D.padding)&&void 0!==M?M:0},f&&(z.bloomFilter.mightContain=f)),z}(c.status,null!==(r=c.nt)&&void 0!==r?r:null,u,e.pe))}}}}tt(e,t){const{unchangedNames:r,count:i}=e.pe;if(!r||!r.bits)return{status:1};const{bits:{bitmap:s="",padding:o=0},hashCount:a=0}=r;let u,c;try{u=Et(s).toUint8Array()}catch(h){if(h instanceof Ag)return Ze("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),{status:1};throw h}try{c=new nh(u,o,a)}catch(h){return Ze(h instanceof Ui?"BloomFilter error: ":"Applying bloom filter failed: ",h),{status:1}}const l=h=>{const f=this.qe.rt();return c.mightContain(`projects/${f.projectId}/databases/${f.database}/documents/${h}`)};return 0===c.de?{status:1}:{status:i===t-this.it(e.targetId,l)?0:2,nt:l}}it(e,t){const r=this.qe.getRemoteKeysForTarget(e);let i=0;return r.forEach(s=>{t(s.path.canonicalString())||(this.ze(e,s,null),i++)}),i}st(e){const t=new Map;this.Qe.forEach((s,o)=>{const a=this.Xe(o);if(a){if(s.current&&vo(a.target)){const u=new R(a.target.path);null!==this.Ke.get(u)||this.ot(o,u)||this.ze(o,u,Q.newNoDocument(u,e))}s.Ce&&(t.set(o,s.Me()),s.xe())}});let r=L();this.$e.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Xe(u);return!c||"TargetPurposeLimboResolution"===c.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.Ke.forEach((s,o)=>o.setReadTime(e));const i=new Bi(e,t,this.Ue,this.Ke,r);return this.Ke=Be(),this.$e=__(),this.Ue=new j(V),i}Ge(e,t){if(!this.Je(e))return;const r=this.ot(e,t.key)?2:0;this.He(e).Oe(t.key,r),this.Ke=this.Ke.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e))}ze(e,t,r){if(!this.Je(e))return;const i=this.He(e);this.ot(e,t)?i.Oe(t,1):i.Ne(t),this.$e=this.$e.insert(t,this._t(t).delete(e)),r&&(this.Ke=this.Ke.insert(t,r))}removeTarget(e){this.Qe.delete(e)}et(e){const t=this.He(e).Me();return this.qe.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Be(e){this.He(e).Be()}He(e){let t=this.Qe.get(e);return t||(t=new g_,this.Qe.set(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new H(V),this.$e=this.$e.insert(e,t)),t}Je(e){const t=null!==this.Xe(e);return t||E("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.Qe.get(e);return t&&t.ve?null:this.qe.ut(e)}Ye(e){this.Qe.set(e,new g_),this.qe.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ot(e,t){return this.qe.getRemoteKeysForTarget(e).has(t)}}function __(){return new j(R.comparator)}function y_(){return new j(R.comparator)}const tP={asc:"ASCENDING",desc:"DESCENDING"},nP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},rP={and:"AND",or:"OR"};class iP{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function rh(n,e){return n.useProto3Json||Pi(e)?e:{value:e}}function _r(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function I_(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function sP(n,e){return _r(n,e.toTimestamp())}function ue(n){return C(!!n),x.fromTimestamp(function(t){const r=Wt(t);return new X(r.seconds,r.nanos)}(n))}function ih(n,e){return(r=n,new B(["projects",r.projectId,"databases",r.database])).child("documents").child(e).canonicalString();var r}function v_(n){const e=B.fromString(n);return C(C_(e)),e}function Gi(n,e){return ih(n.databaseId,e.path)}function lt(n,e){const t=v_(e);if(t.get(1)!==n.databaseId.projectId)throw new I(y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new I(y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new R(T_(t))}function sh(n,e){return ih(n.databaseId,e)}function E_(n){const e=v_(n);return 4===e.length?B.emptyPath():T_(e)}function zi(n){return new B(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function T_(n){return C(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function A_(n,e,t){return{name:Gi(n,e),fields:t.value.mapValue.fields}}function w_(n,e,t){const r=lt(n,e.name),i=ue(e.updateTime),s=e.createTime?ue(e.createTime):x.min(),o=new Re({mapValue:{fields:e.fields}}),a=Q.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Wi(n,e){let t;if(e instanceof mr)t={update:A_(n,e.key,e.value)};else if(e instanceof gr)t={delete:Gi(n,e.key)};else if(e instanceof wt)t={update:A_(n,e.key,e.data),updateMask:fP(e.fieldMask)};else{if(!(e instanceof Yl))return b();t={verify:Gi(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof fr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Rn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Pn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof pr)return{fieldPath:o.field.canonicalString(),increment:a.Te};throw b()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:sP(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:b()),t;var s}function oh(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?ee.updateTime(ue(s.updateTime)):void 0!==s.exists?ee.exists(s.exists):ee.none():ee.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;"setToServerValue"in a?(C("REQUEST_TIME"===a.setToServerValue),u=new fr):"appendMissingElements"in a?u=new Rn(a.appendMissingElements.values||[]):"removeAllFromArray"in a?u=new Pn(a.removeAllFromArray.values||[]):"increment"in a?u=new pr(o,a.increment):b();const c=se.fromServerFormat(a.fieldPath);return new Mi(c,u)}(n,i)):[];var s;if(e.update){const i=lt(n,e.update.name),s=new Re({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Ue((e.updateMask.fieldPaths||[]).map(l=>se.fromServerFormat(l)));return new wt(i,s,o,t,r)}return new mr(i,s,t,r)}if(e.delete){const i=lt(n,e.delete);return new gr(i,t)}if(e.verify){const i=lt(n,e.verify);return new Yl(i,t)}return b()}function R_(n,e){return{documents:[sh(n,e.path)]}}function ah(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=sh(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=sh(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(u){if(0!==u.length)return b_($.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(u){if(0!==u.length)return u.map(c=>{return{field:Qt((h=c).field),direction:lP(h.dir)};var h})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const o=rh(n,e.limit);return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(u=e.startAt).inclusive,values:u.position}),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),t;var u}function P_(n){let e=E_(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){C(1===r);const l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){const f=S_(h);return f instanceof $&&zl(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(f=>{return new lr(yr((v=f).field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction));var v}));let a=null;t.limit&&(a=function(h){let f;return f="object"==typeof h?h.value:h,Pi(f)?null:f}(t.limit));let u=null;var h;t.startAt&&(u=new Ht((h=t.startAt).values||[],!!h.before));let c=null;return t.endAt&&(c=function(h){return new Ht(h.values||[],!h.before)}(t.endAt)),Gg(e,i,o,s,a,"F",u,c)}function S_(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=yr(t.unaryFilter.field);return F.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=yr(t.unaryFilter.field);return F.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=yr(t.unaryFilter.field);return F.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=yr(t.unaryFilter.field);return F.create(o,"!=",{nullValue:"NULL_VALUE"});default:return b()}}(n):void 0!==n.fieldFilter?F.create(yr((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return b()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return $.create(t.compositeFilter.filters.map(r=>S_(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return b()}}(t.compositeFilter.op))}(n):b();var t}function lP(n){return tP[n]}function hP(n){return nP[n]}function dP(n){return rP[n]}function Qt(n){return{fieldPath:n.canonicalString()}}function yr(n){return se.fromServerFormat(n.fieldPath)}function b_(n){return n instanceof F?function(t){if("=="===t.op){if(Pg(t.value))return{unaryFilter:{field:Qt(t.field),op:"IS_NAN"}};if(Rg(t.value))return{unaryFilter:{field:Qt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Pg(t.value))return{unaryFilter:{field:Qt(t.field),op:"IS_NOT_NAN"}};if(Rg(t.value))return{unaryFilter:{field:Qt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Qt(t.field),op:hP(t.op),value:t.value}}}(n):n instanceof $?function(t){const r=t.getFilters().map(i=>b_(i));return 1===r.length?r[0]:{compositeFilter:{op:dP(t.op),filters:r}}}(n):b()}function fP(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function C_(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class Rt{constructor(e,t,r,i,s=x.min(),o=x.min(),a=fe.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new Rt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Rt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Rt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Rt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class x_{constructor(e){this.ct=e}}function k_(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Co(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Gi(s=n.ct,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:_r(s,o.version.toTimestamp()),createTime:_r(s,o.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Sn(e.version)};else{if(!e.isUnknownDocument())return b();r.unknownDocument={path:t.path.toArray(),version:Sn(e.version)}}var s,o;return r}function Co(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Sn(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function bn(n){const e=new X(n.seconds,n.nanoseconds);return x.fromTimestamp(e)}function Cn(n,e){const t=(e.baseMutations||[]).map(s=>oh(n.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>oh(n.ct,s)),i=X.fromMillis(e.localWriteTimeMs);return new Jl(e.batchId,i,t,r)}function Ki(n){const e=bn(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?bn(n.lastLimboFreeSnapshotVersion):x.min();let r;return r=void 0!==n.query.documents?(C(1===(s=n.query).documents.length),Ve(dr(E_(s.documents[0])))):function(s){return Ve(P_(s))}(n.query),new Rt(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,fe.fromBase64String(n.resumeToken));var s}function D_(n,e){const t=Sn(e.snapshotVersion),r=Sn(e.lastLimboFreeSnapshotVersion);let i;i=vo(e.target)?R_(n.ct,e.target):ah(n.ct,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:An(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function uh(n){const e=P_({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Ao(e,e.limit,"L"):e}function ch(n,e){return new eh(e.largestBatchId,oh(n.ct,e.overlayMutation))}function N_(n,e){const t=e.path.lastSegment();return[n,xe(e.path.popLast()),t]}function V_(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Sn(r.readTime),documentKey:xe(r.documentKey.path),largestBatchId:r.largestBatchId}}class mP{getBundleMetadata(e,t){return O_(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:bn(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return O_(e).put({bundleId:(i=t).id,createTime:Sn(ue(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return L_(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:uh(s.bundledQuery),readTime:bn(s.readTime)};var s})}saveNamedQuery(e,t){return L_(e).put({name:(i=t).name,readTime:Sn(ue(i.readTime)),bundledQuery:i.bundledQuery});var i}}function O_(n){return Ie(n,"bundles")}function L_(n){return Ie(n,"namedQueries")}class xo{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new xo(e,t.uid||"")}getOverlay(e,t){return $i(e).get(N_(this.userId,t)).next(r=>r?ch(this.serializer,r):null)}getOverlays(e,t){const r=ct();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const a=new eh(t,o);i.push(this.ht(e,a))}),m.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(xe(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push($i(e).J("collectionPathOverlayIndex",a))}),m.waitFor(s)}getOverlaysForCollection(e,t,r){const i=ct(),s=xe(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return $i(e).G("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=ch(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=ct();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return $i(e).Z({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{const h=ch(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}ht(e,t){return $i(e).put(function(i,s,o){const[a,u,c]=N_(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Wi(i.ct,o.mutation)}}(this.serializer,this.userId,t))}}function $i(n){return Ie(n,"documentOverlays")}class xn{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(oe(e.integerValue));else if("doubleValue"in e){const r=oe(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),Si(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Et(t,20),"string"==typeof r?t.At(r):(t.At(`${r.seconds||""}`),t.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Et(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?Sg(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):b()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const r=e.fields||{};this.Et(t,55);for(const i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){const r=e.values||[];this.Et(t,50);for(const i of r)this.It(i,t)}gt(e,t){this.Et(t,37),R.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function gP(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function M_(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=gP(255&r[s]);if(i+=o,8!==o)break}return i}(n);return Math.ceil(e/8)}xn.bt=new xn;class _P{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.vt(r.value),r=t.next();this.Ct()}Ft(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Mt(r.value),r=t.next();this.xt()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.vt(r);else if(r<2048)this.vt(960|r>>>6),this.vt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.vt(480|r>>>12),this.vt(128|63&r>>>6),this.vt(128|63&r);else{const i=t.codePointAt(0);this.vt(240|i>>>18),this.vt(128|63&i>>>12),this.vt(128|63&i>>>6),this.vt(128|63&i)}}this.Ct()}Nt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{const i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Bt(e){const t=this.Lt(e),r=M_(t);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){const t=this.Lt(e),r=M_(t);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Lt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}vt(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}Ct(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class yP{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Bt(e)}Tt(){this.Gt.Qt()}}class IP{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class ji{constructor(){this.Gt=new _P,this.zt=new yP(this.Gt),this.jt=new IP(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class kn{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new kn(this.indexId,this.documentKey,this.arrayValue,r)}}function Yt(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=F_(n.arrayValue,e.arrayValue),0!==t?t:(t=F_(n.directionalValue,e.directionalValue),0!==t?t:R.comparator(n.documentKey,e.documentKey)))}function F_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class vP{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=r:this.Zt.push(r)}}en(e){C(e.collectionGroup===this.collectionId);const t=Ol(e);if(void 0!==t&&!this.tn(t))return!1;const r=vn(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(void 0!==this.Xt){if(!i.has(this.Xt.field.canonicalString())){const a=r[s];if(!this.nn(this.Xt,a)||!this.rn(this.Yt[o++],a))return!1}++s}for(;s<r.length;++s)if(o>=this.Yt.length||!this.rn(this.Yt[o++],r[s]))return!1;return!0}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function U_(n){var e,t;if(C(n instanceof F||n instanceof $),n instanceof F){if(n instanceof Ug){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>F.create(n.field,"==",s)))||[];return $.create(i,"or")}return n}const r=n.filters.map(i=>U_(i));return $.create(r,n.op)}function EP(n){if(0===n.getFilters().length)return[];const e=dh(U_(n));return C(B_(e)),lh(e)||hh(e)?[e]:e.getFilters()}function lh(n){return n instanceof F}function hh(n){return n instanceof $&&zl(n)}function B_(n){return lh(n)||hh(n)||function(t){if(t instanceof $&&Gl(t)){for(const r of t.getFilters())if(!lh(r)&&!hh(r))return!1;return!0}return!1}(n)}function dh(n){if(C(n instanceof F||n instanceof $),n instanceof F)return n;if(1===n.filters.length)return dh(n.filters[0]);const e=n.filters.map(r=>dh(r));let t=$.create(e,n.op);return t=ko(t),B_(t)?t:(C(t instanceof $),C(hr(t)),C(t.filters.length>1),t.filters.reduce((r,i)=>fh(r,i)))}function fh(n,e){let t;return C(n instanceof F||n instanceof $),C(e instanceof F||e instanceof $),t=n instanceof F?e instanceof F?$.create([n,e],"and"):q_(n,e):e instanceof F?q_(e,n):function(i,s){if(C(i.filters.length>0&&s.filters.length>0),hr(i)&&hr(s))return Lg(i,s.getFilters());const o=Gl(i)?i:s,a=Gl(i)?s:i,u=o.filters.map(c=>fh(c,a));return $.create(u,"or")}(n,e),ko(t)}function q_(n,e){if(hr(e))return Lg(e,n.getFilters());{const t=e.filters.map(r=>fh(n,r));return $.create(t,"or")}}function ko(n){if(C(n instanceof F||n instanceof $),n instanceof F)return n;const e=n.getFilters();if(1===e.length)return ko(e[0]);if(Vg(n))return n;const t=e.map(i=>ko(i)),r=[];return t.forEach(i=>{i instanceof F?r.push(i):i instanceof $&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:$.create(r,n.op)}class TP{constructor(){this.sn=new ph}addToCollectionParentIndex(e,t){return this.sn.add(t),m.resolve()}getCollectionParents(e,t){return m.resolve(this.sn.getEntries(t))}addFieldIndex(e,t){return m.resolve()}deleteFieldIndex(e,t){return m.resolve()}getDocumentsMatchingTarget(e,t){return m.resolve(null)}getIndexType(e,t){return m.resolve(0)}getFieldIndexes(e,t){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,t){return m.resolve(We.min())}getMinOffsetFromCollectionGroup(e,t){return m.resolve(We.min())}updateCollectionGroup(e,t,r){return m.resolve()}updateIndexEntries(e,t){return m.resolve()}}class ph{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new H(B.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new H(B.comparator)).toArray()}}const Do=new Uint8Array(0);class AP{constructor(e,t){this.user=e,this.databaseId=t,this.on=new ph,this._n=new At(r=>An(r),(r,i)=>Di(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.on.add(t)});const s={collectionId:r,parent:xe(i)};return G_(e).put(s)}return m.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[ag(t),""],!1,!0);return G_(e).G(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(at(o.parent))}return r})}addFieldIndex(e,t){const r=No(e),i={indexId:(a=t).indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])};var a;delete i.indexId;const s=r.add(i);if(t.indexState){const o=Hi(e);return s.next(a=>{o.put(V_(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=No(e),i=Hi(e),s=Zi(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=Zi(e);let i=!0;const s=new Map;return m.forEach(this.an(t),o=>this.un(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=L();const a=[];return m.forEach(s,(u,c)=>{var D;E("IndexedDbIndexManager",`Using index ${D=u,`id=${D.indexId}|cg=${D.collectionGroup}|f=${D.fields.map(M=>`${M.fieldPath}:${M.kind}`).join(",")}`} to execute ${An(t)}`);const l=function(D,M){const z=Ol(M);if(void 0===z)return null;for(const G of Eo(D,z.fieldPath))switch(G.op){case"array-contains-any":return G.value.arrayValue.values||[];case"array-contains":return[G.value]}return null}(c,u),h=function(D,M){const z=new Map;for(const G of vn(M))for(const pe of Eo(D,G.fieldPath))switch(pe.op){case"==":case"in":z.set(G.fieldPath.canonicalString(),pe.value);break;case"not-in":case"!=":return z.set(G.fieldPath.canonicalString(),pe.value),Array.from(z.values())}return null}(c,u),f=function(D,M){const z=[];let G=!0;for(const pe of vn(M)){const an=0===pe.kind?Bg(D,pe.fieldPath,D.startAt):qg(D,pe.fieldPath,D.startAt);z.push(an.value),G&&(G=an.inclusive)}return new Ht(z,G)}(c,u),p=function(D,M){const z=[];let G=!0;for(const pe of vn(M)){const an=0===pe.kind?qg(D,pe.fieldPath,D.endAt):Bg(D,pe.fieldPath,D.endAt);z.push(an.value),G&&(G=an.inclusive)}return new Ht(z,G)}(c,u),v=this.cn(u,c,f),A=this.cn(u,c,p),w=this.ln(u,c,h),k=this.hn(u.indexId,l,v,f.inclusive,A,p.inclusive,w);return m.forEach(k,N=>r.H(N,t.limit).next(D=>{D.forEach(M=>{const z=R.fromSegments(M.documentKey);o.has(z)||(o=o.add(z),a.push(z))})}))}).next(()=>a)}return m.resolve(null)})}an(e){let t=this._n.get(e);return t||(t=0===e.filters.length?[e]:EP($.create(e.filters,"and")).map(r=>Kl(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this._n.set(e,t),t)}hn(e,t,r,i,s,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,s.length),c=u/(null!=t?t.length:1),l=[];for(let h=0;h<u;++h){const f=t?this.Pn(t[h/c]):Do,p=this.In(e,f,r[h%c],i),v=this.Tn(e,f,s[h%c],o),A=a.map(w=>this.In(e,f,w,!0));l.push(...this.createRange(p,v,A))}return l}In(e,t,r,i){const s=new kn(e,R.empty(),t,r);return i?s:s.Jt()}Tn(e,t,r,i){const s=new kn(e,R.empty(),t,r);return i?s.Jt():s}un(e,t){const r=new vP(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const i=this.an(t);return m.forEach(i,s=>this.un(e,s).next(o=>{o?0!==r&&o.fields.length<function(u){let c=new H(se.comparator),l=!1;for(const h of u.filters)for(const f of h.getFlattenedFilters())f.field.isKeyField()||("array-contains"===f.op||"array-contains-any"===f.op?l=!0:c=c.add(f.field));for(const h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}En(e,t){const r=new ji;for(const i of vn(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const o=r.Ht(i.kind);xn.bt.Pt(s,o)}return r.Wt()}Pn(e){const t=new ji;return xn.bt.Pt(e,t.Ht(0)),t.Wt()}dn(e,t){const r=new ji;return xn.bt.Pt(Tn(this.databaseId,t),r.Ht(function(s){const o=vn(s);return 0===o.length?0:o[o.length-1].kind}(e))),r.Wt()}ln(e,t,r){if(null===r)return[];let i=[];i.push(new ji);let s=0;for(const o of vn(e)){const a=r[s++];for(const u of i)if(this.An(t,o.fieldPath)&&xi(a))i=this.Rn(i,o,a);else{const c=u.Ht(o.kind);xn.bt.Pt(a,c)}}return this.Vn(i)}cn(e,t,r){return this.ln(e,t,r.position)}Vn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Wt();return t}Rn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const u=new ji;u.seed(a.Wt()),xn.bt.Pt(o,u.Ht(t.kind)),s.push(u)}return s}An(e,t){return!!e.filters.find(r=>r instanceof F&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=No(e),i=Hi(e);return(t?r.G("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.G()).next(s=>{const o=[];return m.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){const f=h?new wi(h.sequenceNumber,new We(bn(h.readTime),new R(at(h.documentKey)),h.largestBatchId)):wi.empty(),p=l.fields.map(([v,A])=>new lo(se.fromServerFormat(v),A));return new co(l.indexId,l.collectionGroup,p,f)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:V(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=No(e),s=Hi(e);return this.mn(e).next(o=>i.G("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>m.forEach(a,u=>s.put(V_(u.indexId,this.user,o,r)))))}updateIndexEntries(e,t){const r=new Map;return m.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),m.forEach(a,u=>this.fn(e,i,u).next(c=>{const l=this.gn(s,u);return c.isEqual(l)?m.resolve():this.pn(e,s,u,c,l)}))))})}yn(e,t,r,i){return Zi(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.dn(r,t.key),documentKey:t.key.path.toArray()})}wn(e,t,r,i){return Zi(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.dn(r,t.key),t.key.path.toArray()])}fn(e,t,r){const i=Zi(e);let s=new H(Yt);return i.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.dn(r,t)])},(o,a)=>{s=s.add(new kn(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}gn(e,t){let r=new H(Yt);const i=this.En(t,e);if(null==i)return r;const s=Ol(t);if(null!=s){const o=e.data.field(s.fieldPath);if(xi(o))for(const a of o.arrayValue.values||[])r=r.add(new kn(t.indexId,e.key,this.Pn(a),i))}else r=r.add(new kn(t.indexId,e.key,Do,i));return r}pn(e,t,r,i,s){E("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(u,c,l,h,f){const p=u.getIterator(),v=c.getIterator();let A=ur(p),w=ur(v);for(;A||w;){let k=!1,N=!1;if(A&&w){const D=l(A,w);D<0?N=!0:D>0&&(k=!0)}else null!=A?N=!0:k=!0;k?(h(w),w=ur(v)):N?(f(A),A=ur(p)):(A=ur(p),w=ur(v))}}(i,s,Yt,a=>{o.push(this.yn(e,t,r,a))},a=>{o.push(this.wn(e,t,r,a))}),m.waitFor(o)}mn(e){let t=1;return Hi(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Yt(o,a)).filter((o,a,u)=>!a||0!==Yt(o,u[a-1]));const i=[];i.push(e);for(const o of r){const a=Yt(o,e),u=Yt(o,t);if(0===a)i[0]=e.Jt();else if(a>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.Sn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Do,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Do,[]]))}return s}Sn(e,t){return Yt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(z_)}getMinOffset(e,t){return m.mapArray(this.an(t),r=>this.un(e,r).next(i=>i||b())).next(z_)}}function G_(n){return Ie(n,"collectionParents")}function Zi(n){return Ie(n,"indexEntries")}function No(n){return Ie(n,"indexConfiguration")}function Hi(n){return Ie(n,"indexState")}function z_(n){C(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;Ll(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new We(e.readTime,e.documentKey,t)}const W_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ke{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new ke(e,ke.DEFAULT_COLLECTION_PERCENTILE,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function K_(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.Z({range:o},(l,h,f)=>(a++,f.delete()));s.push(u.next(()=>{C(1===a)}));const c=[];for(const l of t.mutations){const h=gg(e,l.key.path,t.batchId);s.push(i.delete(h)),c.push(l.key)}return m.waitFor(s).next(()=>c)}function Vo(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw b();e=n.noDocument}return JSON.stringify(e).length}ke.DEFAULT_COLLECTION_PERCENTILE=10,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ke.DEFAULT=new ke(41943040,ke.DEFAULT_COLLECTION_PERCENTILE,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ke.DISABLED=new ke(-1,0,0);class Oo{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.bn={}}static lt(e,t,r,i){C(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Oo(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Jt(e).Z({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=Ir(e),o=Jt(e);return o.add({}).next(a=>{C("number"==typeof a);const u=new Jl(a,t,r,i),c=function(p,v,A){const w=A.baseMutations.map(N=>Wi(p.ct,N)),k=A.mutations.map(N=>Wi(p.ct,N));return{userId:v,batchId:A.batchId,localWriteTimeMs:A.localWriteTime.toMillis(),baseMutations:w,mutations:k}}(this.serializer,this.userId,u),l=[];let h=new H((f,p)=>V(f.canonicalString(),p.canonicalString()));for(const f of i){const p=gg(this.userId,f.key.path,a);h=h.add(f.key.path.popLast()),l.push(o.put(c)),l.push(s.put(p,lR))}return h.forEach(f=>{l.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.bn[a]=u.keys()}),m.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return Jt(e).get(t).next(r=>r?(C(r.userId===this.userId),Cn(this.serializer,r)):null)}Dn(e,t){return this.bn[t]?m.resolve(this.bn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.bn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Jt(e).Z({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(C(a.batchId>=r),s=Cn(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Jt(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Jt(e).G("userMutationsIndex",t).next(r=>r.map(i=>Cn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=fo(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Ir(e).Z({range:i},(o,a,u)=>{const[c,l,h]=o,f=at(l);if(c===this.userId&&t.path.isEqual(f))return Jt(e).get(h).next(p=>{if(!p)throw b();C(p.userId===this.userId),s.push(Cn(this.serializer,p))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new H(V);const i=[];return t.forEach(s=>{const o=fo(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=Ir(e).Z({range:a},(c,l,h)=>{const[f,p,v]=c,A=at(p);f===this.userId&&s.path.isEqual(A)?r=r.add(v):h.done()});i.push(u)}),m.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=fo(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new H(V);return Ir(e).Z({range:o},(u,c,l)=>{const[h,f,p]=u,v=at(f);h===this.userId&&r.isPrefixOf(v)?v.length===i&&(a=a.add(p)):l.done()}).next(()=>this.vn(e,a))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Jt(e).get(s).next(o=>{if(null===o)throw b();C(o.userId===this.userId),r.push(Cn(this.serializer,o))}))}),m.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return K_(e.ue,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Cn(t.batchId)}),m.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Cn(e){delete this.bn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return m.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return Ir(e).Z({range:r},(s,o,a)=>{if(s[0]===this.userId){const u=at(s[1]);i.push(u)}else a.done()}).next(()=>{C(0===i.length)})})}containsKey(e,t){return $_(e,this.userId,t)}Fn(e){return j_(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function $_(n,e,t){const r=fo(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Ir(n).Z({range:s,Y:!0},(a,u,c)=>{const[l,h,f]=a;l===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function Jt(n){return Ie(n,"mutations")}function Ir(n){return Ie(n,"documentMutations")}function j_(n){return Ie(n,"mutationQueues")}class Dn{constructor(e){this.Mn=e}next(){return this.Mn+=2,this.Mn}static xn(){return new Dn(0)}static On(){return new Dn(-1)}}class wP{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Nn(e).next(t=>{const r=new Dn(t.highestTargetId);return t.highestTargetId=r.next(),this.Bn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Nn(e).next(t=>x.fromTimestamp(new X(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Nn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Nn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Bn(e,i)))}addTargetData(e,t){return this.Ln(e,t).next(()=>this.Nn(e).next(r=>(r.targetCount+=1,this.kn(t,r),this.Bn(e,r))))}updateTargetData(e,t){return this.Ln(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>vr(e).delete(t.targetId)).next(()=>this.Nn(e)).next(r=>(C(r.targetCount>0),r.targetCount-=1,this.Bn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return vr(e).Z((o,a)=>{const u=Ki(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>m.waitFor(s)).next(()=>i)}forEachTarget(e,t){return vr(e).Z((r,i)=>{const s=Ki(i);t(s)})}Nn(e){return Z_(e).get("targetGlobalKey").next(t=>(C(null!==t),t))}Bn(e,t){return Z_(e).put("targetGlobalKey",t)}Ln(e,t){return vr(e).put(D_(this.serializer,t))}kn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Nn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=An(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return vr(e).Z({range:i,index:"queryTargetsIndex"},(o,a,u)=>{const c=Ki(a);Di(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Xt(e);return t.forEach(o=>{const a=xe(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),m.waitFor(i)}removeMatchingKeys(e,t,r){const i=Xt(e);return m.forEach(t,s=>{const o=xe(s.path);return m.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Xt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Xt(e);let s=L();return i.Z({range:r,Y:!0},(o,a,u)=>{const c=at(o[1]),l=new R(c);s=s.add(l)}).next(()=>s)}containsKey(e,t){const r=xe(t.path),i=IDBKeyRange.bound([r],[ag(r)],!1,!0);let s=0;return Xt(e).Z({index:"documentTargetsIndex",Y:!0,range:i},([o,a],u,c)=>{0!==o&&(s++,c.done())}).next(()=>s>0)}ut(e,t){return vr(e).get(t).next(r=>r?Ki(r):null)}}function vr(n){return Ie(n,"targets")}function Z_(n){return Ie(n,"targetGlobal")}function Xt(n){return Ie(n,"targetDocuments")}function H_([n,e],[t,r]){const i=V(n,t);return 0===i?V(e,r):i}class RP{constructor(e){this.qn=e,this.buffer=new H(H_),this.Qn=0}Kn(){return++this.Qn}$n(e){const t=[e,this.Kn()];if(this.buffer.size<this.qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();H_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Q_{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Un=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Wn(6e4)}stop(){this.Un&&(this.Un.cancel(),this.Un=null)}get started(){return null!==this.Un}Wn(e){var t=this;E("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Un=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,d.Z)(function*(){t.Un=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){Gt(r)?E("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield qt(r)}yield t.Wn(3e5)}))}}class PP{constructor(e,t){this.Gn=e,this.params=t}calculateTargetCount(e,t){return this.Gn.zn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return m.resolve(Ke.ae);const r=new RP(t);return this.Gn.forEachTarget(e,i=>r.$n(i.sequenceNumber)).next(()=>this.Gn.jn(e,i=>r.$n(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Gn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Gn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(E("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(W_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(E("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),W_):this.Hn(e,t))}getCacheSize(e){return this.Gn.getCacheSize(e)}Hn(e,t){let r,i,s,o,a,u,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(E("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),Nl()<=Me.in.DEBUG&&E("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${i} in `+(a-o)+`ms\n\tRemoved ${s} targets in `+(u-a)+`ms\n\tRemoved ${h} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),m.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}}class SP{constructor(e,t){this.db=e,this.garbageCollector=function Y_(n,e){return new PP(n,e)}(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Jn(e){let t=0;return this.jn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}jn(e,t){return this.Yn(e,(r,i)=>t(i))}addReference(e,t,r){return Lo(e,r)}removeReference(e,t,r){return Lo(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Lo(e,t)}Zn(e,t){return function(i,s){let o=!1;return j_(i).X(a=>$_(i,a,s).next(u=>(u&&(o=!0),m.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Yn(e,(o,a)=>{if(a<=t){const u=this.Zn(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,x.min()),Xt(e).delete([0,xe(o.path)])))});i.push(u)}}).next(()=>m.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Lo(e,t)}Yn(e,t){const r=Xt(e);let i,s=Ke.ae;return r.Z({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(s!==Ke.ae&&t(new R(at(i)),s),s=c,i=u):s=Ke.ae}).next(()=>{s!==Ke.ae&&t(new R(at(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Lo(n,e){return Xt(n).put((i=n.currentSequenceNumber,{targetId:0,path:xe(e.path),sequenceNumber:i}));var i}class J_{constructor(){this.changes=new At(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Q.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?m.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class bP{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Nn(e).put(r)}removeEntry(e,t,r){return Nn(e).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Co(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Xn(e,r)))}getEntry(e,t){let r=Q.newInvalidDocument(t);return Nn(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Qi(t))},(i,s)=>{r=this.er(t,s)}).next(()=>r)}tr(e,t){let r={size:0,document:Q.newInvalidDocument(t)};return Nn(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Qi(t))},(i,s)=>{r={document:this.er(t,s),size:Vo(s)}}).next(()=>r)}getEntries(e,t){let r=Be();return this.nr(e,t,(i,s)=>{const o=this.er(i,s);r=r.insert(i,o)}).next(()=>r)}rr(e,t){let r=Be(),i=new j(R.comparator);return this.nr(e,t,(s,o)=>{const a=this.er(s,o);r=r.insert(s,a),i=i.insert(s,Vo(o))}).next(()=>({documents:r,ir:i}))}nr(e,t,r){if(t.isEmpty())return m.resolve();let i=new H(ny);t.forEach(u=>i=i.add(u));const s=IDBKeyRange.bound(Qi(i.first()),Qi(i.last())),o=i.getIterator();let a=o.getNext();return Nn(e).Z({index:"documentKeyIndex",range:s},(u,c,l)=>{const h=R.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&ny(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.W(Qi(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),Co(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Nn(e).G(IDBKeyRange.bound(o,a,!0)).next(u=>{let c=Be();for(const l of u){const h=this.er(R.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);h.isFoundDocument()&&(Vi(t,h)||i.has(h.key))&&(c=c.insert(h.key,h))}return c})}getAllFromCollectionGroup(e,t,r,i){let s=Be();const o=ty(t,r),a=ty(t,We.max());return Nn(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{const h=this.er(R.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new CP(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return ey(e).get("remoteDocumentGlobalKey").next(t=>(C(!!t),t))}Xn(e,t){return ey(e).put("remoteDocumentGlobalKey",t)}er(e,t){if(t){const r=function pP(n,e){let t;if(e.document)t=w_(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=R.fromSegments(e.noDocument.path),i=bn(e.noDocument.readTime);t=Q.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return b();{const r=R.fromSegments(e.unknownDocument.path),i=bn(e.unknownDocument.version);t=Q.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new X(i[0],i[1]);return x.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(x.min()))return r}return Q.newInvalidDocument(e)}}function X_(n){return new bP(n)}class CP extends J_{constructor(e,t){super(),this.sr=e,this.trackRemovals=t,this._r=new At(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new H((s,o)=>V(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this._r.get(s);if(t.push(this.sr.removeEntry(e,s,a.readTime)),o.isValidDocument()){const u=k_(this.sr.serializer,o);i=i.add(s.path.popLast());const c=Vo(u);r+=c-a.size,t.push(this.sr.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){const u=k_(this.sr.serializer,o.convertToNoDocument(x.min()));t.push(this.sr.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.sr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.sr.updateMetadata(e,r)),m.waitFor(t)}getFromCache(e,t){return this.sr.tr(e,t).next(r=>(this._r.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.sr.rr(e,t).next(({documents:r,ir:i})=>(i.forEach((s,o)=>{this._r.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function ey(n){return Ie(n,"remoteDocumentGlobal")}function Nn(n){return Ie(n,"remoteDocumentsV14")}function Qi(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ty(n,e){const t=e.documentKey.path.toArray();return[n,Co(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function ny(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=V(t[s],r[s]),i)return i;return i=V(t.length,r.length),i||(i=V(t[t.length-2],r[r.length-2]),i||V(t[t.length-1],r[r.length-1]))}class xP{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ry{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&Fi(r.mutation,i,Ue.empty(),X.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,L()).next(()=>r))}getLocalViewOfDocuments(e,t,r=L()){const i=ct();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Oi();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=ct();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,L()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Be();const o=Li(),a=Li();return t.forEach((u,c)=>{const l=r.get(c.key);i.has(c.key)&&(void 0===l||l.mutation instanceof wt)?s=s.insert(c.key,c):void 0!==l?(o.set(c.key,l.mutation.getFieldMask()),Fi(l.mutation,c,l.mutation.getFieldMask(),X.now())):o.set(c.key,Ue.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new xP(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Li();let i=new j((o,a)=>o-a),s=L();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||Ue.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(i.get(a.batchId)||L()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=Hg();l.forEach(f=>{if(!s.has(f)){const p=i_(t.get(f),r.get(f));null!==p&&h.set(f,p),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return R.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):jl(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var s}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):m.resolve(ct());let a=-1,u=s;return o.next(c=>m.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?m.resolve():this.remoteDocumentCache.getEntry(e,l).next(f=>{u=u.insert(l,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,L())).next(l=>({batchId:a,changes:Zg(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new R(t)).next(r=>{let i=Oi();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const i=t.collectionGroup;let s=Oi();return this.indexManager.getCollectionParents(e,i).next(o=>m.forEach(o,a=>{const u=(l=t,h=a.child(i),new Tt(h,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt));var l,h;return this.getDocumentsMatchingCollectionQuery(e,u,r).next(c=>{c.forEach((l,h)=>{s=s.insert(l,h)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i))).next(s=>{i.forEach((a,u)=>{const c=u.getKey();null===s.get(c)&&(s=s.insert(c,Q.newInvalidDocument(c)))});let o=Oi();return s.forEach((a,u)=>{const c=i.get(a);void 0!==c&&Fi(c.mutation,u,Ue.empty(),X.now()),Vi(t,u)&&(o=o.insert(a,u))}),o})}}class kP{constructor(e){this.serializer=e,this.ar=new Map,this.ur=new Map}getBundleMetadata(e,t){return m.resolve(this.ar.get(t))}saveBundleMetadata(e,t){return this.ar.set(t.id,{id:(i=t).id,version:i.version,createTime:ue(i.createTime)}),m.resolve();var i}getNamedQuery(e,t){return m.resolve(this.ur.get(t))}saveNamedQuery(e,t){return this.ur.set(t.name,{name:(i=t).name,query:uh(i.bundledQuery),readTime:ue(i.readTime)}),m.resolve();var i}}class DP{constructor(){this.overlays=new j(R.comparator),this.cr=new Map}getOverlay(e,t){return m.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ct();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),m.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.cr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.cr.delete(r)),m.resolve()}getOverlaysForCollection(e,t,r){const i=ct(),s=t.length+1,o=new R(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return m.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new j((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);null===l&&(l=ct(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=ct(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return m.resolve(a)}ht(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.cr.get(i.largestBatchId).delete(r.key);this.cr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new eh(t,r));let s=this.cr.get(t);void 0===s&&(s=L(),this.cr.set(t,s)),this.cr.set(t,s.add(r.key))}}class mh{constructor(){this.lr=new H(ve.hr),this.Pr=new H(ve.Ir)}isEmpty(){return this.lr.isEmpty()}addReference(e,t){const r=new ve(e,t);this.lr=this.lr.add(r),this.Pr=this.Pr.add(r)}Tr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Er(new ve(e,t))}dr(e,t){e.forEach(r=>this.removeReference(r,t))}Ar(e){const t=new R(new B([])),r=new ve(t,e),i=new ve(t,e+1),s=[];return this.Pr.forEachInRange([r,i],o=>{this.Er(o),s.push(o.key)}),s}Rr(){this.lr.forEach(e=>this.Er(e))}Er(e){this.lr=this.lr.delete(e),this.Pr=this.Pr.delete(e)}Vr(e){const t=new R(new B([])),r=new ve(t,e),i=new ve(t,e+1);let s=L();return this.Pr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new ve(e,0),r=this.lr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class ve{constructor(e,t){this.key=e,this.mr=t}static hr(e,t){return R.comparator(e.key,t.key)||V(e.mr,t.mr)}static Ir(e,t){return V(e.mr,t.mr)||R.comparator(e.key,t.key)}}class NP{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.gr=1,this.pr=new H(ve.hr)}checkEmpty(e){return m.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.gr;this.gr++;const o=new Jl(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.pr=this.pr.add(new ve(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,t){return m.resolve(this.yr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.wr(t+1),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(0===this.mutationQueue.length?-1:this.gr-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ve(t,0),i=new ve(t,Number.POSITIVE_INFINITY),s=[];return this.pr.forEachInRange([r,i],o=>{const a=this.yr(o.mr);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new H(V);return t.forEach(i=>{const s=new ve(i,0),o=new ve(i,Number.POSITIVE_INFINITY);this.pr.forEachInRange([s,o],a=>{r=r.add(a.mr)})}),m.resolve(this.Sr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;R.isDocumentKey(s)||(s=s.child(""));const o=new ve(new R(s),0);let a=new H(V);return this.pr.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.mr)),!0)},o),m.resolve(this.Sr(a))}Sr(e){const t=[];return e.forEach(r=>{const i=this.yr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){C(0===this.br(t.batchId,"removed")),this.mutationQueue.shift();let r=this.pr;return m.forEach(t.mutations,i=>{const s=new ve(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.pr=r})}Cn(e){}containsKey(e,t){const r=new ve(t,0),i=this.pr.firstAfterOrEqual(r);return m.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return m.resolve()}br(e,t){return this.wr(e)}wr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}yr(e){const t=this.wr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class VP{constructor(e){this.Dr=e,this.docs=new j(R.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Dr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return m.resolve(r?r.document.mutableCopy():Q.newInvalidDocument(t))}getEntries(e,t){let r=Be();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Q.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Be();const o=t.path,a=new R(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Ll(cg(l),r)<=0||(i.has(l.key)||Vi(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,t,r,i){b()}vr(e,t){return m.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new OP(this)}getSize(e){return m.resolve(this.size)}}class OP extends J_{constructor(e){super(),this.sr=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.sr.addEntry(e,i)):this.sr.removeEntry(r)}),m.waitFor(t)}getFromCache(e,t){return this.sr.getEntry(e,t)}getAllFromCache(e,t){return this.sr.getEntries(e,t)}}class LP{constructor(e){this.persistence=e,this.Cr=new At(t=>An(t),Di),this.lastRemoteSnapshotVersion=x.min(),this.highestTargetId=0,this.Fr=0,this.Mr=new mh,this.targetCount=0,this.Or=Dn.xn()}forEachTarget(e,t){return this.Cr.forEach((r,i)=>t(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.Fr)}allocateTargetId(e){return this.highestTargetId=this.Or.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Fr&&(this.Fr=t),m.resolve()}Ln(e){this.Cr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Or=new Dn(t),this.highestTargetId=t),e.sequenceNumber>this.Fr&&(this.Fr=e.sequenceNumber)}addTargetData(e,t){return this.Ln(t),this.targetCount+=1,m.resolve()}updateTargetData(e,t){return this.Ln(t),m.resolve()}removeTargetData(e,t){return this.Cr.delete(t.target),this.Mr.Ar(t.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Cr.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Cr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,t){const r=this.Cr.get(t)||null;return m.resolve(r)}addMatchingKeys(e,t,r){return this.Mr.Tr(t,r),m.resolve()}removeMatchingKeys(e,t,r){this.Mr.dr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Mr.Ar(t),m.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Mr.Vr(t);return m.resolve(r)}containsKey(e,t){return m.resolve(this.Mr.containsKey(t))}}class gh{constructor(e,t){this.Nr={},this.overlays={},this.Br=new Ke(0),this.Lr=!1,this.Lr=!0,this.referenceDelegate=e(this),this.kr=new LP(this),this.indexManager=new TP,this.remoteDocumentCache=new VP(r=>this.referenceDelegate.qr(r)),this.serializer=new x_(t),this.Qr=new kP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Lr=!1,Promise.resolve()}get started(){return this.Lr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new DP,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Nr[e.toKey()];return r||(r=new NP(t,this.referenceDelegate),this.Nr[e.toKey()]=r),r}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Qr}runTransaction(e,t,r){E("MemoryPersistence","Starting transaction:",e);const i=new MP(this.Br.next());return this.referenceDelegate.Kr(),r(i).next(s=>this.referenceDelegate.$r(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ur(e,t){return m.or(Object.values(this.Nr).map(r=>()=>r.containsKey(e,t)))}}class MP extends hg{constructor(e){super(),this.currentSequenceNumber=e}}class Mo{constructor(e){this.persistence=e,this.Wr=new mh,this.Gr=null}static zr(e){return new Mo(e)}get jr(){if(this.Gr)return this.Gr;throw b()}addReference(e,t,r){return this.Wr.addReference(r,t),this.jr.delete(r.toString()),m.resolve()}removeReference(e,t,r){return this.Wr.removeReference(r,t),this.jr.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,t){return this.jr.add(t.toString()),m.resolve()}removeTarget(e,t){this.Wr.Ar(t.targetId).forEach(i=>this.jr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Kr(){this.Gr=new Set}$r(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.jr,r=>{const i=R.fromPath(r);return this.Hr(e,i).next(s=>{s||t.removeEntry(i,x.min())})}).next(()=>(this.Gr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hr(e,t).next(r=>{r?this.jr.delete(t.toString()):this.jr.add(t.toString())})}qr(e){return 0}Hr(e,t){return m.or([()=>m.resolve(this.Wr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ur(e,t)])}}class FP{constructor(e){this.serializer=e}B(e,t,r,i){const s=new ho("createOrUpgrade",t);var u;r<1&&i>=1&&(e.createObjectStore("owner"),(u=e).createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",mg,{unique:!0}),u.createObjectStore("documentMutations"),iy(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=m.resolve();return r<3&&i>=3&&(0!==r&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),iy(e)),o=o.next(()=>function(u){const c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:x.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(0!==r&&(o=o.next(()=>function(u,c){return c.store("mutations").G().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",mg,{unique:!0});const h=c.store("mutations"),f=l.map(p=>h.put(p));return m.waitFor(f)})}(e,s))),o=o.next(()=>{!function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(o=o.next(()=>this.Yr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.Zr(s)))),r<7&&i>=7&&(o=o.next(()=>this.Xr(s))),r<8&&i>=8&&(o=o.next(()=>this.ei(e,s))),r<9&&i>=9&&(o=o.next(()=>{!function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(o=o.next(()=>this.ti(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{!function(u){const c=u.createObjectStore("documentOverlays",{keyPath:TR});c.createIndex("collectionPathOverlayIndex",AR,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",wR,{unique:!1})}(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){const c=u.createObjectStore("remoteDocumentsV14",{keyPath:hR});c.createIndex("documentKeyIndex",dR),c.createIndex("collectionGroupIndex",fR)}(e)).next(()=>this.ni(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ri(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:yR}).createIndex("sequenceNumberIndex",IR,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:vR}).createIndex("documentKeyIndex",ER,{unique:!1})}(e))),o}Zr(e){let t=0;return e.store("remoteDocuments").Z((r,i)=>{t+=Vo(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Yr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.G().next(i=>m.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.G("userMutationsIndex",o).next(a=>m.forEach(a,u=>{C(u.userId===s.userId);const c=Cn(this.serializer,u);return K_(e,s.userId,c).next(()=>{})}))}))}Xr(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Z((o,a)=>{const u=new B(o),c=[0,xe(u)];s.push(t.get(c).next(l=>l?m.resolve():t.put({targetId:0,path:xe(u),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>m.waitFor(s))})}ei(e,t){e.createObjectStore("collectionParents",{keyPath:_R});const r=t.store("collectionParents"),i=new ph,s=o=>{if(i.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:xe(u)})}};return t.store("remoteDocuments").Z({Y:!0},(o,a)=>{const u=new B(o);return s(u.popLast())}).next(()=>t.store("documentMutations").Z({Y:!0},([o,a,u],c)=>{const l=at(a);return s(l.popLast())}))}ti(e){const t=e.store("targets");return t.Z((r,i)=>{const s=Ki(i),o=D_(this.serializer,s);return t.put(o)})}ni(e,t){const r=t.store("remoteDocuments"),i=[];return r.Z((s,o)=>{const a=t.store("remoteDocumentsV14"),u=(h=o,h.document?new R(B.fromString(h.document.name).popFirst(5)):h.noDocument?R.fromSegments(h.noDocument.path):h.unknownDocument?R.fromSegments(h.unknownDocument.path):b()).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};var h;i.push(a.put(c))}).next(()=>m.waitFor(i))}ri(e,t){const r=t.store("mutations"),i=X_(this.serializer),s=new gh(Mo.zr,this.serializer.ct);return r.G().next(o=>{const a=new Map;return o.forEach(u=>{var c;let l=null!==(c=a.get(u.userId))&&void 0!==c?c:L();Cn(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),m.forEach(a,(u,c)=>{const l=new ye(c),h=xo.lt(this.serializer,l),f=s.getIndexManager(l),p=Oo.lt(l,this.serializer,f,s.referenceDelegate);return new ry(i,p,h,f).recalculateAndSaveOverlaysForDocumentKeys(new Ul(t,Ke.ae),u).next()})})}}function iy(n){n.createObjectStore("targetDocuments",{keyPath:mR}).createIndex("documentTargetsIndex",gR,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",pR,{unique:!0}),n.createObjectStore("targetGlobal")}const _h="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class yh{constructor(e,t,r,i,s,o,a,u,c,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ii=s,this.window=o,this.document=a,this.si=c,this.oi=l,this._i=h,this.Br=null,this.Lr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ai=null,this.inForeground=!1,this.ui=null,this.ci=null,this.li=Number.NEGATIVE_INFINITY,this.hi=f=>Promise.resolve(),!yh.v())throw new I(y.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new SP(this,i),this.Pi=t+"main",this.serializer=new x_(u),this.Ii=new et(this.Pi,this._i,new FP(this.serializer)),this.kr=new wP(this.referenceDelegate,this.serializer),this.remoteDocumentCache=X_(this.serializer),this.Qr=new mP,this.window&&this.window.localStorage?this.Ti=this.window.localStorage:(this.Ti=null,!1===l&&ae("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ei().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new I(y.FAILED_PRECONDITION,_h);return this.di(),this.Ai(),this.Ri(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.kr.getHighestSequenceNumber(e))}).then(e=>{this.Br=new Ke(e,this.si)}).then(()=>{this.Lr=!0}).catch(e=>(this.Ii&&this.Ii.close(),Promise.reject(e)))}Vi(e){var t=this;return this.hi=function(){var r=(0,d.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ii.k(function(){var t=(0,d.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((0,d.Z)(function*(){t.started&&(yield t.Ei())})))}Ei(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Uo(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.mi(e).next(t=>{t||(this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.hi(!1)))})}).next(()=>this.fi(e)).next(t=>this.isPrimary&&!t?this.gi(e).next(()=>!1):!!t&&this.pi(e).next(()=>!0))).catch(e=>{if(Gt(e))return E("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return E("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ii.enqueueRetryable(()=>this.hi(e)),this.isPrimary=e})}mi(e){return Yi(e).get("owner").next(t=>m.resolve(this.yi(t)))}wi(e){return Uo(e).delete(this.clientId)}Si(){var e=this;return(0,d.Z)(function*(){if(e.isPrimary&&!e.bi(e.li,18e5)){e.li=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=Ie(r,"clientMetadata");return i.G().next(s=>{const o=e.Di(s,18e5),a=s.filter(u=>-1===o.indexOf(u));return m.forEach(a,u=>i.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.Ti)for(const r of t)e.Ti.removeItem(e.vi(r.clientId))}})()}Ri(){this.ci=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ei().then(()=>this.Si()).then(()=>this.Ri()))}yi(e){return!!e&&e.ownerId===this.clientId}fi(e){return this.oi?m.resolve(!0):Yi(e).get("owner").next(t=>{if(null!==t&&this.bi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.yi(t)&&this.networkEnabled)return!0;if(!this.yi(t)){if(!t.allowTabSynchronization)throw new I(y.FAILED_PRECONDITION,_h);return!1}}return!(!this.networkEnabled||!this.inForeground)||Uo(e).G().next(r=>void 0===this.Di(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&E("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,d.Z)(function*(){e.Lr=!1,e.Fi(),e.ci&&(e.ci.cancel(),e.ci=null),e.Mi(),e.xi(),yield e.Ii.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Ul(t,Ke.ae);return e.gi(r).next(()=>e.wi(r))}),e.Ii.close(),e.Oi()})()}Di(e,t){return e.filter(r=>this.bi(r.updateTimeMs,t)&&!this.Ci(r.clientId))}Ni(){return this.runTransaction("getActiveClients","readonly",e=>Uo(e).G().next(t=>this.Di(t,18e5).map(r=>r.clientId)))}get started(){return this.Lr}getMutationQueue(e,t){return Oo.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new AP(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return xo.lt(this.serializer,e)}getBundleCache(){return this.Qr}runTransaction(e,t,r){E("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(u=this._i)?PR:14===u?Ig:13===u?yg:12===u?RR:11===u?_g:void b();var u;let o;return this.Ii.runTransaction(e,i,s,a=>(o=new Ul(a,this.Br?this.Br.next():Ke.ae),"readwrite-primary"===t?this.mi(o).next(u=>!!u||this.fi(o)).next(u=>{if(!u)throw ae(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.hi(!1)),new I(y.FAILED_PRECONDITION,lg);return r(o)}).next(u=>this.pi(o).next(()=>u)):this.Bi(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Bi(e){return Yi(e).get("owner").next(t=>{if(null!==t&&this.bi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)&&!this.yi(t)&&!(this.oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new I(y.FAILED_PRECONDITION,_h)})}pi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Yi(e).put("owner",t)}static v(){return et.v()}gi(e){const t=Yi(e);return t.get("owner").next(r=>this.yi(r)?(E("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):m.resolve())}bi(e,t){const r=Date.now();return!(e<r-t||e>r&&(ae(`Detected an update time that is in the future: ${e} > ${r}`),1))}di(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ui=()=>{this.ii.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ei()))},this.document.addEventListener("visibilitychange",this.ui),this.inForeground="visible"===this.document.visibilityState)}Mi(){this.ui&&(this.document.removeEventListener("visibilitychange",this.ui),this.ui=null)}Ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ai=()=>{this.Fi();const t=/(?:Version|Mobile)\/1[456]/;(0,_.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ai))}xi(){this.ai&&(this.window.removeEventListener("pagehide",this.ai),this.ai=null)}Ci(e){var t;try{const r=null!==(null===(t=this.Ti)||void 0===t?void 0:t.getItem(this.vi(e)));return E("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ae("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Fi(){if(this.Ti)try{this.Ti.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){ae("Failed to set zombie client id.",e)}}Oi(){if(this.Ti)try{this.Ti.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Yi(n){return Ie(n,"owner")}function Uo(n){return Ie(n,"clientMetadata")}function Ih(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class vh{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Li=r,this.ki=i}static qi(e,t){let r=L(),i=L();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new vh(e,t.fromCache,r,i)}}class sy{constructor(){this.Qi=!1}initialize(e,t){this.Ki=e,this.indexManager=t,this.Qi=!0}getDocumentsMatchingQuery(e,t,r,i){return this.$i(e,t).next(s=>s||this.Ui(e,t,i,r)).next(s=>s||this.Wi(e,t))}$i(e,t){if(zg(t))return m.resolve(null);let r=Ve(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Ao(t,null,"F"),r=Ve(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=L(...s);return this.Ki.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.Gi(t,a);return this.zi(t,c,o,u.readTime)?this.$i(e,Ao(t,null,"F")):this.ji(e,c,t,u)}))})))}Ui(e,t,r,i){return zg(t)||i.isEqual(x.min())?this.Wi(e,t):this.Ki.getDocuments(e,r).next(s=>{const o=this.Gi(t,s);return this.zi(t,o,r,i)?this.Wi(e,t):(Nl()<=Me.in.DEBUG&&E("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Hl(t)),this.ji(e,o,t,ug(i,-1)))})}Gi(e,t){let r=new H($g(e));return t.forEach((i,s)=>{Vi(e,s)&&(r=r.add(s))}),r}zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Wi(e,t){return Nl()<=Me.in.DEBUG&&E("QueryEngine","Using full collection scan to execute query:",Hl(t)),this.Ki.getDocumentsMatchingQuery(e,t,We.min())}ji(e,t,r,i){return this.Ki.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class UP{constructor(e,t,r,i){this.persistence=e,this.Hi=t,this.serializer=i,this.Ji=new j(V),this.Yi=new At(s=>An(s),Di),this.Zi=new Map,this.Xi=e.getRemoteDocumentCache(),this.kr=e.getTargetCache(),this.Qr=e.getBundleCache(),this.es(r)}es(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ry(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}function oy(n,e,t,r){return new UP(n,e,t,r)}function ay(n,e){return Eh.apply(this,arguments)}function Eh(){return Eh=(0,d.Z)(function*(n,e){const t=P(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.es(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let u=L();for(const c of i){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of s){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({ts:c,removedBatchIds:o,addedBatchIds:a}))})})}),Eh.apply(this,arguments)}function uy(n){const e=P(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.kr.getLastRemoteSnapshotVersion(t))}function cy(n,e,t){let r=L(),i=L();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Be();return t.forEach((a,u)=>{const c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(x.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):E("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{ns:o,rs:i}})}function GP(n,e){const t=P(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Er(n,e){const t=P(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.kr.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):t.kr.allocateTargetId(r).next(o=>(i=new Rt(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.kr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.Ji.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ji=t.Ji.insert(r.targetId,r),t.Yi.set(e,r.targetId)),r})}function Tr(n,e,t){return Th.apply(this,arguments)}function Th(){return Th=(0,d.Z)(function*(n,e,t){const r=P(n),i=r.Ji.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Gt(o))throw o;E("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ji=r.Ji.remove(e),r.Yi.delete(i.target)}),Th.apply(this,arguments)}function Bo(n,e,t){const r=P(n);let i=x.min(),s=L();return r.persistence.runTransaction("Execute query","readonly",o=>function(u,c,l){const h=P(u),f=h.Yi.get(l);return void 0!==f?m.resolve(h.Ji.get(f)):h.kr.getTargetData(c,l)}(r,o,Ve(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.kr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.Hi.getDocumentsMatchingQuery(o,e,t?i:x.min(),t?s:L())).next(a=>(dy(r,Kg(e),a),{documents:a,ss:s})))}function ly(n,e){const t=P(n),r=P(t.kr),i=t.Ji.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ut(s,e).next(o=>o?o.target:null))}function hy(n,e){const t=P(n),r=t.Zi.get(e)||x.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Xi.getAllFromCollectionGroup(i,e,ug(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(dy(t,e,i),i))}function dy(n,e,t){let r=n.Zi.get(e)||x.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.Zi.set(e,r)}function Ah(){return Ah=(0,d.Z)(function*(n,e,t,r){const i=P(n);let s=L(),o=Be();for(const c of t){const l=e.os(c.metadata.name);c.document&&(s=s.add(l));const h=e._s(c);h.setReadTime(e.us(c.metadata.readTime)),o=o.insert(l,h)}const a=i.Xi.newChangeBuffer({trackRemovals:!0}),u=yield Er(i,(l=r,Ve(dr(B.fromString(`__bundle__/docs/${l}`)))));var l;return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>cy(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.kr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.kr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.ns,l.rs)).next(()=>l.ns)))}),Ah.apply(this,arguments)}function WP(n,e){return wh.apply(this,arguments)}function wh(){return wh=(0,d.Z)(function*(n,e,t=L()){const r=yield Er(n,Ve(uh(e.bundledQuery))),i=P(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=ue(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qr.saveNamedQuery(s,e);const a=r.withResumeToken(fe.EMPTY_BYTE_STRING,o);return i.Ji=i.Ji.insert(a.targetId,a),i.kr.updateTargetData(s,a).next(()=>i.kr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.kr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Qr.saveNamedQuery(s,e))})}),wh.apply(this,arguments)}function fy(n,e){return`firestore_clients_${n}_${e}`}function py(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Rh(n,e){return`firestore_targets_${n}_${e}`}class qo{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static cs(e,t,r){const i=JSON.parse(r);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new I(i.error.code,i.error.message))),o?new qo(e,t,i.state,s):(ae("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}ls(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ji{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static cs(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new I(r.error.code,r.error.message))),s?new Ji(e,r.state,i):(ae("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ls(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Go{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static cs(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=Ql();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=fg(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new Go(e,s):(ae("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ph{constructor(e,t){this.clientId=e,this.onlineState=t}static cs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ph(t.clientId,t.onlineState):(ae("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Sh{constructor(){this.activeTargetIds=Ql()}hs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ps(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ls(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class bh{constructor(e,t,r,i,s){this.window=e,this.ii=t,this.persistenceKey=r,this.Is=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ts=this.Es.bind(this),this.ds=new j(V),this.started=!1,this.As=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Rs=fy(this.persistenceKey,this.Is),this.Vs=`firestore_sequence_number_${this.persistenceKey}`,this.ds=this.ds.insert(this.Is,new Sh),this.fs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.gs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.ps=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.ys=`firestore_online_state_${this.persistenceKey}`,this.ws=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Ts)}static v(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,d.Z)(function*(){const t=yield e.syncEngine.Ni();for(const i of t){if(i===e.Is)continue;const s=e.getItem(fy(e.persistenceKey,i));if(s){const o=Go.cs(i,s);o&&(e.ds=e.ds.insert(o.clientId,o))}}e.Ss();const r=e.storage.getItem(e.ys);if(r){const i=e.bs(r);i&&e.Ds(i)}for(const i of e.As)e.Es(i);e.As=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.vs(this.ds)}isActiveQueryTarget(e){let t=!1;return this.ds.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Cs(e,"pending")}updateMutationState(e,t,r){this.Cs(e,t,r),this.Fs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Rh(this.persistenceKey,e));if(r){const i=Ji.cs(e,r);i&&(t=i.state)}}return this.Ms.hs(e),this.Ss(),t}removeLocalQueryTarget(e){this.Ms.Ps(e),this.Ss()}isLocalQueryTarget(e){return this.Ms.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Rh(this.persistenceKey,e))}updateQueryState(e,t,r){this.xs(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Fs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Os(e)}notifyBundleLoaded(e){this.Ns(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ts),this.removeItem(this.Rs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return E("SharedClientState","READ",e,t),t}setItem(e,t){E("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){E("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Es(e){var t=this;const r=e;if(r.storageArea===this.storage){if(E("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Rs)return void ae("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable((0,d.Z)(function*(){if(t.started){if(null!==r.key)if(t.fs.test(r.key)){if(null==r.newValue){const i=t.Bs(r.key);return t.Ls(i,null)}{const i=t.ks(r.key,r.newValue);if(i)return t.Ls(i.clientId,i)}}else if(t.gs.test(r.key)){if(null!==r.newValue){const i=t.qs(r.key,r.newValue);if(i)return t.Qs(i)}}else if(t.ps.test(r.key)){if(null!==r.newValue){const i=t.Ks(r.key,r.newValue);if(i)return t.$s(i)}}else if(r.key===t.ys){if(null!==r.newValue){const i=t.bs(r.newValue);if(i)return t.Ds(i)}}else if(r.key===t.Vs){const i=function(o){let a=Ke.ae;if(null!=o)try{const u=JSON.parse(o);C("number"==typeof u),a=u}catch(u){ae("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(r.newValue);i!==Ke.ae&&t.sequenceNumberHandler(i)}else if(r.key===t.ws){const i=t.Us(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Ws(s)))}}else t.As.push(r)}))}}get Ms(){return this.ds.get(this.Is)}Ss(){this.setItem(this.Rs,this.Ms.ls())}Cs(e,t,r){const i=new qo(this.currentUser,e,t,r),s=py(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ls())}Fs(e){const t=py(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Os(e){this.storage.setItem(this.ys,JSON.stringify({clientId:this.Is,onlineState:e}))}xs(e,t,r){const i=Rh(this.persistenceKey,e),s=new Ji(e,t,r);this.setItem(i,s.ls())}Ns(e){const t=JSON.stringify(Array.from(e));this.setItem(this.ws,t)}Bs(e){const t=this.fs.exec(e);return t?t[1]:null}ks(e,t){const r=this.Bs(e);return Go.cs(r,t)}qs(e,t){const r=this.gs.exec(e),i=Number(r[1]);return qo.cs(new ye(void 0!==r[2]?r[2]:null),i,t)}Ks(e,t){const r=this.ps.exec(e),i=Number(r[1]);return Ji.cs(i,t)}bs(e){return Ph.cs(e)}Us(e){return JSON.parse(e)}Qs(e){var t=this;return(0,d.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Gs(e.batchId,e.state,e.error);E("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}$s(e){return this.syncEngine.zs(e.targetId,e.state,e.error)}Ls(e,t){const r=t?this.ds.insert(e,t):this.ds.remove(e),i=this.vs(this.ds),s=this.vs(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.js(o,a).then(()=>{this.ds=r})}Ds(e){this.ds.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}vs(e){let t=Ql();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class my{constructor(){this.Hs=new Sh,this.Js={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Hs.hs(e),this.Js[e]||"not-current"}updateQueryState(e,t,r){this.Js[e]=t}removeLocalQueryTarget(e){this.Hs.Ps(e)}isLocalQueryTarget(e){return this.Hs.activeTargetIds.has(e)}clearQueryState(e){delete this.Js[e]}getAllActiveQueryTargets(){return this.Hs.activeTargetIds}isActiveQueryTarget(e){return this.Hs.activeTargetIds.has(e)}start(){return this.Hs=new Sh,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class KP{Ys(e){}shutdown(){}}class gy{constructor(){this.Zs=()=>this.Xs(),this.eo=()=>this.no(),this.ro=[],this.io()}Ys(e){this.ro.push(e)}shutdown(){window.removeEventListener("online",this.Zs),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Zs),window.addEventListener("offline",this.eo)}Xs(){E("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ro)e(0)}no(){E("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ro)e(1)}static v(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let zo=null;function Ch(){return null===zo?zo=268435456+Math.round(2147483648*Math.random()):zo++,"0x"+zo.toString(16)}const $P={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class jP{constructor(e){this.so=e.so,this.oo=e.oo}_o(e){this.ao=e}uo(e){this.co=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.so(e)}ho(){this.ao()}Po(e){this.co(e)}Io(e){this.lo(e)}}const De="WebChannelConnection";class ZP extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.To=r+"://"+t.host,this.Eo=`projects/${i}/databases/${s}`,this.Ao="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Ro(){return!1}Vo(t,r,i,s,o){const a=Ch(),u=this.mo(t,r);E("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);const c={"google-cloud-resource-prefix":this.Eo,"x-goog-request-params":this.Ao};return this.fo(c,s,o),this.po(t,u,c,i).then(l=>(E("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw Ze("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}yo(t,r,i,s,o,a){return this.Vo(t,r,i,s,o)}fo(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+or,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}mo(t,r){return`${this.To}/v1/${r}:${$P[t]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}po(e,t,r,i){const s=Ch();return new Promise((o,a)=>{const u=new K0;u.setWithCredentials(!0),u.listenOnce(G0.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Dl.NO_ERROR:const l=u.getResponseJson();E(De,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case Dl.TIMEOUT:E(De,`RPC '${e}' ${s} timed out`),a(new I(y.DEADLINE_EXCEEDED,"Request time out"));break;case Dl.HTTP_ERROR:const h=u.getStatus();if(E(De,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let f=u.getResponseJson();Array.isArray(f)&&(f=f[0]);const p=f?.error;if(p&&p.status&&p.message){const v=function(w){const k=w.toLowerCase().replace(/_/g,"-");return Object.values(y).indexOf(k)>=0?k:y.UNKNOWN}(p.status);a(new I(v,p.message))}else a(new I(y.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new I(y.UNAVAILABLE,"Connection failed."));break;default:b()}}finally{E(De,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);E(De,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}wo(e,t,r){const i=Ch(),s=[this.To,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=B0(),a=q0(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new W0({})),this.fo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const l=s.join("");E(De,`Creating RPC '${e}' stream ${i}: ${l}`,u);const h=o.createWebChannel(l,u);let f=!1,p=!1;const v=new jP({so:w=>{p?E(De,`Not sending because RPC '${e}' stream ${i} is closed:`,w):(f||(E(De,`Opening RPC '${e}' stream ${i} transport.`),h.open(),f=!0),E(De,`RPC '${e}' stream ${i} sending:`,w),h.send(w))},oo:()=>h.close()}),A=(w,k,N)=>{w.listen(k,D=>{try{N(D)}catch(M){setTimeout(()=>{throw M},0)}})};return A(h,uo.EventType.OPEN,()=>{p||E(De,`RPC '${e}' stream ${i} transport opened.`)}),A(h,uo.EventType.CLOSE,()=>{p||(p=!0,E(De,`RPC '${e}' stream ${i} transport closed`),v.Po())}),A(h,uo.EventType.ERROR,w=>{p||(p=!0,Ze(De,`RPC '${e}' stream ${i} transport errored:`,w),v.Po(new I(y.UNAVAILABLE,"The operation could not be completed")))}),A(h,uo.EventType.MESSAGE,w=>{var k;if(!p){const N=w.data[0];C(!!N);const M=N.error||(null===(k=N[0])||void 0===k?void 0:k.error);if(M){E(De,`RPC '${e}' stream ${i} received error:`,M);const z=M.status;let G=function(ps){const la=he[ps];if(void 0!==la)return l_(la)}(z),pe=M.message;void 0===G&&(G=y.INTERNAL,pe="Unknown error status: "+z+" with message "+M.message),p=!0,v.Po(new I(G,pe)),h.close()}else E(De,`RPC '${e}' stream ${i} received:`,N),v.Io(N)}}),A(a,z0.STAT_EVENT,w=>{w.stat===ng.PROXY?E(De,`RPC '${e}' stream ${i} detected buffering proxy`):w.stat===ng.NOPROXY&&E(De,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{v.ho()},0),v}}function _y(){return typeof window<"u"?window:null}function Wo(){return typeof document<"u"?document:null}function Xi(n){return new iP(n,!0)}class xh{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ii=e,this.timerId=t,this.So=r,this.bo=i,this.Do=s,this.vo=0,this.Co=null,this.Fo=Date.now(),this.reset()}reset(){this.vo=0}Mo(){this.vo=this.Do}xo(e){this.cancel();const t=Math.floor(this.vo+this.Oo()),r=Math.max(0,Date.now()-this.Fo),i=Math.max(0,t-r);i>0&&E("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.vo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Co=this.ii.enqueueAfterDelay(this.timerId,i,()=>(this.Fo=Date.now(),e())),this.vo*=this.bo,this.vo<this.So&&(this.vo=this.So),this.vo>this.Do&&(this.vo=this.Do)}No(){null!==this.Co&&(this.Co.skipDelay(),this.Co=null)}cancel(){null!==this.Co&&(this.Co.cancel(),this.Co=null)}Oo(){return(Math.random()-.5)*this.vo}}class yy{constructor(e,t,r,i,s,o,a,u){this.ii=e,this.Bo=r,this.Lo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.ko=0,this.qo=null,this.Qo=null,this.stream=null,this.Ko=new xh(e,t)}$o(){return 1===this.state||5===this.state||this.Uo()}Uo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Wo()}stop(){var e=this;return(0,d.Z)(function*(){e.$o()&&(yield e.close(0))})()}Go(){this.state=0,this.Ko.reset()}zo(){this.Uo()&&null===this.qo&&(this.qo=this.ii.enqueueAfterDelay(this.Bo,6e4,()=>this.jo()))}Ho(e){this.Jo(),this.stream.send(e)}jo(){var e=this;return(0,d.Z)(function*(){if(e.Uo())return e.close(0)})()}Jo(){this.qo&&(this.qo.cancel(),this.qo=null)}Yo(){this.Qo&&(this.Qo.cancel(),this.Qo=null)}close(e,t){var r=this;return(0,d.Z)(function*(){r.Jo(),r.Yo(),r.Ko.cancel(),r.ko++,4!==e?r.Ko.reset():t&&t.code===y.RESOURCE_EXHAUSTED?(ae(t.toString()),ae("Using maximum backoff delay to prevent overloading the backend."),r.Ko.Mo()):t&&t.code===y.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Zo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.uo(t)})()}Zo(){}auth(){this.state=1;const e=this.Xo(this.ko),t=this.ko;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.ko===t&&this.e_(r,i)},r=>{e(()=>{const i=new I(y.UNKNOWN,"Fetching auth token failed: "+r.message);return this.t_(i)})})}e_(e,t){const r=this.Xo(this.ko);this.stream=this.n_(e,t),this.stream._o(()=>{r(()=>(this.state=2,this.Qo=this.ii.enqueueAfterDelay(this.Lo,1e4,()=>(this.Uo()&&(this.state=3),Promise.resolve())),this.listener._o()))}),this.stream.uo(i=>{r(()=>this.t_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Wo(){var e=this;this.state=5,this.Ko.xo((0,d.Z)(function*(){e.state=0,e.start()}))}t_(e){return E("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.ko===e?t():(E("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class HP extends yy{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}n_(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.Ko.reset();const t=function aP(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(c=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:b(),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(C(void 0===l||"string"==typeof l),fe.fromBase64String(l||"")):(C(void 0===l||l instanceof Uint8Array),fe.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const l=void 0===c.code?y.UNKNOWN:l_(c.code);return new I(l,c.message||"")}(o);t=new m_(r,i,s,a||null)}else if("documentChange"in e){const r=e.documentChange,i=lt(n,r.document.name),s=ue(r.document.updateTime),o=r.document.createTime?ue(r.document.createTime):x.min(),a=new Re({mapValue:{fields:r.document.fields}}),u=Q.newFoundDocument(i,s,o,a);t=new bo(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,i=lt(n,r.document),s=r.readTime?ue(r.readTime):x.min(),o=Q.newNoDocument(i,s);t=new bo([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=lt(n,r.document);t=new bo([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return b();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new JR(i,s);t=new p_(r.targetId,o)}}var c;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return x.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?x.min():o.readTime?ue(o.readTime):x.min()}(e);return this.listener.r_(t,r)}i_(e){const t={};t.database=zi(this.serializer),t.addTarget=function(s,o){let a;const u=o.target;if(a=vo(u)?{documents:R_(s,u)}:{query:ah(s,u)},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=I_(s,o.resumeToken);const c=rh(s,o.expectedCount);null!==c&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(x.min())>0){a.readTime=_r(s,o.snapshotVersion.toTimestamp());const c=rh(s,o.expectedCount);null!==c&&(a.expectedCount=c)}return a}(this.serializer,e);const r=function cP(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return b()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Ho(t)}s_(e){const t={};t.database=zi(this.serializer),t.removeTarget=e,this.Ho(t)}}class QP extends yy{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.o_=!1}get __(){return this.o_}start(){this.o_=!1,this.lastStreamToken=void 0,super.start()}Zo(){this.o_&&this.a_([])}n_(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(C(!!e.streamToken),this.lastStreamToken=e.streamToken,this.o_){this.Ko.reset();const t=function uP(n,e){return n&&n.length>0?(C(void 0!==e),n.map(t=>function(i,s){let o=ue(i.updateTime?i.updateTime:s);return o.isEqual(x.min())&&(o=ue(s)),new ZR(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=ue(e.commitTime);return this.listener.u_(r,t)}return C(!e.writeResults||0===e.writeResults.length),this.o_=!0,this.listener.c_()}l_(){const e={};e.database=zi(this.serializer),this.Ho(e)}a_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Wi(this.serializer,r))};this.Ho(t)}}class YP extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.h_=!1}P_(){if(this.h_)throw new I(y.FAILED_PRECONDITION,"The client has already been terminated.")}Vo(e,t,r){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Vo(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new I(y.UNKNOWN,i.toString())})}yo(e,t,r,i){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.yo(e,t,r,s,o,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new I(y.UNKNOWN,s.toString())})}terminate(){this.h_=!0}}class XP{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.T_=0,this.E_=null,this.d_=!0}A_(){0===this.T_&&(this.R_("Unknown"),this.E_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.E_=null,this.V_("Backend didn't respond within 10 seconds."),this.R_("Offline"),Promise.resolve())))}m_(e){"Online"===this.state?this.R_("Unknown"):(this.T_++,this.T_>=1&&(this.f_(),this.V_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.R_("Offline")))}set(e){this.f_(),this.T_=0,"Online"===e&&(this.d_=!1),this.R_(e)}R_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}V_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.d_?(ae(t),this.d_=!1):E("OnlineStateTracker",t)}f_(){null!==this.E_&&(this.E_.cancel(),this.E_=null)}}class eS{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.g_=[],this.p_=new Map,this.y_=new Set,this.w_=[],this.S_=s,this.S_.Ys(a=>{r.enqueueAndForget((0,d.Z)(function*(){var u;en(o)&&(E("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,d.Z)(function*(l){const h=P(l);h.y_.add(4),yield Ar(h),h.b_.set("Unknown"),h.y_.delete(4),yield es(h)}),function c(l){return u.apply(this,arguments)})(o))}))}),this.b_=new XP(r,i)}}function es(n){return Dh.apply(this,arguments)}function Dh(){return Dh=(0,d.Z)(function*(n){if(en(n))for(const e of n.w_)yield e(!0)}),Dh.apply(this,arguments)}function Ar(n){return Nh.apply(this,arguments)}function Nh(){return Nh=(0,d.Z)(function*(n){for(const e of n.w_)yield e(!1)}),Nh.apply(this,arguments)}function Ko(n,e){const t=P(n);t.p_.has(e.targetId)||(t.p_.set(e.targetId,e),Lh(t)?Oh(t):Rr(t).Uo()&&Vh(t,e))}function ts(n,e){const t=P(n),r=Rr(t);t.p_.delete(e),r.Uo()&&Iy(t,e),0===t.p_.size&&(r.Uo()?r.zo():en(t)&&t.b_.set("Unknown"))}function Vh(n,e){if(n.D_.Be(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(x.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Rr(n).i_(e)}function Iy(n,e){n.D_.Be(e),Rr(n).s_(e)}function Oh(n){n.D_=new eP({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>n.p_.get(e)||null,rt:()=>n.datastore.serializer.databaseId}),Rr(n).start(),n.b_.A_()}function Lh(n){return en(n)&&!Rr(n).$o()&&n.p_.size>0}function en(n){return 0===P(n).y_.size}function vy(n){n.D_=void 0}function tS(n){return Mh.apply(this,arguments)}function Mh(){return Mh=(0,d.Z)(function*(n){n.p_.forEach((e,t)=>{Vh(n,e)})}),Mh.apply(this,arguments)}function nS(n,e){return Fh.apply(this,arguments)}function Fh(){return Fh=(0,d.Z)(function*(n,e){vy(n),Lh(n)?(n.b_.m_(e),Oh(n)):n.b_.set("Unknown")}),Fh.apply(this,arguments)}function rS(n,e,t){return Uh.apply(this,arguments)}function Uh(){return Uh=(0,d.Z)(function*(n,e,t){if(n.b_.set("Online"),e instanceof m_&&2===e.state&&e.cause)try{yield(r=(0,d.Z)(function*(s,o){const a=o.cause;for(const u of o.targetIds)s.p_.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.p_.delete(u),s.D_.removeTarget(u))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){E("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield $o(n,r)}else if(e instanceof bo?n.D_.We(e):e instanceof p_?n.D_.Ze(e):n.D_.je(e),!t.isEqual(x.min()))try{const r=yield uy(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const a=s.D_.st(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const l=s.p_.get(c);l&&s.p_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{const l=s.p_.get(u);if(!l)return;s.p_.set(u,l.withResumeToken(fe.EMPTY_BYTE_STRING,l.snapshotVersion)),Iy(s,u);const h=new Rt(l.target,u,c,l.sequenceNumber);Vh(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){E("RemoteStore","Failed to raise snapshot:",r),yield $o(n,r)}var r}),Uh.apply(this,arguments)}function $o(n,e,t){return Bh.apply(this,arguments)}function Bh(){return Bh=(0,d.Z)(function*(n,e,t){if(!Gt(e))throw e;n.y_.add(1),yield Ar(n),n.b_.set("Offline"),t||(t=()=>uy(n.localStore)),n.asyncQueue.enqueueRetryable((0,d.Z)(function*(){E("RemoteStore","Retrying IndexedDB access"),yield t(),n.y_.delete(1),yield es(n)}))}),Bh.apply(this,arguments)}function Ey(n,e){return e().catch(t=>$o(n,t,e))}function wr(n){return qh.apply(this,arguments)}function qh(){return qh=(0,d.Z)(function*(n){const e=P(n),t=tn(e);let r=e.g_.length>0?e.g_[e.g_.length-1].batchId:-1;for(;iS(e);)try{const i=yield GP(e.localStore,r);if(null===i){0===e.g_.length&&t.zo();break}r=i.batchId,sS(e,i)}catch(i){yield $o(e,i)}Ty(e)&&Ay(e)}),qh.apply(this,arguments)}function iS(n){return en(n)&&n.g_.length<10}function sS(n,e){n.g_.push(e);const t=tn(n);t.Uo()&&t.__&&t.a_(e.mutations)}function Ty(n){return en(n)&&!tn(n).$o()&&n.g_.length>0}function Ay(n){tn(n).start()}function oS(n){return Gh.apply(this,arguments)}function Gh(){return Gh=(0,d.Z)(function*(n){tn(n).l_()}),Gh.apply(this,arguments)}function aS(n){return zh.apply(this,arguments)}function zh(){return zh=(0,d.Z)(function*(n){const e=tn(n);for(const t of n.g_)e.a_(t.mutations)}),zh.apply(this,arguments)}function uS(n,e,t){return Wh.apply(this,arguments)}function Wh(){return Wh=(0,d.Z)(function*(n,e,t){const r=n.g_.shift(),i=Xl.from(r,e,t);yield Ey(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield wr(n)}),Wh.apply(this,arguments)}function cS(n,e){return Kh.apply(this,arguments)}function Kh(){return Kh=(0,d.Z)(function*(n,e){var t;e&&tn(n).__&&(yield(t=(0,d.Z)(function*(i,s){if(c_(a=s.code)&&a!==y.ABORTED){const o=i.g_.shift();tn(i).Go(),yield Ey(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield wr(i)}var a}),function r(i,s){return t.apply(this,arguments)})(n,e)),Ty(n)&&Ay(n)}),Kh.apply(this,arguments)}function wy(n,e){return $h.apply(this,arguments)}function $h(){return $h=(0,d.Z)(function*(n,e){const t=P(n);t.asyncQueue.verifyOperationInProgress(),E("RemoteStore","RemoteStore received new credentials");const r=en(t);t.y_.add(3),yield Ar(t),r&&t.b_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.y_.delete(3),yield es(t)}),$h.apply(this,arguments)}function jh(n,e){return Zh.apply(this,arguments)}function Zh(){return Zh=(0,d.Z)(function*(n,e){const t=P(n);e?(t.y_.delete(2),yield es(t)):e||(t.y_.add(2),yield Ar(t),t.b_.set("Unknown"))}),Zh.apply(this,arguments)}function Rr(n){return n.v_||(n.v_=function(t,r,i){const s=P(t);return s.P_(),new HP(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{_o:tS.bind(null,n),uo:nS.bind(null,n),r_:rS.bind(null,n)}),n.w_.push(function(){var e=(0,d.Z)(function*(t){t?(n.v_.Go(),Lh(n)?Oh(n):n.b_.set("Unknown")):(yield n.v_.stop(),vy(n))});return function(t){return e.apply(this,arguments)}}())),n.v_}function tn(n){return n.C_||(n.C_=function(t,r,i){const s=P(t);return s.P_(),new QP(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{_o:oS.bind(null,n),uo:cS.bind(null,n),c_:aS.bind(null,n),u_:uS.bind(null,n)}),n.w_.push(function(){var e=(0,d.Z)(function*(t){t?(n.C_.Go(),yield wr(n)):(yield n.C_.stop(),n.g_.length>0&&(E("RemoteStore",`Stopping write stream with ${n.g_.length} pending writes`),n.g_=[]))});return function(t){return e.apply(this,arguments)}}())),n.C_}class Hh{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new de,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new Hh(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new I(y.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Pr(n,e){if(ae("AsyncQueue",`${e}: ${n}`),Gt(n))return new I(y.UNAVAILABLE,`${e}: ${n}`);throw n}class Sr{constructor(e){this.comparator=e?(t,r)=>e(t,r)||R.comparator(t.key,r.key):(t,r)=>R.comparator(t.key,r.key),this.keyedMap=Oi(),this.sortedSet=new j(this.comparator)}static emptySet(e){return new Sr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Sr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Sr;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Ry{constructor(){this.F_=new j(R.comparator)}track(e){const t=e.doc.key,r=this.F_.get(t);r?0!==e.type&&3===r.type?this.F_=this.F_.insert(t,e):3===e.type&&1!==r.type?this.F_=this.F_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.F_=this.F_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.F_=this.F_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.F_=this.F_.remove(t):1===e.type&&2===r.type?this.F_=this.F_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.F_=this.F_.insert(t,{type:2,doc:e.doc}):b():this.F_=this.F_.insert(t,e)}M_(){const e=[];return this.F_.inorderTraversal((t,r)=>{e.push(r)}),e}}class br{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new br(e,t,Sr.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ni(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class lS{constructor(){this.x_=void 0,this.listeners=[]}}class hS{constructor(){this.queries=new At(e=>Wg(e),Ni),this.onlineState="Unknown",this.O_=new Set}}function Qh(n,e){return Yh.apply(this,arguments)}function Yh(){return Yh=(0,d.Z)(function*(n,e){const t=P(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new lS),i)try{s.x_=yield t.onListen(r)}catch(o){const a=Pr(o,`Initialization of query '${Hl(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.listeners.push(e),e.N_(t.onlineState),s.x_&&e.B_(s.x_)&&ed(t)}),Yh.apply(this,arguments)}function Jh(n,e){return Xh.apply(this,arguments)}function Xh(){return Xh=(0,d.Z)(function*(n,e){const t=P(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),Xh.apply(this,arguments)}function dS(n,e){const t=P(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const a of o.listeners)a.B_(i)&&(r=!0);o.x_=i}}r&&ed(t)}function fS(n,e,t){const r=P(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function ed(n){n.O_.forEach(e=>{e.next()})}class td{constructor(e,t,r){this.query=e,this.L_=t,this.k_=!1,this.q_=null,this.onlineState="Unknown",this.options=r||{}}B_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new br(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.k_?this.Q_(e)&&(this.L_.next(e),t=!0):this.K_(e,this.onlineState)&&(this.U_(e),t=!0),this.q_=e,t}onError(e){this.L_.error(e)}N_(e){this.onlineState=e;let t=!1;return this.q_&&!this.k_&&this.K_(this.q_,e)&&(this.U_(this.q_),t=!0),t}K_(e,t){return!e.fromCache||(!this.options.W_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Q_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.q_&&this.q_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}U_(e){e=br.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.k_=!0,this.L_.next(e)}}class pS{constructor(e,t){this.G_=e,this.byteLength=t}z_(){return"metadata"in this.G_}}class Py{constructor(e){this.serializer=e}os(e){return lt(this.serializer,e)}_s(e){return e.metadata.exists?w_(this.serializer,e.document,!1):Q.newNoDocument(this.os(e.metadata.name),this.us(e.metadata.readTime))}us(e){return ue(e)}}class mS{constructor(e,t,r){this.j_=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Sy(e)}H_(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.G_.namedQuery)this.queries.push(e.G_.namedQuery);else if(e.G_.documentMetadata){this.documents.push({metadata:e.G_.documentMetadata}),e.G_.documentMetadata.exists||++t;const r=B.fromString(e.G_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.G_.document&&(this.documents[this.documents.length-1].document=e.G_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}J_(e){const t=new Map,r=new Py(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.os(i.metadata.name);for(const o of i.metadata.queries){const a=(t.get(o)||L()).add(s);t.set(o,a)}}return t}complete(){var e=this;return(0,d.Z)(function*(){const t=yield function zP(n,e,t,r){return Ah.apply(this,arguments)}(e.localStore,new Py(e.serializer),e.documents,e.j_.id),r=e.J_(e.documents);for(const i of e.queries)yield WP(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Y_:e.collectionGroups,Z_:t}})()}}function Sy(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class by{constructor(e){this.key=e}}class Cy{constructor(e){this.key=e}}class xy{constructor(e,t){this.query=e,this.X_=t,this.ea=null,this.hasCachedResults=!1,this.current=!1,this.ta=L(),this.mutatedKeys=L(),this.na=$g(e),this.ra=new Sr(this.na)}get ia(){return this.X_}sa(e,t){const r=t?t.oa:new Ry,i=t?t.ra:this.ra;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{const f=i.get(l),p=Vi(this.query,h)?h:null,v=!!f&&this.mutatedKeys.has(f.key),A=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let w=!1;f&&p?f.data.isEqual(p.data)?v!==A&&(r.track({type:3,doc:p}),w=!0):this._a(f,p)||(r.track({type:2,doc:p}),w=!0,(u&&this.na(p,u)>0||c&&this.na(p,c)<0)&&(a=!0)):!f&&p?(r.track({type:0,doc:p}),w=!0):f&&!p&&(r.track({type:1,doc:f}),w=!0,(u||c)&&(a=!0)),w&&(p?(o=o.add(p),s=A?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{ra:o,oa:r,zi:a,mutatedKeys:s}}_a(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.ra;this.ra=e.ra,this.mutatedKeys=e.mutatedKeys;const s=e.oa.M_();s.sort((c,l)=>function(f,p){const v=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return b()}};return v(f)-v(p)}(c.type,l.type)||this.na(c.doc,l.doc)),this.aa(r);const o=t?this.ua():[],a=0===this.ta.size&&this.current?1:0,u=a!==this.ea;return this.ea=a,0!==s.length||u?{snapshot:new br(this.query,e.ra,i,s,e.mutatedKeys,0===a,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),ca:o}:{ca:o}}N_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ra:this.ra,oa:new Ry,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{ca:[]}}la(e){return!this.X_.has(e)&&!!this.ra.has(e)&&!this.ra.get(e).hasLocalMutations}aa(e){e&&(e.addedDocuments.forEach(t=>this.X_=this.X_.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.X_=this.X_.delete(t)),this.current=e.current)}ua(){if(!this.current)return[];const e=this.ta;this.ta=L(),this.ra.forEach(r=>{this.la(r.key)&&(this.ta=this.ta.add(r.key))});const t=[];return e.forEach(r=>{this.ta.has(r)||t.push(new Cy(r))}),this.ta.forEach(r=>{e.has(r)||t.push(new by(r))}),t}ha(e){this.X_=e.ss,this.ta=L();const t=this.sa(e.documents);return this.applyChanges(t,!0)}Pa(){return br.fromInitialDocuments(this.query,this.ra,this.mutatedKeys,0===this.ea,this.hasCachedResults)}}class gS{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class _S{constructor(e){this.key=e,this.Ia=!1}}class yS{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ta={},this.Ea=new At(a=>Wg(a),Ni),this.da=new Map,this.Aa=new Set,this.Ra=new j(R.comparator),this.Va=new Map,this.ma=new mh,this.fa={},this.ga=new Map,this.pa=Dn.On(),this.onlineState="Unknown",this.ya=void 0}get isPrimaryClient(){return!0===this.ya}}function IS(n,e){return nd.apply(this,arguments)}function nd(){return nd=(0,d.Z)(function*(n,e){const t=Rd(n);let r,i;const s=t.Ea.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Pa();else{const o=yield Er(t.localStore,Ve(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield rd(t,e,r,"current"===a,o.resumeToken),t.isPrimaryClient&&Ko(t.remoteStore,o)}return i}),nd.apply(this,arguments)}function rd(n,e,t,r,i){return id.apply(this,arguments)}function id(){return id=(0,d.Z)(function*(n,e,t,r,i){n.wa=(h,f,p)=>{return(v=(0,d.Z)(function*(w,k,N,D){let M=k.view.sa(N);M.zi&&(M=yield Bo(w.localStore,k.query,!1).then(({documents:pe})=>k.view.sa(pe,M)));const z=D&&D.targetChanges.get(k.targetId),G=k.view.applyChanges(M,w.isPrimaryClient,z);return pd(w,k.targetId,G.ca),G.snapshot}),function A(w,k,N,D){return v.apply(this,arguments)})(n,h,f,p);var v};const s=yield Bo(n.localStore,e,!0),o=new xy(e,s.ss),a=o.sa(s.documents),u=qi.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),c=o.applyChanges(a,n.isPrimaryClient,u);pd(n,t,c.ca);const l=new gS(e,t,o);return n.Ea.set(e,l),n.da.has(t)?n.da.get(t).push(e):n.da.set(t,[e]),c.snapshot}),id.apply(this,arguments)}function vS(n,e){return sd.apply(this,arguments)}function sd(){return sd=(0,d.Z)(function*(n,e){const t=P(n),r=t.Ea.get(e),i=t.da.get(r.targetId);if(i.length>1)return t.da.set(r.targetId,i.filter(s=>!Ni(s,e))),void t.Ea.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Tr(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),ts(t.remoteStore,r.targetId),Cr(t,r.targetId)}).catch(qt))):(Cr(t,r.targetId),yield Tr(t.localStore,r.targetId,!0))}),sd.apply(this,arguments)}function od(){return od=(0,d.Z)(function*(n,e,t){const r=Pd(n);try{const i=yield function(o,a){const u=P(o),c=X.now(),l=a.reduce((p,v)=>p.add(v.key),L());let h,f;return u.persistence.runTransaction("Locally write mutations","readwrite",p=>{let v=Be(),A=L();return u.Xi.getEntries(p,l).next(w=>{v=w,v.forEach((k,N)=>{N.isValidDocument()||(A=A.add(k))})}).next(()=>u.localDocuments.getOverlayedDocuments(p,v)).next(w=>{h=w;const k=[];for(const N of a){const D=QR(N,h.get(N.key).overlayedDocument);null!=D&&k.push(new wt(N.key,D,xg(D.value.mapValue),ee.exists(!0)))}return u.mutationQueue.addMutationBatch(p,c,k,a)}).next(w=>{f=w;const k=w.applyToLocalDocumentSet(h,A);return u.documentOverlayCache.saveOverlays(p,w.batchId,k)})}).then(()=>({batchId:f.batchId,changes:Zg(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.fa[o.currentUser.toKey()];c||(c=new j(V)),c=c.insert(a,u),o.fa[o.currentUser.toKey()]=c}(r,i.batchId,t),yield Pt(r,i.changes),yield wr(r.remoteStore)}catch(i){const s=Pr(i,"Failed to persist write");t.reject(s)}}),od.apply(this,arguments)}function ky(n,e){return ad.apply(this,arguments)}function ad(){return ad=(0,d.Z)(function*(n,e){const t=P(n);try{const r=yield function qP(n,e){const t=P(n),r=e.snapshotVersion;let i=t.Ji;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.Xi.newChangeBuffer({trackRemovals:!0});i=t.Ji;const a=[];e.targetChanges.forEach((l,h)=>{const f=i.get(h);if(!f)return;a.push(t.kr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.kr.addMatchingKeys(s,l.addedDocuments,h)));let p=f.withSequenceNumber(s.currentSequenceNumber);var A,w,k;null!==e.targetMismatches.get(h)?p=p.withResumeToken(fe.EMPTY_BYTE_STRING,x.min()).withLastLimboFreeSnapshotVersion(x.min()):l.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(l.resumeToken,r)),i=i.insert(h,p),w=p,k=l,(0===(A=f).resumeToken.approximateByteSize()||w.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=3e8||k.addedDocuments.size+k.modifiedDocuments.size+k.removedDocuments.size>0)&&a.push(t.kr.updateTargetData(s,p))});let u=Be(),c=L();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(cy(s,o,e.documentUpdates).next(l=>{u=l.ns,c=l.rs})),!r.isEqual(x.min())){const l=t.kr.getLastRemoteSnapshotVersion(s).next(h=>t.kr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.Ji=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Va.get(s);o&&(C(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.Ia=!0:i.modifiedDocuments.size>0?C(o.Ia):i.removedDocuments.size>0&&(C(o.Ia),o.Ia=!1))}),yield Pt(t,r,e)}catch(r){yield qt(r)}}),ad.apply(this,arguments)}function Dy(n,e,t){const r=P(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.Ea.forEach((s,o)=>{const a=o.view.N_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=P(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(const f of h.listeners)f.N_(a)&&(c=!0)}),c&&ed(u)}(r.eventManager,e),i.length&&r.Ta.r_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function TS(n,e,t){return ud.apply(this,arguments)}function ud(){return ud=(0,d.Z)(function*(n,e,t){const r=P(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Va.get(e),s=i&&i.key;if(s){let o=new j(R.comparator);o=o.insert(s,Q.newNoDocument(s,x.min()));const a=L().add(s),u=new Bi(x.min(),new Map,new j(V),o,a);yield ky(r,u),r.Ra=r.Ra.remove(s),r.Va.delete(e),md(r)}else yield Tr(r.localStore,e,!1).then(()=>Cr(r,e,t)).catch(qt)}),ud.apply(this,arguments)}function AS(n,e){return cd.apply(this,arguments)}function cd(){return cd=(0,d.Z)(function*(n,e){const t=P(n),r=e.batch.batchId;try{const i=yield function BP(n,e){const t=P(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Xi.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){const h=c.batch,f=h.keys();let p=m.resolve();return f.forEach(v=>{p=p.next(()=>l.getEntry(u,v)).next(A=>{const w=c.docVersions.get(v);C(null!==w),A.version.compareTo(w)<0&&(h.applyToRemoteDocument(A,c),A.isValidDocument()&&(A.setReadTime(c.commitVersion),l.addEntry(A)))})}),p.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=L();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);fd(t,r,null),dd(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Pt(t,i)}catch(i){yield qt(i)}}),cd.apply(this,arguments)}function wS(n,e,t){return ld.apply(this,arguments)}function ld(){return ld=(0,d.Z)(function*(n,e,t){const r=P(n);try{const i=yield function(o,a){const u=P(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(C(null!==h),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);fd(r,e,t),dd(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Pt(r,i)}catch(i){yield qt(i)}}),ld.apply(this,arguments)}function hd(){return hd=(0,d.Z)(function*(n,e){const t=P(n);en(t.remoteStore)||E("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(o){const a=P(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(-1===r)return void e.resolve();const i=t.ga.get(r)||[];i.push(e),t.ga.set(r,i)}catch(r){const i=Pr(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),hd.apply(this,arguments)}function dd(n,e){(n.ga.get(e)||[]).forEach(t=>{t.resolve()}),n.ga.delete(e)}function fd(n,e,t){const r=P(n);let i=r.fa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.fa[r.currentUser.toKey()]=i}}function Cr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.da.get(e))n.Ea.delete(r),t&&n.Ta.Sa(r,t);n.da.delete(e),n.isPrimaryClient&&n.ma.Ar(e).forEach(r=>{n.ma.containsKey(r)||Ny(n,r)})}function Ny(n,e){n.Aa.delete(e.path.canonicalString());const t=n.Ra.get(e);null!==t&&(ts(n.remoteStore,t),n.Ra=n.Ra.remove(e),n.Va.delete(t),md(n))}function pd(n,e,t){for(const r of t)r instanceof by?(n.ma.addReference(r.key,e),PS(n,r)):r instanceof Cy?(E("SyncEngine","Document no longer in limbo: "+r.key),n.ma.removeReference(r.key,e),n.ma.containsKey(r.key)||Ny(n,r.key)):b()}function PS(n,e){const t=e.key,r=t.path.canonicalString();n.Ra.get(t)||n.Aa.has(r)||(E("SyncEngine","New document in limbo: "+t),n.Aa.add(r),md(n))}function md(n){for(;n.Aa.size>0&&n.Ra.size<n.maxConcurrentLimboResolutions;){const e=n.Aa.values().next().value;n.Aa.delete(e);const t=new R(B.fromString(e)),r=n.pa.next();n.Va.set(r,new _S(t)),n.Ra=n.Ra.insert(t,r),Ko(n.remoteStore,new Rt(Ve(dr(t.path)),r,"TargetPurposeLimboResolution",Ke.ae))}}function Pt(n,e,t){return gd.apply(this,arguments)}function gd(){return gd=(0,d.Z)(function*(n,e,t){const r=P(n),i=[],s=[],o=[];var a;r.Ea.isEmpty()||(r.Ea.forEach((a,u)=>{o.push(r.wa(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);const l=vh.qi(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.Ta.r_(i),yield(a=(0,d.Z)(function*(c,l){const h=P(c);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>m.forEach(l,p=>m.forEach(p.Li,v=>h.persistence.referenceDelegate.addReference(f,p.targetId,v)).next(()=>m.forEach(p.ki,v=>h.persistence.referenceDelegate.removeReference(f,p.targetId,v)))))}catch(f){if(!Gt(f))throw f;E("LocalStore","Failed to update sequence numbers: "+f)}for(const f of l){const p=f.targetId;if(!f.fromCache){const v=h.Ji.get(p),w=v.withLastLimboFreeSnapshotVersion(v.snapshotVersion);h.Ji=h.Ji.insert(p,w)}}}),function u(c,l){return a.apply(this,arguments)})(r.localStore,s))}),gd.apply(this,arguments)}function SS(n,e){return _d.apply(this,arguments)}function _d(){return _d=(0,d.Z)(function*(n,e){const t=P(n);if(!t.currentUser.isEqual(e)){E("SyncEngine","User change. New user:",e.toKey());const r=yield ay(t.localStore,e);t.currentUser=e,(s=t).ga.forEach(a=>{a.forEach(u=>{u.reject(new I(y.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.ga.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Pt(t,r.ts)}var s}),_d.apply(this,arguments)}function bS(n,e){const t=P(n),r=t.Va.get(e);if(r&&r.Ia)return L().add(r.key);{let i=L();const s=t.da.get(e);if(!s)return i;for(const o of s){const a=t.Ea.get(o);i=i.unionWith(a.view.ia)}return i}}function CS(n,e){return yd.apply(this,arguments)}function yd(){return yd=(0,d.Z)(function*(n,e){const t=P(n),r=yield Bo(t.localStore,e.query,!0),i=e.view.ha(r);return t.isPrimaryClient&&pd(t,e.targetId,i.ca),i}),yd.apply(this,arguments)}function xS(n,e){return Id.apply(this,arguments)}function Id(){return Id=(0,d.Z)(function*(n,e){const t=P(n);return hy(t.localStore,e).then(r=>Pt(t,r))}),Id.apply(this,arguments)}function kS(n,e,t,r){return vd.apply(this,arguments)}function vd(){return vd=(0,d.Z)(function*(n,e,t,r){const i=P(n),s=yield function(a,u){const c=P(a),l=P(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.Dn(h,u).next(f=>f?c.localDocuments.getDocuments(h,f):m.resolve(null)))}(i.localStore,e);var u;null!==s?("pending"===t?yield wr(i.remoteStore):"acknowledged"===t||"rejected"===t?(fd(i,e,r||null),dd(i,e),u=e,P(P(i.localStore).mutationQueue).Cn(u)):b(),yield Pt(i,s)):E("SyncEngine","Cannot apply mutation batch with id: "+e)}),vd.apply(this,arguments)}function Ed(){return Ed=(0,d.Z)(function*(n,e){const t=P(n);if(Rd(t),Pd(t),!0===e&&!0!==t.ya){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Vy(t,r.toArray());t.ya=!0,yield jh(t.remoteStore,!0);for(const s of i)Ko(t.remoteStore,s)}else if(!1===e&&!1!==t.ya){const r=[];let i=Promise.resolve();t.da.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Cr(t,o),Tr(t.localStore,o,!0))),ts(t.remoteStore,o)}),yield i,yield Vy(t,r),function(o){const a=P(o);a.Va.forEach((u,c)=>{ts(a.remoteStore,c)}),a.ma.Rr(),a.Va=new Map,a.Ra=new j(R.comparator)}(t),t.ya=!1,yield jh(t.remoteStore,!1)}}),Ed.apply(this,arguments)}function Vy(n,e,t){return Td.apply(this,arguments)}function Td(){return Td=(0,d.Z)(function*(n,e,t){const r=P(n),i=[],s=[];for(const o of e){let a;const u=r.da.get(o);if(u&&0!==u.length){a=yield Er(r.localStore,Ve(u[0]));for(const c of u){const l=r.Ea.get(c),h=yield CS(r,l);h.snapshot&&s.push(h.snapshot)}}else{const c=yield ly(r.localStore,o);a=yield Er(r.localStore,c),yield rd(r,Oy(c),o,!1,a.resumeToken)}i.push(a)}return r.Ta.r_(s),i}),Td.apply(this,arguments)}function Oy(n){return Gg(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function NS(n){return t=P(n).localStore,P(P(t).persistence).Ni();var t}function VS(n,e,t,r){return Ad.apply(this,arguments)}function Ad(){return Ad=(0,d.Z)(function*(n,e,t,r){const i=P(n);if(i.ya)return void E("SyncEngine","Ignoring unexpected query state notification.");const s=i.da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=yield hy(i.localStore,Kg(s[0])),a=Bi.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,fe.EMPTY_BYTE_STRING);yield Pt(i,o,a);break}case"rejected":yield Tr(i.localStore,e,!0),Cr(i,e,r);break;default:b()}}),Ad.apply(this,arguments)}function OS(n,e,t){return wd.apply(this,arguments)}function wd(){return wd=(0,d.Z)(function*(n,e,t){const r=Rd(n);if(r.ya){for(const i of e){if(r.da.has(i)){E("SyncEngine","Adding an already active target "+i);continue}const s=yield ly(r.localStore,i),o=yield Er(r.localStore,s);yield rd(r,Oy(s),o.targetId,!1,o.resumeToken),Ko(r.remoteStore,o)}for(const i of t)r.da.has(i)&&(yield Tr(r.localStore,i,!1).then(()=>{ts(r.remoteStore,i),Cr(r,i)}).catch(qt))}}),wd.apply(this,arguments)}function Rd(n){const e=P(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=ky.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=bS.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=TS.bind(null,e),e.Ta.r_=dS.bind(null,e.eventManager),e.Ta.Sa=fS.bind(null,e.eventManager),e}function Pd(n){const e=P(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=AS.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=wS.bind(null,e),e}class ns{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,d.Z)(function*(){t.serializer=Xi(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return oy(this.persistence,new sy,e.initialUser,this.serializer)}createPersistence(e){return new gh(Mo.zr,this.serializer)}createSharedClientState(e){return new my}terminate(){var e=this;return(0,d.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Sd extends ns{constructor(e,t,r){super(),this.Da=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,d.Z)(function*(){yield t().call(r,e),yield r.Da.initialize(r,e),yield Pd(r.Da.syncEngine),yield wr(r.Da.remoteStore),yield r.persistence.Vi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return oy(this.persistence,new sy,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new Q_(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new uR(t,this.persistence);return new aR(e.asyncQueue,r)}createPersistence(e){const t=Ih(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?ke.withCacheSize(this.cacheSizeBytes):ke.DEFAULT;return new yh(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,_y(),Wo(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new my}}class Ly extends Sd{constructor(e,t){super(e,t,!1),this.Da=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,d.Z)(function*(){yield t().call(r,e);const i=r.Da.syncEngine;r.sharedClientState instanceof bh&&(r.sharedClientState.syncEngine={Gs:kS.bind(null,i),zs:VS.bind(null,i),js:OS.bind(null,i),Ni:NS.bind(null,i),Ws:xS.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.Vi(function(){var s=(0,d.Z)(function*(o){yield function DS(n,e){return Ed.apply(this,arguments)}(r.Da.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=_y();if(!bh.v(t))throw new I(y.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Ih(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new bh(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class xr{initialize(e,t){var r=this;return(0,d.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Dy(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=SS.bind(null,r.syncEngine),yield jh(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new hS}createDatastore(e){const t=Xi(e.databaseInfo.databaseId),r=new ZP(e.databaseInfo);return new YP(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>Dy(this.syncEngine,t,0),a=gy.v()?new gy:new KP,new eS(r,i,s,o,a);var r,i,s,o,a}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){const h=new yS(i,s,o,a,u,c);return l&&(h.ya=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,d.Z)(function*(r){const i=P(r);E("RemoteStore","RemoteStore shutting down."),i.y_.add(5),yield Ar(i),i.S_.shutdown(),i.b_.set("Unknown")}),function t(r){return e.apply(this,arguments)})(this.remoteStore);var e}}function My(n,e=10240){let t=0;return{read:()=>(0,d.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,d.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class jo{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.va(this.observer.next,e)}error(e){this.observer.error?this.va(this.observer.error,e):ae("Uncaught Error in snapshot listener:",e.toString())}Ca(){this.muted=!0}va(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class FS{constructor(e,t){this.Fa=e,this.serializer=t,this.metadata=new de,this.buffer=new Uint8Array,this.Ma=new TextDecoder("utf-8"),this.xa().then(r=>{r&&r.z_()?this.metadata.resolve(r.G_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.G_)}`))},r=>this.metadata.reject(r))}close(){return this.Fa.cancel()}getMetadata(){var e=this;return(0,d.Z)(function*(){return e.metadata.promise})()}ba(){var e=this;return(0,d.Z)(function*(){return yield e.getMetadata(),e.xa()})()}xa(){var e=this;return(0,d.Z)(function*(){const t=yield e.Oa();if(null===t)return null;const r=e.Ma.decode(t),i=Number(r);isNaN(i)&&e.Na(`length string (${r}) is not valid number`);const s=yield e.Ba(i);return new pS(JSON.parse(s),t.length+i)})()}La(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Oa(){var e=this;return(0,d.Z)(function*(){for(;e.La()<0&&!(yield e.ka()););if(0===e.buffer.length)return null;const t=e.La();t<0&&e.Na("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Ba(e){var t=this;return(0,d.Z)(function*(){for(;t.buffer.length<e;)(yield t.ka())&&t.Na("Reached the end of bundle when more is expected.");const r=t.Ma.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Na(e){throw this.Fa.cancel(),new Error(`Invalid bundle format: ${e}`)}ka(){var e=this;return(0,d.Z)(function*(){const t=yield e.Fa.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class US{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,d.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new I(y.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,d.Z)(function*(o,a){const u=P(o),c=zi(u.serializer)+"/documents",l={documents:a.map(v=>Gi(u.serializer,v))},h=yield u.yo("BatchGetDocuments",c,l,a.length),f=new Map;h.forEach(v=>{const A=function oP(n,e){return"found"in e?function(r,i){C(!!i.found);const s=lt(r,i.found.name),o=ue(i.found.updateTime),a=i.found.createTime?ue(i.found.createTime):x.min(),u=new Re({mapValue:{fields:i.found.fields}});return Q.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){C(!!i.missing),C(!!i.readTime);const s=lt(r,i.missing),o=ue(i.readTime);return Q.newNoDocument(s,o)}(n,e):b()}(u.serializer,v);f.set(A.key.toString(),A)});const p=[];return a.forEach(v=>{const A=f.get(v.toString());C(!!A),p.push(A)}),p}),function s(o,a){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new gr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,d.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=R.fromPath(i);e.mutations.push(new Yl(s,e.precondition(s)))}),yield(r=(0,d.Z)(function*(s,o){const a=P(s),u=zi(a.serializer)+"/documents",c={writes:o.map(l=>Wi(a.serializer,l))};yield a.Vo("Commit",u,c)}),function i(s,o){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw b();t=x.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new I(y.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(x.min())?ee.exists(!1):ee.updateTime(t):ee.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(x.min()))throw new I(y.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ee.updateTime(t)}return ee.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class BS{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.qa=r.maxAttempts,this.Ko=new xh(this.asyncQueue,"transaction_retry")}run(){this.qa-=1,this.Qa()}Qa(){var e=this;this.Ko.xo((0,d.Z)(function*(){const t=new US(e.datastore),r=e.Ka(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.$a(s)}))}).catch(i=>{e.$a(i)})}))}Ka(e){try{const t=this.updateFunction(e);return!Pi(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}$a(e){this.qa>0&&this.Ua(e)?(this.qa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Qa(),Promise.resolve()))):this.deferred.reject(e)}Ua(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!c_(t)}return!1}}class qS{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ye.UNAUTHENTICATED,this.clientId=og.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,d.Z)(function*(a){E("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(E("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,d.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new I(y.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new de;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,d.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Pr(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Zo(n,e){return bd.apply(this,arguments)}function bd(){return bd=(0,d.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),E("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,d.Z)(function*(s){r.isEqual(s)||(yield ay(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),bd.apply(this,arguments)}function Cd(n,e){return xd.apply(this,arguments)}function xd(){return xd=(0,d.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield kd(n);E("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>wy(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>wy(e.remoteStore,s)),n._onlineComponents=e}),xd.apply(this,arguments)}function Fy(n){return"FirebaseError"===n.name?n.code===y.FAILED_PRECONDITION||n.code===y.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function kd(n){return Dd.apply(this,arguments)}function Dd(){return Dd=(0,d.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){E("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Zo(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Fy(t))throw t;Ze("Error using user provided cache. Falling back to memory cache: "+t),yield Zo(n,new ns)}}else E("FirestoreClient","Using default OfflineComponentProvider"),yield Zo(n,new ns);return n._offlineComponents}),Dd.apply(this,arguments)}function Ho(n){return Nd.apply(this,arguments)}function Nd(){return Nd=(0,d.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(E("FirestoreClient","Using user provided OnlineComponentProvider"),yield Cd(n,n._uninitializedComponentsProvider._online)):(E("FirestoreClient","Using default OnlineComponentProvider"),yield Cd(n,new xr))),n._onlineComponents}),Nd.apply(this,arguments)}function Uy(n){return kd(n).then(e=>e.persistence)}function Qo(n){return kd(n).then(e=>e.localStore)}function By(n){return Ho(n).then(e=>e.remoteStore)}function Vd(n){return Ho(n).then(e=>e.syncEngine)}function kr(n){return Od.apply(this,arguments)}function Od(){return Od=(0,d.Z)(function*(n){const e=yield Ho(n),t=e.eventManager;return t.onListen=IS.bind(null,e.syncEngine),t.onUnlisten=vS.bind(null,e.syncEngine),t}),Od.apply(this,arguments)}function Gy(n,e,t={}){const r=new de;return n.asyncQueue.enqueueAndForget((0,d.Z)(function*(){return function(s,o,a,u,c){const l=new jo({next:f=>{o.enqueueAndForget(()=>Jh(s,h));const p=f.docs.has(a);!p&&f.fromCache?c.reject(new I(y.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&f.fromCache&&u&&"server"===u.source?c.reject(new I(y.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new td(dr(a.path),l,{includeMetadataChanges:!0,W_:!0});return Qh(s,h)}(yield kr(n),n.asyncQueue,e,t,r)})),r.promise}function zy(n,e,t={}){const r=new de;return n.asyncQueue.enqueueAndForget((0,d.Z)(function*(){return function(s,o,a,u,c){const l=new jo({next:f=>{o.enqueueAndForget(()=>Jh(s,h)),f.fromCache&&"server"===u.source?c.reject(new I(y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new td(a,l,{includeMetadataChanges:!0,W_:!0});return Qh(s,h)}(yield kr(n),n.asyncQueue,e,t,r)})),r.promise}function Wy(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const Ky=new Map;function Ld(n,e,t){if(!t)throw new I(y.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function $y(n,e,t,r){if(!0===e&&!0===r)throw new I(y.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function jy(n){if(!R.isDocumentKey(n))throw new I(y.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Zy(n){if(R.isDocumentKey(n))throw new I(y.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Yo(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":b()}function U(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new I(y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Yo(n);throw new I(y.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Hy(n,e){if(e<=0)throw new I(y.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class Qy{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new I(y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new I(y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}$y("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Wy(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new I(y.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new I(y.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new I(y.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class rs{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Qy({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new I(y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new I(y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qy(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new H0;switch(r.type){case"firstParty":return new X0(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new I(y.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Ky.get(t);r&&(E("ComponentProvider","Removing Datastore"),Ky.delete(t),r.terminate())}(this),Promise.resolve()}}class Pe{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Pe(this.firestore,e,this._query)}}class Y{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ht(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Y(this.firestore,e,this._key)}}class ht extends Pe{constructor(e,t,r){super(e,t,dr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Y(this.firestore,null,new R(e))}withConverter(e){return new ht(this.firestore,e,this._path)}}function Jy(n,e,...t){if(n=(0,_.m9)(n),Ld("collection","path",e),n instanceof rs){const r=B.fromString(e,...t);return Zy(r),new ht(n,null,r)}{if(!(n instanceof Y||n instanceof ht))throw new I(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(B.fromString(e,...t));return Zy(r),new ht(n.firestore,null,r)}}function Jo(n,e,...t){if(n=(0,_.m9)(n),1===arguments.length&&(e=og.V()),Ld("doc","path",e),n instanceof rs){const r=B.fromString(e,...t);return jy(r),new Y(n,null,new R(r))}{if(!(n instanceof Y||n instanceof ht))throw new I(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(B.fromString(e,...t));return jy(r),new Y(n.firestore,n instanceof ht?n.converter:null,new R(r))}}function Xy(n,e){return n=(0,_.m9)(n),e=(0,_.m9)(e),(n instanceof Y||n instanceof ht)&&(e instanceof Y||e instanceof ht)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Md(n,e){return n=(0,_.m9)(n),e=(0,_.m9)(e),n instanceof Pe&&e instanceof Pe&&n.firestore===e.firestore&&Ni(n._query,e._query)&&n.converter===e.converter}class YS{constructor(){this.Wa=Promise.resolve(),this.Ga=[],this.za=!1,this.ja=[],this.Ha=null,this.Ja=!1,this.Ya=!1,this.Za=[],this.Ko=new xh(this,"async_queue_retry"),this.Xa=()=>{const t=Wo();t&&E("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Ko.No()};const e=Wo();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xa)}get isShuttingDown(){return this.za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.eu(),this.tu(e)}enterRestrictedMode(e){if(!this.za){this.za=!0,this.Ya=e||!1;const t=Wo();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xa)}}enqueue(e){if(this.eu(),this.za)return new Promise(()=>{});const t=new de;return this.tu(()=>this.za&&this.Ya?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ga.push(e),this.nu()))}nu(){var e=this;return(0,d.Z)(function*(){if(0!==e.Ga.length){try{yield e.Ga[0](),e.Ga.shift(),e.Ko.reset()}catch(t){if(!Gt(t))throw t;E("AsyncQueue","Operation failed with retryable error: "+t)}e.Ga.length>0&&e.Ko.xo(()=>e.nu())}})()}tu(e){const t=this.Wa.then(()=>(this.Ja=!0,e().catch(r=>{throw this.Ha=r,this.Ja=!1,ae("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(r)),r}).then(r=>(this.Ja=!1,r))));return this.Wa=t,t}enqueueAfterDelay(e,t,r){this.eu(),this.Za.indexOf(e)>-1&&(t=0);const i=Hh.createAndSchedule(this,e,t,r,s=>this.ru(s));return this.ja.push(i),i}eu(){this.Ha&&b()}verifyOperationInProgress(){}iu(){var e=this;return(0,d.Z)(function*(){let t;do{t=e.Wa,yield t}while(t!==e.Wa)})()}su(e){for(const t of this.ja)if(t.timerId===e)return!0;return!1}ou(e){return this.iu().then(()=>{this.ja.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.ja)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.iu()})}_u(e){this.Za.push(e)}ru(e){const t=this.ja.indexOf(e);this.ja.splice(t,1)}}function Fd(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class JS{constructor(){this._progressObserver={},this._taskCompletionResolver=new de,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class J extends rs{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new YS,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||eI(this),this._firestoreClient.terminate()}}function ce(n){return n._firestoreClient||eI(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function eI(n){var e,t,r;const i=n._freezeSettings(),s=(u=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new CR(n._databaseId,u,n._persistenceKey,(l=i).host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Wy(l.experimentalLongPollingOptions),l.useFetchStreams));var u,l;n._firestoreClient=new qS(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function tI(n,e,t){const r=new de;return n.asyncQueue.enqueue((0,d.Z)(function*(){try{yield Zo(n,t),yield Cd(n,e),r.resolve()}catch(i){const s=i;if(!Fy(s))throw s;Ze("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function nI(n){if(n._initialized||n._terminated)throw new I(y.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class dt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new dt(fe.fromBase64String(e))}catch(t){throw new I(y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new dt(fe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class St{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new I(y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new se(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Vn{constructor(e){this._methodName=e}}class Xo{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new I(y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new I(y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return V(this._lat,e._lat)||V(this._long,e._long)}}const cb=/^__.*__$/;class lb{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new wt(e,this.data,this.fieldMask,t,this.fieldTransforms):new mr(e,this.data,t,this.fieldTransforms)}}class rI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new wt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function iI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw b()}}class ea{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.au(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get uu(){return this.settings.uu}cu(e){return new ea(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}lu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.cu({path:r,hu:!1});return i.Pu(e),i}Iu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.cu({path:r,hu:!1});return i.au(),i}Tu(e){return this.cu({path:void 0,hu:!0})}Eu(e){return ra(e,this.settings.methodName,this.settings.du||!1,this.path,this.settings.Au)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}au(){if(this.path)for(let e=0;e<this.path.length;e++)this.Pu(this.path.get(e))}Pu(e){if(0===e.length)throw this.Eu("Document fields must not be empty");if(iI(this.uu)&&cb.test(e))throw this.Eu('Document fields cannot begin and end with "__"')}}class hb{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Xi(e)}Ru(e,t,r,i=!1){return new ea({uu:e,methodName:t,Au:r,path:se.emptyPath(),hu:!1,du:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function On(n){const e=n._freezeSettings(),t=Xi(n._databaseId);return new hb(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ta(n,e,t,r,i,s={}){const o=n.Ru(s.merge||s.mergeFields?2:0,e,t,i);Gd("Data must be an object, but it was:",o,r);const a=aI(r,o);let u,c;if(s.merge)u=new Ue(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const l=[];for(const h of s.mergeFields){const f=os(e,h,t);if(!o.contains(f))throw new I(y.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);cI(l,f)||l.push(f)}u=new Ue(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new lb(new Re(a),u,c)}class ss extends Vn{_toFieldTransform(e){if(2!==e.uu)throw e.Eu(1===e.uu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ss}}function sI(n,e,t){return new ea({uu:3,Au:e.settings.Au,methodName:n._methodName,hu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Ud extends Vn{_toFieldTransform(e){return new Mi(e.path,new fr)}isEqual(e){return e instanceof Ud}}class db extends Vn{constructor(e,t){super(e),this.Vu=t}_toFieldTransform(e){const t=sI(this,e,!0),r=this.Vu.map(s=>Ln(s,t)),i=new Rn(r);return new Mi(e.path,i)}isEqual(e){return this===e}}class fb extends Vn{constructor(e,t){super(e),this.Vu=t}_toFieldTransform(e){const t=sI(this,e,!0),r=this.Vu.map(s=>Ln(s,t)),i=new Pn(r);return new Mi(e.path,i)}isEqual(e){return this===e}}class pb extends Vn{constructor(e,t){super(e),this.mu=t}_toFieldTransform(e){const t=new pr(e.serializer,Jg(e.serializer,this.mu));return new Mi(e.path,t)}isEqual(e){return this===e}}function Bd(n,e,t,r){const i=n.Ru(1,e,t);Gd("Data must be an object, but it was:",i,r);const s=[],o=Re.empty();zt(r,(u,c)=>{const l=na(e,u,t);c=(0,_.m9)(c);const h=i.Iu(l);if(c instanceof ss)s.push(l);else{const f=Ln(c,h);null!=f&&(s.push(l),o.set(l,f))}});const a=new Ue(s);return new rI(o,a,i.fieldTransforms)}function qd(n,e,t,r,i,s){const o=n.Ru(1,e,t),a=[os(e,r,t)],u=[i];if(s.length%2!=0)throw new I(y.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(os(e,s[f])),u.push(s[f+1]);const c=[],l=Re.empty();for(let f=a.length-1;f>=0;--f)if(!cI(c,a[f])){const p=a[f];let v=u[f];v=(0,_.m9)(v);const A=o.Iu(p);if(v instanceof ss)c.push(p);else{const w=Ln(v,A);null!=w&&(c.push(p),l.set(p,w))}}const h=new Ue(c);return new rI(l,h,o.fieldTransforms)}function oI(n,e,t,r=!1){return Ln(t,n.Ru(r?4:3,e))}function Ln(n,e){if(uI(n=(0,_.m9)(n)))return Gd("Unsupported field value:",e,n),aI(n,e);if(n instanceof Vn)return function(r,i){if(!iI(i.uu))throw i.Eu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Eu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.hu&&4!==e.uu)throw e.Eu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let u=Ln(a,i.Tu(o));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,_.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return Jg(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=X.fromDate(r);return{timestampValue:_r(i.serializer,s)}}if(r instanceof X){const s=new X(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:_r(i.serializer,s)}}if(r instanceof Xo)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof dt)return{bytesValue:I_(i.serializer,r._byteString)};if(r instanceof Y){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Eu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ih(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Eu(`Unsupported field value: ${Yo(r)}`)}(n,e)}function aI(n,e){const t={};return Eg(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):zt(n,(r,i)=>{const s=Ln(i,e.lu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function uI(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof X||n instanceof Xo||n instanceof dt||n instanceof Y||n instanceof Vn)}function Gd(n,e,t){if(!uI(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=Yo(t);throw e.Eu("an object"===r?n+" a custom object":n+" "+r)}var i}function os(n,e,t){if((e=(0,_.m9)(e))instanceof St)return e._internalPath;if("string"==typeof e)return na(n,e);throw ra("Field path arguments must be of type string or ",n,!1,void 0,t)}const mb=new RegExp("[~\\*/\\[\\]]");function na(n,e,t){if(e.search(mb)>=0)throw ra(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new St(...e.split("."))._internalPath}catch{throw ra(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ra(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new I(y.INVALID_ARGUMENT,a+n+u)}function cI(n,e){return n.some(t=>t.isEqual(e))}class as{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Y(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new gb(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ia("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class gb extends as{data(){return super.data()}}function ia(n,e){return"string"==typeof e?na(n,e):e instanceof St?e._internalPath:e._delegate._internalPath}function lI(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new I(y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class zd{}class us extends zd{}function nn(n,e,...t){let r=[];e instanceof zd&&r.push(e),r=r.concat(t),function(s){const o=s.filter(u=>u instanceof Dr).length,a=s.filter(u=>u instanceof cs).length;if(o>1||o>0&&a>0)throw new I(y.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class cs extends us{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new cs(e,t,r)}_apply(e){const t=this._parse(e);return pI(e._query,t),new Pe(e.firestore,e.converter,Zl(e._query,t))}_parse(e){const t=On(e.firestore);return function(s,o,a,u,c,l,h){let f;if(c.isKeyField()){if("array-contains"===l||"array-contains-any"===l)throw new I(y.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if("in"===l||"not-in"===l){fI(h,l);const p=[];for(const v of h)p.push(dI(u,s,v));f={arrayValue:{values:p}}}else f=dI(u,s,h)}else"in"!==l&&"not-in"!==l&&"array-contains-any"!==l||fI(h,l),f=oI(a,"where",h,"in"===l||"not-in"===l);return F.create(c,l,f)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Dr extends zd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Dr(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:$.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const u of a)pI(o,u),o=Zl(o,u)}(e._query,t),new Pe(e.firestore,e.converter,Zl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Wd extends us{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Wd(e,t)}_apply(e){const t=function(i,s,o){if(null!==i.startAt)throw new I(y.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new I(y.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const a=new lr(s,o);return function(c,l){if(null===$l(c)){const h=To(c);null!==h&&mI(0,h,l.field)}}(i,a),a}(e._query,this._field,this._direction);return new Pe(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new Tt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class sa extends us{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new sa(e,t,r)}_apply(e){return new Pe(e.firestore,e.converter,Ao(e._query,this._limit,this._limitType))}}class oa extends us{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new oa(e,t,r)}_apply(e){const t=hI(e,this.type,this._docOrFields,this._inclusive);return new Pe(e.firestore,e.converter,(s=t,new Tt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class aa extends us{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new aa(e,t,r)}_apply(e){const t=hI(e,this.type,this._docOrFields,this._inclusive);return new Pe(e.firestore,e.converter,(s=t,new Tt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function hI(n,e,t,r){if(t[0]=(0,_.m9)(t[0]),t[0]instanceof as)return function(s,o,a,u,c){if(!u)throw new I(y.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const l=[];for(const h of wn(s))if(h.field.isKeyField())l.push(Tn(o,u.key));else{const f=u.data.field(h.field);if(mo(f))throw new I(y.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===f){const p=h.field.canonicalString();throw new I(y.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${p}' (used as the orderBy) does not exist.`)}l.push(f)}return new Ht(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=On(n.firestore);return function(o,a,u,c,l,h){const f=o.explicitOrderBy;if(l.length>f.length)throw new I(y.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const p=[];for(let v=0;v<l.length;v++){const A=l[v];if(f[v].field.isKeyField()){if("string"!=typeof A)throw new I(y.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof A}`);if(!jl(o)&&-1!==A.indexOf("/"))throw new I(y.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${A}' contains a slash.`);const w=o.path.child(B.fromString(A));if(!R.isDocumentKey(w))throw new I(y.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${w}' is not because it contains an odd number of segments.`);const k=new R(w);p.push(Tn(a,k))}else{const w=oI(u,c,A);p.push(w)}}return new Ht(p,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function dI(n,e,t){if("string"==typeof(t=(0,_.m9)(t))){if(""===t)throw new I(y.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!jl(e)&&-1!==t.indexOf("/"))throw new I(y.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(B.fromString(t));if(!R.isDocumentKey(r))throw new I(y.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Tn(n,new R(r))}if(t instanceof Y)return Tn(n,t._key);throw new I(y.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yo(t)}.`)}function fI(n,e){if(!Array.isArray(n)||0===n.length)throw new I(y.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function pI(n,e){if(e.isInequality()){const r=To(n),i=e.field;if(null!==r&&!r.isEqual(i))throw new I(y.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);const s=$l(n);null!==s&&mI(0,i,s)}const t=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new I(y.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function mI(n,e,t){if(!t.isEqual(e))throw new I(y.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Kd{convertValue(e,t="none"){switch(jt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return oe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Et(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw b()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return zt(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Xo(oe(e.latitude),oe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=go(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(bi(e));default:return null}}convertTimestamp(e){const t=Wt(e);return new X(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=B.fromString(e);C(C_(r));const i=new Kt(r.get(1),r.get(3)),s=new R(r.popFirst(5));return i.isEqual(t)||ae(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function ua(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Rb extends Kd{constructor(e){super(),this.firestore=e}convertBytes(e){return new dt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Y(this.firestore,null,t)}}class Mn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class bt extends as{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ls(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(ia("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class ls extends bt{data(e={}){return super.data(e)}}class rn{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Mn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ls(this._firestore,this._userDataWriter,r.key,r,new Mn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new I(y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new ls(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Mn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const u=new ls(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Mn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return 0!==a.type&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:Sb(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Sb(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return b()}}function _I(n,e){return n instanceof bt&&e instanceof bt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof rn&&e instanceof rn&&n._firestore===e._firestore&&Md(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class sn extends Kd{constructor(e){super(),this.firestore=e}convertBytes(e){return new dt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Y(this.firestore,null,t)}}function yI(n,e,t){n=U(n,Y);const r=U(n.firestore,J),i=ua(n.converter,e,t);return Nr(r,[ta(On(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,ee.none())])}function II(n,e,t,...r){n=U(n,Y);const i=U(n.firestore,J),s=On(i);let o;return o="string"==typeof(e=(0,_.m9)(e))||e instanceof St?qd(s,"updateDoc",n._key,e,t,r):Bd(s,"updateDoc",n._key,e),Nr(i,[o.toMutation(n._key,ee.exists(!0))])}function vI(n,...e){var t,r,i;n=(0,_.m9)(n);let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Fd(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(Fd(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),e[o+2]=null===(i=h.complete)||void 0===i?void 0:i.bind(h)}let u,c,l;if(n instanceof Y)c=U(n.firestore,J),l=dr(n._key.path),u={next:h=>{e[o]&&e[o]($d(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=U(n,Pe);c=U(h.firestore,J),l=h._query;const f=new sn(c);u={next:p=>{e[o]&&e[o](new rn(c,f,h,p))},error:e[o+1],complete:e[o+2]},lI(n._query)}return function(f,p,v,A){const w=new jo(A),k=new td(p,w,v);return f.asyncQueue.enqueueAndForget((0,d.Z)(function*(){return Qh(yield kr(f),k)})),()=>{w.Ca(),f.asyncQueue.enqueueAndForget((0,d.Z)(function*(){return Jh(yield kr(f),k)}))}}(ce(c),l,a,u)}function Nr(n,e){return function(r,i){const s=new de;return r.asyncQueue.enqueueAndForget((0,d.Z)(function*(){return function ES(n,e,t){return od.apply(this,arguments)}(yield Vd(r),i,s)})),s.promise}(ce(n),e)}function $d(n,e,t){const r=t.docs.get(e._key),i=new sn(n);return new bt(n,i,e._key,r,new Mn(t.hasPendingWrites,t.fromCache),e.converter)}const Kb={maxAttempts:5};class EI{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=On(e)}set(e,t,r){this._verifyNotCommitted();const i=on(e,this._firestore),s=ua(i.converter,t,r),o=ta(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(o.toMutation(i._key,ee.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=on(e,this._firestore);let o;return o="string"==typeof(t=(0,_.m9)(t))||t instanceof St?qd(this._dataReader,"WriteBatch.update",s._key,t,r,i):Bd(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,ee.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=on(e,this._firestore);return this._mutations=this._mutations.concat(new gr(t._key,ee.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new I(y.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function on(n,e){if((n=(0,_.m9)(n)).firestore!==e)throw new I(y.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class $b extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=On(t)}get(t){const r=on(t,this._firestore),i=new Rb(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return b();const o=s[0];if(o.isFoundDocument())return new as(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new as(this._firestore,i,r._key,null,r.converter);throw b()})}set(t,r,i){const s=on(t,this._firestore),o=ua(s.converter,r,i),a=ta(this._dataReader,"Transaction.set",s._key,o,null!==s.converter,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){const o=on(t,this._firestore);let a;return a="string"==typeof(r=(0,_.m9)(r))||r instanceof St?qd(this._dataReader,"Transaction.update",o._key,r,i,s):Bd(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=on(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=on(e,this._firestore),r=new sn(this._firestore);return super.get(e).then(i=>new bt(this._firestore,r,t._key,i._document,new Mn(!1,!1),t.converter))}}function jd(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new I("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function AI(){if(typeof Uint8Array>"u")throw new I("unimplemented","Uint8Arrays are not available in this environment.")}function wI(){if(!function SR(){return typeof atob<"u"}())throw new I("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){or=Nt,Dt(new Qe.wA("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new J(new Y0(r.getProvider("auth-internal")),new eR(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new I(y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Kt(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),tt(rg,"4.1.0",e),tt(rg,"4.1.0","esm2017")}();class hs{constructor(e){this._delegate=e}static fromBase64String(e){return wI(),new hs(dt.fromBase64String(e))}static fromUint8Array(e){return AI(),new hs(dt.fromUint8Array(e))}toBase64(){return wI(),this._delegate.toBase64()}toUint8Array(){return AI(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Zd(n){return function tC(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class nC{enableIndexedDbPersistence(e,t){return function eb(n,e){nI(n=U(n,J));const t=ce(n);if(t._uninitializedComponentsProvider)throw new I(y.FAILED_PRECONDITION,"SDK cache is already specified.");Ze("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new xr;return tI(t,i,new Sd(i,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function tb(n){nI(n=U(n,J));const e=ce(n);if(e._uninitializedComponentsProvider)throw new I(y.FAILED_PRECONDITION,"SDK cache is already specified.");Ze("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new xr;return tI(e,r,new Ly(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function nb(n){if(n._initialized&&!n._terminated)throw new I(y.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new de;return n._queue.enqueueAndForgetEvenWhileRestricted((0,d.Z)(function*(){try{yield(t=(0,d.Z)(function*(i){if(!et.v())return Promise.resolve();const s=i+"main";yield et.delete(s)}),function r(i){return t.apply(this,arguments)})(Ih(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class RI{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Kt||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ze("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function Yy(n,e,t,r={}){var i;const s=(n=U(n,rs))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Ze("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if("string"==typeof r.mockUserToken)a=r.mockUserToken,u=ye.MOCK_USER;else{a=(0,_.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new I(y.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new ye(c)}n._authCredentials=new Q0(new ig(a,u))}}(this._delegate,e,t,r)}enableNetwork(){return function ib(n){return function GS(n){return n.asyncQueue.enqueue((0,d.Z)(function*(){const e=yield Uy(n),t=yield By(n);return e.setNetworkEnabled(!0),function(i){const s=P(i);return s.y_.delete(0),es(s)}(t)}))}(ce(n=U(n,J)))}(this._delegate)}disableNetwork(){return function sb(n){return function zS(n){return n.asyncQueue.enqueue((0,d.Z)(function*(){const e=yield Uy(n),t=yield By(n);return e.setNetworkEnabled(!1),(r=(0,d.Z)(function*(s){const o=P(s);o.y_.add(0),yield Ar(o),o.b_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(ce(n=U(n,J)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,$y("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function rb(n){return function(t){const r=new de;return t.asyncQueue.enqueueAndForget((0,d.Z)(function*(){return function RS(n,e){return hd.apply(this,arguments)}(yield Vd(t),r)})),r.promise}(ce(n=U(n,J)))}(this._delegate)}onSnapshotsInSync(e){return function Lb(n,e){return function $S(n,e){const t=new jo(e);return n.asyncQueue.enqueueAndForget((0,d.Z)(function*(){return i=yield kr(n),s=t,P(i).O_.add(s),void s.next();var i,s})),()=>{t.Ca(),n.asyncQueue.enqueueAndForget((0,d.Z)(function*(){return i=yield kr(n),s=t,void P(i).O_.delete(s);var i,s}))}}(ce(n=U(n,J)),Fd(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new I("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Vr(this,Jy(this._delegate,e))}catch(t){throw Oe(t,"collection()","Firestore.collection()")}}doc(e){try{return new He(this,Jo(this._delegate,e))}catch(t){throw Oe(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Le(this,function QS(n,e){if(n=U(n,rs),Ld("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new I(y.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Pe(n,null,(r=e,new Tt(B.emptyPath(),r)));var r}(this._delegate,e))}catch(t){throw Oe(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function jb(n,e,t){n=U(n,J);const r=Object.assign(Object.assign({},Kb),t);return function(s){if(s.maxAttempts<1)throw new I(y.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){const u=new de;return s.asyncQueue.enqueueAndForget((0,d.Z)(function*(){const c=yield function qy(n){return Ho(n).then(e=>e.datastore)}(s);new BS(s.asyncQueue,c,a,o,u).run()})),u.promise}(ce(n),i=>e(new $b(n,i)),r)}(this._delegate,t=>e(new PI(this,t)))}batch(){return ce(this._delegate),new SI(new EI(this._delegate,e=>Nr(this._delegate,e)))}loadBundle(e){return function ob(n,e){const t=ce(n=U(n,J)),r=new JS;return function jS(n,e,t,r){const i=function(o,a){let u;return u="string"==typeof o?h_().encode(o):o,l=function(l,h){if(l instanceof Uint8Array)return My(l,h);if(l instanceof ArrayBuffer)return My(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),new FS(l,a);var l}(t,Xi(e));n.asyncQueue.enqueueAndForget((0,d.Z)(function*(){!function LS(n,e,t){const r=P(n);var i;(i=(0,d.Z)(function*(o,a,u){try{const c=yield a.getMetadata();if(yield function(v,A){const w=P(v),k=ue(A.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",N=>w.Qr.getBundleMetadata(N,A.id)).then(N=>!!N&&N.createTime.compareTo(k)>=0)}(o.localStore,c))return yield a.close(),u._completeWith({taskState:"Success",documentsLoaded:(v=c).totalDocuments,bytesLoaded:v.totalBytes,totalDocuments:v.totalDocuments,totalBytes:v.totalBytes}),Promise.resolve(new Set);u._updateProgress(Sy(c));const l=new mS(c,o.localStore,a.serializer);let h=yield a.ba();for(;h;){const p=yield l.H_(h);p&&u._updateProgress(p),h=yield a.ba()}const f=yield l.complete();return yield Pt(o,f.Z_,void 0),yield function(v,A){const w=P(v);return w.persistence.runTransaction("Save bundle","readwrite",k=>w.Qr.saveBundleMetadata(k,A))}(o.localStore,c),u._completeWith(f.progress),Promise.resolve(f.Y_)}catch(c){return Ze("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}var v}),function s(o,a,u){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Vd(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function ab(n,e){return function ZS(n,e){return n.asyncQueue.enqueue((0,d.Z)(function*(){return function(r,i){const s=P(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Qr.getNamedQuery(o,i))}(yield Qo(n),e)}))}(ce(n=U(n,J)),e).then(t=>t?new Pe(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Le(this,t):null)}}class ca extends Kd{constructor(e){super(),this.firestore=e}convertBytes(e){return new hs(new dt(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return He.forKey(t,this.firestore,null)}}class PI{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ca(e)}get(e){const t=Un(e);return this._delegate.get(t).then(r=>new ds(this._firestore,new bt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=Un(e);return r?(jd("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Un(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Un(e);return this._delegate.delete(t),this}}class SI{constructor(e){this._delegate=e}set(e,t,r){const i=Un(e);return r?(jd("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Un(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Un(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Fn{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new ls(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new fs(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Fn.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new Fn(e,new ca(e),t),i.set(t,s)),s}}Fn.INSTANCES=new WeakMap;class He{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ca(e)}static forPath(e,t,r){if(e.length%2!=0)throw new I("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new He(t,new Y(t._delegate,r,new R(e)))}static forKey(e,t,r){return new He(t,new Y(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Vr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Vr(this.firestore,Jy(this._delegate,e))}catch(t){throw Oe(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,_.m9)(e))instanceof Y&&Xy(this._delegate,e)}set(e,t){t=jd("DocumentReference.set",t);try{return t?yI(this._delegate,e,t):yI(this._delegate,e)}catch(r){throw Oe(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?II(this._delegate,e):II(this._delegate,e,t,...r)}catch(i){throw Oe(i,"updateDoc()","DocumentReference.update()")}}delete(){return function Vb(n){return Nr(U(n.firestore,J),[new gr(n._key,ee.none())])}(this._delegate)}onSnapshot(...e){const t=bI(e),r=CI(e,i=>new ds(this.firestore,new bt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return vI(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function Cb(n){n=U(n,Y);const e=U(n.firestore,J),t=ce(e),r=new sn(e);return function WS(n,e){const t=new de;return n.asyncQueue.enqueueAndForget((0,d.Z)(function*(){return(r=(0,d.Z)(function*(s,o,a){try{const u=yield function(l,h){const f=P(l);return f.persistence.runTransaction("read document","readonly",p=>f.localDocuments.getDocument(p,h))}(s,o);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new I(y.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){const c=Pr(u,`Failed to get document '${o} from cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield Qo(n),e,t);var r})),t.promise}(t,n._key).then(i=>new bt(e,r,n._key,i,new Mn(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function xb(n){n=U(n,Y);const e=U(n.firestore,J);return Gy(ce(e),n._key,{source:"server"}).then(t=>$d(e,n,t))}(this._delegate):function bb(n){n=U(n,Y);const e=U(n.firestore,J);return Gy(ce(e),n._key).then(t=>$d(e,n,t))}(this._delegate),t.then(r=>new ds(this.firestore,new bt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new He(this.firestore,this._delegate.withConverter(e?Fn.getInstance(this.firestore,e):null))}}function Oe(n,e,t){return n.message=n.message.replace(e,t),n}function bI(n){for(const e of n)if("object"==typeof e&&!Zd(e))return e;return{}}function CI(n,e){var t,r;let i;return i=Zd(n[0])?n[0]:Zd(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class ds{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new He(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return _I(this._delegate,e._delegate)}}class fs extends ds{data(e){const t=this._delegate.data(e);return function Z0(n,e){n||b()}(void 0!==t),t}}class Le{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ca(e)}where(e,t,r){try{return new Le(this.firestore,nn(this._delegate,function _b(n,e,t){const r=e,i=ia("where",n);return cs._create(i,r,t)}(e,t,r)))}catch(i){throw Oe(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Le(this.firestore,nn(this._delegate,function yb(n,e="asc"){const t=e,r=ia("orderBy",n);return Wd._create(r,t)}(e,t)))}catch(r){throw Oe(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Le(this.firestore,nn(this._delegate,function Ib(n){return Hy("limit",n),sa._create("limit",n,"F")}(e)))}catch(t){throw Oe(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Le(this.firestore,nn(this._delegate,function vb(n){return Hy("limitToLast",n),sa._create("limitToLast",n,"L")}(e)))}catch(t){throw Oe(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Le(this.firestore,nn(this._delegate,function Eb(...n){return oa._create("startAt",n,!0)}(...e)))}catch(t){throw Oe(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Le(this.firestore,nn(this._delegate,function Tb(...n){return oa._create("startAfter",n,!1)}(...e)))}catch(t){throw Oe(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Le(this.firestore,nn(this._delegate,function Ab(...n){return aa._create("endBefore",n,!1)}(...e)))}catch(t){throw Oe(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Le(this.firestore,nn(this._delegate,function wb(...n){return aa._create("endAt",n,!0)}(...e)))}catch(t){throw Oe(t,"endAt()","Query.endAt()")}}isEqual(e){return Md(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function Db(n){n=U(n,Pe);const e=U(n.firestore,J),t=ce(e),r=new sn(e);return function KS(n,e){const t=new de;return n.asyncQueue.enqueueAndForget((0,d.Z)(function*(){return(r=(0,d.Z)(function*(s,o,a){try{const u=yield Bo(s,o,!0),c=new xy(o,u.ss),l=c.sa(u.documents),h=c.applyChanges(l,!1);a.resolve(h.snapshot)}catch(u){const c=Pr(u,`Failed to execute query '${o} against cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield Qo(n),e,t);var r})),t.promise}(t,n._query).then(i=>new rn(e,r,n,i))}(this._delegate):"server"===e?.source?function Nb(n){n=U(n,Pe);const e=U(n.firestore,J),t=ce(e),r=new sn(e);return zy(t,n._query,{source:"server"}).then(i=>new rn(e,r,n,i))}(this._delegate):function kb(n){n=U(n,Pe);const e=U(n.firestore,J),t=ce(e),r=new sn(e);return lI(n._query),zy(t,n._query).then(i=>new rn(e,r,n,i))}(this._delegate),t.then(r=>new Hd(this.firestore,new rn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=bI(e),r=CI(e,i=>new Hd(this.firestore,new rn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return vI(this._delegate,t,r)}withConverter(e){return new Le(this.firestore,this._delegate.withConverter(e?Fn.getInstance(this.firestore,e):null))}}class iC{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new fs(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Hd{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Le(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new fs(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new iC(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new fs(this._firestore,r))})}isEqual(e){return _I(this._delegate,e._delegate)}}class Vr extends Le{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new He(this.firestore,e):null}doc(e){try{return new He(this.firestore,void 0===e?Jo(this._delegate):Jo(this._delegate,e))}catch(t){throw Oe(t,"doc()","CollectionReference.doc()")}}add(e){return function Ob(n,e){const t=U(n.firestore,J),r=Jo(n),i=ua(n.converter,e);return Nr(t,[ta(On(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,ee.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new He(this.firestore,t))}isEqual(e){return Xy(this._delegate,e._delegate)}withConverter(e){return new Vr(this.firestore,this._delegate.withConverter(e?Fn.getInstance(this.firestore,e):null))}}function Un(n){return U(n,Y)}class Qd{constructor(...e){this._delegate=new St(...e)}static documentId(){return new Qd(se.keyField().canonicalString())}isEqual(e){return(e=(0,_.m9)(e))instanceof St&&this._delegate._internalPath.isEqual(e._internalPath)}}class Bn{constructor(e){this._delegate=e}static serverTimestamp(){const e=function Hb(){return new Ud("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new Bn(e)}static delete(){const e=function Zb(){return new ss("deleteField")}();return e._methodName="FieldValue.delete",new Bn(e)}static arrayUnion(...e){const t=function Qb(...n){return new db("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new Bn(t)}static arrayRemove(...e){const t=function Yb(...n){return new fb("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new Bn(t)}static increment(e){const t=function Jb(n){return new pb("increment",n)}(e);return t._methodName="FieldValue.increment",new Bn(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const sC={Firestore:RI,GeoPoint:Xo,Timestamp:X,Blob:hs,Transaction:PI,WriteBatch:SI,DocumentReference:He,DocumentSnapshot:ds,Query:Le,QueryDocumentSnapshot:fs,QuerySnapshot:Hd,CollectionReference:Vr,FieldPath:Qd,FieldValue:Bn,setLogLevel:function rC(n){!function j0(n){Bt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function aC(n){(function oC(n,e){n.INTERNAL.registerComponent(new Qe.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},sC)))})(n,(e,t)=>new RI(e,t,new nC)),n.registerVersion("@firebase/firestore-compat","0.3.14")}(cn);var uC=W(553),cC=W(1411),xI=W(5896),lC=W(9229),hC=W(3603),dC=W(2870),fC=W(9582),pC=W(1030),mC=W(885),gC=W(169),_C=W(4701),yC=W(30),IC=W(3250);function vC(n,e){1&n&&(g.TgZ(0,"span"),g._uU(1,"Mobile Number is required "),g.qZA())}function EC(n,e){1&n&&(g.TgZ(0,"span"),g._uU(1,"Mobile Number is Invaild"),g.qZA())}function TC(n,e){if(1&n&&(g.TgZ(0,"div",10),g.YNc(1,vC,2,0,"span",0),g.YNc(2,EC,2,0,"span",0),g.qZA()),2&n){const t=g.oxw(2);g.xp6(1),g.Q6J("ngIf",!(null!=t.phoneForm&&null!=t.phoneForm.value&&t.phoneForm.value.phone)&&(null==t.phoneForm||null==t.phoneForm.controls||null==t.phoneForm.controls.phone||null==t.phoneForm.controls.phone.errors?null:t.phoneForm.controls.phone.errors.required)),g.xp6(1),g.Q6J("ngIf",(null==t.phoneForm||null==t.phoneForm.value?null:t.phoneForm.value.phone)&&(null==t.phoneForm||null==t.phoneForm.controls.phone?null:t.phoneForm.controls.phone.invalid))}}const AC=function(n,e){return[n,e]};function wC(n,e){if(1&n){const t=g.EpF();g.ynx(0),g.TgZ(1,"form",2)(2,"div",3),g._uU(3," Welcome! "),g.TgZ(4,"div",4),g._uU(5," We're looking forward to caring for you. "),g.qZA()(),g.TgZ(6,"div",5),g._uU(7," You will receive an OTP via SMS to"),g._UZ(8,"br"),g._uU(9," verify your mobile number. "),g.qZA(),g.TgZ(10,"div",6)(11,"div",4)(12,"ngx-intl-tel-input",7),g.NdJ("isKeyUpEnter",function(){g.CHM(t);const i=g.oxw();return g.KtG(i.sednOtpEvent())})("countryChange",function(i){g.CHM(t);const s=g.oxw();return g.KtG(s.onCountryChange(i))}),g.qZA(),g.YNc(13,TC,3,2,"div",8),g.qZA()(),g.TgZ(14,"button",9),g.NdJ("click",function(){g.CHM(t);const i=g.oxw();return g.KtG(i.sednOtpEvent())})("keyup.enter",function(){g.CHM(t);const i=g.oxw();return g.KtG(i.sednOtpEvent())}),g._uU(15," Login "),g.qZA()(),g.BQk()}if(2&n){const t=g.oxw();g.xp6(1),g.Q6J("formGroup",t.phoneForm),g.xp6(11),g.Q6J("enableAutoCountrySelect",!0)("enablePlaceholder",!0)("searchCountryFlag",!0)("searchCountryField",g.WLB(11,AC,null==t.phoneForm||null==t.phoneForm.value?null:t.phoneForm.value.SearchCountryField.Iso2,null==t.phoneForm||null==t.phoneForm.value?null:t.phoneForm.value.SearchCountryField.Name))("selectFirstCountry",!1)("selectedCountryISO",null==t.phoneForm||null==t.phoneForm.value?null:t.phoneForm.value.CountryISO.India)("phoneValidation",!0)("separateDialCode",!0),g.xp6(1),g.Q6J("ngIf",null==t.phoneForm.controls.phone?null:t.phoneForm.controls.phone.touched),g.xp6(1),g.Q6J("disabled",t.phoneForm.invalid)}}function RC(n,e){if(1&n){const t=g.EpF();g.ynx(0),g.TgZ(1,"div",11),g._uU(2," Enter Your OTP "),g.qZA(),g.TgZ(3,"div",12),g._uU(4," Please enter the 6 digit OTP sent to"),g._UZ(5,"br"),g._uU(6),g.qZA(),g.TgZ(7,"ng-otp-input",13),g.NdJ("isKeyUpEnter",function(){g.CHM(t);const i=g.oxw();return g.KtG(i.otpNextEvent())})("onInputChange",function(i){g.CHM(t);const s=g.oxw();let o;return g.KtG(null==(o=s.phoneForm.get("otp"))?null:o.setValue(i))}),g.qZA(),g.TgZ(8,"div",6)(9,"div",14)(10,"a",15),g.NdJ("click",function(){g.CHM(t);const i=g.oxw();return g.KtG(i.sednOtpEvent("resend"))}),g._uU(11," Resend OTP?"),g.qZA()()(),g.TgZ(12,"button",16),g.NdJ("click",function(){g.CHM(t);const i=g.oxw();return g.KtG(i.otpNextEvent())}),g._uU(13," Verify "),g.qZA(),g.BQk()}if(2&n){const t=g.oxw();let r,i;g.xp6(6),g.hij(" ",null==(r=t.phoneForm.get("phone"))?null:r.value.e164Number," as SMS "),g.xp6(1),g.Q6J("config",t.config),g.xp6(5),g.Q6J("disabled",6!=(null==(i=t.phoneForm.get("otp"))||null==i.value?null:i.value.length))}}let PC=(()=>{var n;class e{constructor(r,i,s,o,a,u,c,l,h,f,p,v,A){this.loaderService=r,this.cdr=i,this.authenticationService=s,this.toastrService=o,this.tokenStorage=a,this.router=u,this.localStorageService=c,this.navigateService=l,this.dashboardListService=h,this.win=f,this.authService=p,this.WebengageDataService=v,this.eventTrackingService=A,this.loginFormCallback=new g.vpe,this.subscriptions=[],this.formId=this.localStorageService.getItem("FormId"),this.responseId=this.localStorageService.getItem("ResponseId"),this.coutryFlag=!1,this.config={allowNumbersOnly:!0,length:6,isPasswordInput:!1,disableAutoFocus:!1,placeholder:"",containerClass:"d-flex",inputClass:""},this.phoneForm=new Se.cw({phone:new Se.NI("",[Se.kI.required]),invalidOTP:new Se.NI(!1),isOtpScreen:new Se.NI(!1),otp:new Se.NI,userName:new Se.NI,SearchCountryField:new Se.NI(pa.wX),CountryISO:new Se.NI(pa.HT)}),this.checkIsLoading(),this.windowRef=this.win.windowRef,cn?.initializeApp(uC.N.firebaseConfig)}ngOnInit(){localStorage.getItem("userSlug")&&this.router.navigate(["/"])}ngAfterViewInit(){try{this.windowRef&&(this.windowRef.recaptchaVerifier=new cn.auth.RecaptchaVerifier("recaptcha-container",{size:"invisible"}),this.windowRef?.recaptchaVerifier?.verify())}catch(r){console.log(r,"---------------")}}checkIsLoading(){this.loaderService.isLoading.subscribe(r=>{this.isLoading=r||r})}onCountryChange(r){}sednOtpEvent(r){if(this.phoneForm.invalid)return;const i=this.phoneForm.getRawValue();if(this.eventTrackingService.trackWebEnagegeEvent("Mobile number entered",i.phone.number.replaceAll(" ","")),"+91"!=i.phone.dialCode){const s=this.windowRef.recaptchaVerifier,o=i.phone.e164Number;pp(function YA(n=af()){const e=gs(n,"auth");if(e.isInitialized())return e.getImmediate();const t=function _E(n,e){const t=gs(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),s=t.getOptions();if((0,_.vZ)(s,e??{}))return i;me(i,"already-initialized")}return t.initialize({options:e})}(n,{popupRedirectResolver:Rp,persistence:[Jn,Ss,Lt]}),r=(0,_.Pz)("authTokenSyncURL");if(r){const s=QA(r);(function lT(n,e,t){(0,_.m9)(n).beforeAuthStateChanged(e,t)})(t,s,()=>s(t.currentUser)),function cT(n,e,t,r){(0,_.m9)(n).onIdTokenChanged(e,t,r)}(t,o=>s(o))}const i=(0,_.q4)("auth");return i&&zf(t,`http://${i}`),t}(),o,s).then(u=>{this.windowRef.confirmationResult=u,this.phoneForm.get("isOtpScreen")?.setValue(!0),this.cdr.detectChanges()}).catch(u=>{console.log(u),this.toastrService.error(u,void 0,{positionClass:"toast-top-center",closeButton:!0}),console.log(u)})}else{this.coutryFlag=!0;const s={user_mo_no:i?.phone?.number.replaceAll(" ",""),user_country_code:i.phone.dialCode,user_frnd_ref_code:localStorage.getItem("ref_code")};this.subscriptions.push(this.authenticationService.generateAuthOtp(s).subscribe(o=>{o?.success&&("resend"===r&&this.ngOtpInputRef?.setValue(null),this.phoneForm.get("userName").setValue(o?.data?.userName),this.phoneForm.get("isOtpScreen")?.setValue(!0),this.toastrService.success("OTP Sent Successfully.",void 0,{positionClass:"toast-bottom-center",closeButton:!0})),this.cdr.detectChanges()}))}}otpNextEvent(){if(6!=this.phoneForm.get("otp").value.length)return;const r=this.phoneForm.getRawValue();if("+91"!=r.phone.dialCode){const i=r.otp;this.windowRef.confirmationResult.confirm(i).then(s=>{const o={user_mo_no:r.phone.number.replaceAll(/[-\s]/g,""),user_frnd_ref_code:localStorage.getItem("ref_code"),user_country_code:r.phone.dialCode};this.eventTrackingService.trackWebEnagegeEvent("OTP Entered",i),this.subscriptions.push(this.authenticationService.generateUserSlug(o).subscribe(a=>{if(console.log(a,"------------eror verfiy"),a?.success){if((a=a.data)&&a?.data){if("pending"==a?.data?.user?.user_setup_status)return this.localStorageService.setItem("dail_code",r.phone.dialCode),this.tokenStorage.setUserAccessToken(a?.data?.token),void this.router.navigate(["/auth/signup"],{queryParams:{mobilenumber:r.phone.number.replace(" ",""),quiz:!!this.quiz}});this.tokenStorage.setUserAccessToken(a?.data?.token),this.localStorageService.setItem("dail_code",r.phone.dialCode),this.localStorageService.setItem("userSlug",a?.data?.user),this.WebengageDataService.setUserProperties(a?.data?.user),this.router.navigate([this.localStorageService.getItem("URL")||"/"])}}else this.phoneForm.get("invalidOTP")?.setValue(!0)},a=>{console.log(a),this.phoneForm.get("invalidOTP")?.setValue(!0)}))}).catch(s=>{this.toastrService.error("Incorrect code entered or code expired!",void 0,{positionClass:"toast-bottom-center",closeButton:!0}),console.log(s,"Incorrect code entered?")})}else{const i={user_mo_no:r.phone.number.replaceAll(" ",""),user_country_code:r.phone.dialCode,user_otp:r.otp};this.subscriptions.push(this.authenticationService.validateUser(i).subscribe(s=>{if(s?.success){if((s=s.data)&&s?.data){if("pending"==s?.data?.user?.user_setup_status)return this.localStorageService.setItem("dail_code",r.phone.dialCode),this.tokenStorage.setUserAccessToken(s?.data?.token),this.localStorageService.setItem("userSlug",s?.data?.user),void this.router.navigate(["/auth/signup"],{queryParams:{mobilenumber:r.phone.number.replace(" ",""),quiz:!!this.quiz}});this.tokenStorage.setUserAccessToken(s?.data?.token),this.localStorageService.setItem("dail_code",r.phone.dialCode),this.localStorageService.setItem("userSlug",s?.data?.user),this.WebengageDataService.setUserProperties(s?.data?.user),this.getUserQuizScore();let o=JSON.parse(localStorage.getItem("doctorType"));if(this.localStorageService.getItem("URL")?.indexOf("payment")>-1)return void this.navigateService.navigation([this.localStorageService.getItem("URL")],{queryParams:{type:o?.type||o}});this.router.navigate([this.localStorageService.getItem("URL")||"/"])}}else this.toastrService.error(s?.error?.message,void 0,{positionClass:"toast-bottom-center",closeButton:!0}),this.phoneForm.get("invalidOTP")?.setValue(!0)},s=>{console.log(s,s?.data?.message),this.toastrService.error(s?.error?.message,void 0,{positionClass:"toast-bottom-center",closeButton:!0}),this.phoneForm.get("invalidOTP")?.setValue(!0)}))}}getUserQuizScore(){this.subscriptions.push(this.authService.getUser().subscribe(r=>{r?.data&&(this.localStorageService.setItem("userSlug",r?.data?.data),this.router.navigate(["/membership"]))}))}ngOnDestroy(){this.subscriptions.forEach(r=>r.unsubscribe())}}return(n=e).\u0275fac=function(r){return new(r||n)(g.Y36(cC.D),g.Y36(g.sBO),g.Y36(xI.e),g.Y36(lC._W),g.Y36(hC.i),g.Y36(fa.F0),g.Y36(dC.n),g.Y36(fC.o),g.Y36(pC.L),g.Y36(mC.u),g.Y36(xI.e),g.Y36(gC.q),g.Y36(_C.f))},n.\u0275cmp=g.Xpm({type:n,selectors:[["app-login-number-form"]],viewQuery:function(r,i){if(1&r&&g.Gf(Jd.d,5),2&r){let s;g.iGM(s=g.CRH())&&(i.ngOtpInputRef=s.first)}},inputs:{quiz:"quiz"},outputs:{loginFormCallback:"loginFormCallback"},decls:3,vars:2,consts:[[4,"ngIf"],["id","recaptcha-container",1,"mt-3",2,"display","none"],["novalidate","novalidate","id","kt_login_signin_form",1,"form","w-100",3,"formGroup"],[1,"md:mb-10","mb-2","mt-4","md:mt-20","py-2","text-xl","font-bold","font-lora"],[1,""],[1,"pt-2","text-base","sm:text-lg","font-roboto"],[1,"flex","justify-center","gap-2","py-5"],["dropdownMaxHeight","150px","numberonly","","cssClass","w-full py-1.5 text-black border rounded-full outline-none px-5 sm:py-2 placeholder:text-theme-lightest-grey border-theme-lightest-pink","name","phone","formControlName","phone",1,"",3,"enableAutoCountrySelect","enablePlaceholder","searchCountryFlag","searchCountryField","selectFirstCountry","selectedCountryISO","phoneValidation","separateDialCode","isKeyUpEnter","countryChange"],["class","text-sm text-left text-theme-error-red",4,"ngIf"],[1,"inline-block","px-7","py-1.5","mx-auto","text-lg","sm:text-xl","text-white","rounded-full","font-roboto","bg-theme-light-maroon",3,"disabled","click","keyup.enter"],[1,"text-sm","text-left","text-theme-error-red"],[1,"py-2","text-xl","font-bold","font-lora"],[1,"pt-2","text-base","text-center","sm:text-lg","font-roboto"],["numberonly","",1,"block","mt-6","ng-otp-input-container",3,"config","isKeyUpEnter","onInputChange"],[1,"text-sm","font-medium","sm:text-lg","font-roboto","text-theme-light-pink"],[1,"cursor-pointer",3,"click"],[1,"inline-block","px-7","py-1.5","mx-auto","text-lg","sm:text-xl","text-white","rounded-full","font-roboto","bg-theme-light-maroon",3,"disabled","click"]],template:function(r,i){if(1&r&&(g.YNc(0,wC,16,14,"ng-container",0),g._UZ(1,"div",1),g.YNc(2,RC,14,3,"ng-container",0)),2&r){let s,o;g.Q6J("ngIf",!(null!=(s=i.phoneForm.get("isOtpScreen"))&&s.value)),g.xp6(2),g.Q6J("ngIf",null==(o=i.phoneForm.get("isOtpScreen"))?null:o.value)}},dependencies:[da.O5,yC.F,IC.m,Se._Y,Se.JJ,Se.JL,Se.sg,Se.u,Jd.d],encapsulation:2}),e})();function SC(n,e){if(1&n){const t=g.EpF();g.TgZ(0,"app-login-number-form",7),g.NdJ("loginFormCallback",function(i){g.CHM(t);const s=g.oxw();return g.KtG(s.loginFormCallback(i))}),g.qZA()}if(2&n){const t=g.oxw();g.Q6J("quiz",t.quiz)}}function bC(n,e){1&n&&g._UZ(0,"app-login-otp-form",8)}let CC=(()=>{var n;class e{constructor(r){this.activatedRoute=r,this.class="lg:pt-[85px] block",this.loginClicked=!1}loginFormCallback(r){this.loginClicked=r?.loginClicked}setAnimationWidthParam(){const r=`${document?.getElementById("login-image-container")?.clientWidth}px`;document?.getElementById("animate-image-login")?.style?.setProperty("--image-width",r)}ngOnInit(){this.setAnimationWidthParam(),this.activatedRoute.queryParamMap.subscribe(r=>{this.quiz=r.get("quiz")})}}return(n=e).\u0275fac=function(r){return new(r||n)(g.Y36(fa.gz))},n.\u0275cmp=g.Xpm({type:n,selectors:[["app-login-page"]],hostVars:2,hostBindings:function(r,i){2&r&&g.Tol(i.class)},decls:7,vars:2,consts:[[1,"py-10","text-center"],["id","login-image-container",1,"mx-auto","w-full","md:max-w-[562px]","h-[200px]","md:h-[294px]","relative","overflow-hidden"],[1,"hidden","md:block","absolute","login-page-gredient","left-0","top-0","bottom-0","rotate-180","z-[1]","w-[235px]"],["src","https://s3.ap-south-1.amazonaws.com/gytree.com/assetsV2/media/login-page-images/animation-image.png","alt","","id","animate-image-login",1,"absolute","left-0","h-full","w-auto","max-w-[initial]","animate-[left-to-right]","animate-width-param","animate-ease-linear","animate-duration-[14s]","animate-infinite"],[1,"hidden","md:block","absolute","login-page-gredient","right-0","top-0","bottom-0","z-[1]","w-[235px]"],["class","block pb-6 lg:pt-5",3,"quiz","loginFormCallback",4,"ngIf"],["class","block pb-6 lg:pt-5",4,"ngIf"],[1,"block","pb-6","lg:pt-5",3,"quiz","loginFormCallback"],[1,"block","pb-6","lg:pt-5"]],template:function(r,i){1&r&&(g.TgZ(0,"div",0)(1,"div",1),g._UZ(2,"div",2)(3,"img",3)(4,"div",4),g.qZA(),g.YNc(5,SC,1,1,"app-login-number-form",5),g.YNc(6,bC,1,0,"app-login-otp-form",6),g.qZA()),2&r&&(g.xp6(5),g.Q6J("ngIf",!i.loginClicked),g.xp6(1),g.Q6J("ngIf",i.loginClicked))},dependencies:[da.O5,PC],encapsulation:2}),e})();var xC=W(6905),kC=W(1986);const DC=[{path:"",component:CC}];let NC=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=g.oAB({type:n}),n.\u0275inj=g.cJS({imports:[da.ez,fa.Bz.forChild(DC),pa.J7,Se.u5,Se.UX,xC.j,kC.X]}),e})()}}]);